<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Literacia Financeira</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --green: #00c896;
    --green-light: rgba(0,200,150,0.08);
    --navy: #0a1628;
    --bg: #f4f7fb;
    --bg2: #eef2f8;
    --white: #ffffff;
    --border: rgba(0,0,0,0.07);
    --border-green: rgba(0,200,150,0.25);
    --text: #0d1b2e;
    --muted: #8fa0b8;
    --red: #ff3d6b;
    --amber: #f59e0b;
    --shadow-sm: 0 2px 8px rgba(0,0,0,0.06);
    --shadow-md: 0 8px 24px rgba(0,0,0,0.09);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  html, body { height: 100%; background: var(--bg); color: var(--text); font-family: 'Outfit', sans-serif; overflow: hidden; }

  .phone { max-width: 420px; height: 100dvh; margin: 0 auto; display: flex; flex-direction: column; overflow: hidden; background: var(--bg); position: relative; }
  .phone::before { content: ''; position: fixed; top: -100px; right: -80px; width: 280px; height: 280px; border-radius: 50%; background: radial-gradient(circle, rgba(0,200,150,0.1), transparent 70%); pointer-events: none; z-index: 0; }

  .header { padding: 16px 20px 10px; display: flex; align-items: center; justify-content: space-between; flex-shrink: 0; position: relative; z-index: 1; }
  .logo-mark { display: flex; align-items: center; gap: 10px; }
  .logo-icon { width: 38px; height: 38px; background: var(--navy); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-family: 'Syne', sans-serif; font-weight: 800; font-size: 0.72rem; color: var(--green); box-shadow: 0 4px 12px rgba(10,22,40,0.25); }
  .logo-text { font-family: 'Syne', sans-serif; font-weight: 800; font-size: 0.95rem; color: var(--text); line-height: 1.1; }
  .logo-text span { display: block; font-size: 0.58rem; font-weight: 500; color: var(--muted); letter-spacing: 0.1em; text-transform: uppercase; }
  .header-right { display: flex; gap: 8px; }
  .icon-btn { width: 38px; height: 38px; border-radius: 12px; background: var(--white); border: 1px solid var(--border); box-shadow: var(--shadow-sm); display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 1rem; transition: all 0.2s; }
  .icon-btn:active { transform: scale(0.94); }

  .sub-tab-bar { display: flex; padding: 0 16px 10px; gap: 6px; flex-shrink: 0; overflow-x: auto; scrollbar-width: none; position: relative; z-index: 1; }
  .sub-tab-bar::-webkit-scrollbar { display: none; }
  .sub-tab-btn { flex-shrink: 0; padding: 7px 16px; border-radius: 20px; border: 1.5px solid var(--border); background: var(--white); color: var(--muted); font-family: 'Outfit', sans-serif; font-size: 0.74rem; font-weight: 600; cursor: pointer; transition: all 0.2s; white-space: nowrap; box-shadow: var(--shadow-sm); }
  .sub-tab-btn.active { background: var(--navy); border-color: var(--navy); color: var(--green); box-shadow: 0 4px 14px rgba(10,22,40,0.2); }

  .scroll-area { flex: 1; overflow-y: auto; padding: 4px 16px 16px; scrollbar-width: none; position: relative; z-index: 1; }
  .scroll-area::-webkit-scrollbar { display: none; }

  .tab-content { display: none; }
  .tab-content.active { display: block; animation: fadeUp 0.25s ease both; }

  .hero-card { background: var(--navy); border-radius: 22px; padding: 22px; margin-bottom: 16px; position: relative; overflow: hidden; box-shadow: 0 12px 40px rgba(10,22,40,0.22); }
  .hero-card::before { content: ''; position: absolute; top: -60px; right: -60px; width: 180px; height: 180px; border-radius: 50%; background: radial-gradient(circle, rgba(0,200,150,0.2), transparent 70%); }
  .hero-label { font-size: 0.68rem; text-transform: uppercase; letter-spacing: 0.12em; color: rgba(255,255,255,0.4); margin-bottom: 6px; position: relative; z-index: 1; }
  .hero-value { font-family: 'Syne', sans-serif; font-size: 2.2rem; font-weight: 800; color: #fff; line-height: 1; margin-bottom: 4px; position: relative; z-index: 1; }
  .hero-value .accent { color: var(--green); }
  .hero-sub { font-size: 0.75rem; color: rgba(255,255,255,0.45); position: relative; z-index: 1; }
  .hero-badge { display: inline-flex; align-items: center; gap: 5px; background: rgba(0,200,150,0.15); border: 1px solid rgba(0,200,150,0.25); border-radius: 20px; padding: 4px 12px; font-size: 0.68rem; color: var(--green); margin-top: 14px; position: relative; z-index: 1; font-weight: 600; }

  .section-title { font-family: 'Syne', sans-serif; font-size: 0.68rem; text-transform: uppercase; letter-spacing: 0.14em; color: var(--muted); margin-bottom: 10px; margin-top: 20px; padding-left: 2px; }

  .sim-card { background: var(--white); border: 1px solid var(--border); border-radius: 18px; padding: 16px; margin-bottom: 10px; box-shadow: var(--shadow-sm); }
  .sim-card-title { font-family: 'Syne', sans-serif; font-weight: 700; font-size: 0.88rem; color: var(--text); display: flex; align-items: center; gap: 10px; margin-bottom: 14px; }
  .sim-icon { width: 34px; height: 34px; border-radius: 10px; background: var(--green-light); border: 1px solid var(--border-green); display: flex; align-items: center; justify-content: center; font-size: 0.9rem; flex-shrink: 0; }

  .input-group { margin-bottom: 10px; }
  .input-label { font-size: 0.7rem; color: var(--muted); margin-bottom: 5px; font-weight: 500; display: flex; justify-content: space-between; align-items: center; }
  .input-wrapper { position: relative; }
  .input-field { width: 100%; background: var(--bg); border: 1.5px solid var(--border); border-radius: 12px; padding: 11px 44px 11px 14px; color: var(--text); font-family: 'Outfit', sans-serif; font-size: 0.92rem; font-weight: 600; outline: none; transition: border-color 0.2s, box-shadow 0.2s; }
  .input-field:focus { border-color: var(--green); box-shadow: 0 0 0 3px var(--green-light); background: var(--white); }
  .input-unit { position: absolute; right: 14px; top: 50%; transform: translateY(-50%); font-size: 0.72rem; color: var(--muted); font-weight: 700; }

  .calc-btn { width: 100%; background: var(--navy); color: #fff; border: none; border-radius: 14px; padding: 14px; font-family: 'Syne', sans-serif; font-size: 0.85rem; font-weight: 700; cursor: pointer; transition: all 0.2s; margin-top: 4px; letter-spacing: 0.03em; box-shadow: 0 6px 20px rgba(10,22,40,0.2); position: relative; overflow: hidden; }
  .calc-btn::after { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px; background: linear-gradient(90deg, transparent, rgba(0,200,150,0.5), transparent); }
  .calc-btn:active { transform: scale(0.98); }

  .result-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 12px; }
  .result-box { background: var(--bg); border: 1px solid var(--border); border-radius: 12px; padding: 11px 14px; }
  .result-box.highlight { background: var(--navy); border-color: var(--navy); }
  .result-box.highlight-red { background: rgba(255,61,107,0.08); border-color: rgba(255,61,107,0.2); }
  .result-label { font-size: 0.62rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 3px; }
  .result-box.highlight .result-label { color: rgba(255,255,255,0.4); }
  .result-box.highlight-red .result-label { color: rgba(255,61,107,0.6); }
  .result-value { font-family: 'Syne', sans-serif; font-size: 0.98rem; font-weight: 800; color: var(--text); }
  .result-box.highlight .result-value { color: var(--green); }
  .result-box.highlight-red .result-value { color: var(--red); }

  .chip-row { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px; }
  .chip { padding: 6px 13px; border-radius: 20px; border: 1.5px solid var(--border); background: var(--bg); font-size: 0.72rem; font-weight: 600; color: var(--muted); cursor: pointer; transition: all 0.2s; }
  .chip.active { background: var(--green-light); border-color: var(--green); color: #008c69; }

  .progress-bar { height: 6px; background: var(--bg2); border-radius: 3px; margin-top: 12px; overflow: hidden; }
  .progress-fill { height: 100%; border-radius: 3px; background: var(--green); transition: width 0.8s cubic-bezier(0.4,0,0.2,1); }

  /* DIVIDER */
  .divider { height: 1px; background: var(--bg2); margin: 14px 0 10px; }

  /* INFO BOX */
  .info-box { background: rgba(0,200,150,0.06); border: 1px solid var(--border-green); border-radius: 12px; padding: 10px 14px; margin-bottom: 12px; font-size: 0.75rem; color: #008c69; line-height: 1.5; }
  .info-box strong { font-weight: 700; }

  /* RETENTION TAG */
  .retention-tag { display: inline-flex; align-items: center; gap: 4px; background: rgba(245,158,11,0.1); border: 1px solid rgba(245,158,11,0.25); border-radius: 20px; padding: 3px 10px; font-size: 0.65rem; color: var(--amber); font-weight: 700; margin-left: 6px; }

  /* MORTGAGE */
  .mortgage-breakdown { background: var(--navy); border-radius: 18px; padding: 18px; margin-top: 12px; box-shadow: 0 8px 30px rgba(10,22,40,0.18); }
  .breakdown-title { font-family: 'Syne', sans-serif; font-size: 0.72rem; font-weight: 700; color: rgba(255,255,255,0.5); margin-bottom: 14px; text-transform: uppercase; letter-spacing: 0.08em; }
  .breakdown-row { display: flex; justify-content: space-between; align-items: center; padding: 9px 0; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 0.8rem; }
  .breakdown-row:last-child { border-bottom: none; }
  .breakdown-row .key { color: rgba(255,255,255,0.45); }
  .breakdown-row .val { font-weight: 700; color: #fff; }
  .breakdown-row .val.green { color: var(--green); }
  .breakdown-row .val.red { color: var(--red); }
  .breakdown-row .val.amber { color: var(--amber); }

  /* PRODUCT RATE CARD */
  .product-card { background: var(--white); border: 1px solid var(--border); border-radius: 18px; padding: 16px; margin-bottom: 10px; box-shadow: var(--shadow-sm); }
  .product-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
  .product-left { display: flex; align-items: center; gap: 12px; }
  .product-logo { width: 40px; height: 40px; border-radius: 12px; background: var(--navy); display: flex; align-items: center; justify-content: center; font-size: 0.62rem; font-weight: 800; color: var(--green); text-align: center; flex-shrink: 0; }
  .product-name { font-weight: 700; font-size: 0.85rem; color: var(--text); }
  .product-type { font-size: 0.67rem; color: var(--muted); margin-top: 1px; }
  .product-rate { font-family: 'Syne', sans-serif; font-size: 1.2rem; font-weight: 800; color: var(--text); text-align: right; }
  .product-rate-label { font-size: 0.62rem; color: var(--muted); text-align: right; }
  .product-detail-row { display: flex; justify-content: space-between; padding: 5px 0; border-top: 1px solid var(--bg2); font-size: 0.75rem; }
  .product-detail-row .dk { color: var(--muted); }
  .product-detail-row .dv { font-weight: 600; color: var(--text); }
  .product-detail-row .dv.green { color: var(--green); }
  .product-detail-row .dv.red { color: var(--red); }
  .product-detail-row .dv.amber { color: var(--amber); }

  /* RATE CARDS (taxas) */
  .rate-card { background: var(--white); border: 1px solid var(--border); border-radius: 16px; padding: 14px 16px; margin-bottom: 8px; display: flex; align-items: center; justify-content: space-between; box-shadow: var(--shadow-sm); }
  .rate-left { display: flex; align-items: center; gap: 12px; }
  .rate-logo { width: 40px; height: 40px; border-radius: 12px; background: var(--navy); display: flex; align-items: center; justify-content: center; font-size: 0.62rem; font-weight: 800; color: var(--green); }
  .rate-name { font-weight: 700; font-size: 0.83rem; color: var(--text); }
  .rate-type { font-size: 0.67rem; color: var(--muted); margin-top: 1px; }
  .rate-value { font-family: 'Syne', sans-serif; font-size: 1.15rem; font-weight: 800; color: var(--text); text-align: right; }
  .rate-period { font-size: 0.62rem; color: var(--muted); text-align: right; margin-top: 1px; }

  .euribor-strip { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 16px; }
  .euribor-box { background: var(--white); border: 1px solid var(--border); border-radius: 14px; padding: 14px 10px; text-align: center; box-shadow: var(--shadow-sm); }
  .euribor-label { font-size: 0.62rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 5px; font-weight: 600; }
  .euribor-val { font-family: 'Syne', sans-serif; font-size: 1.05rem; font-weight: 800; color: var(--text); }
  .euribor-change { font-size: 0.63rem; margin-top: 3px; font-weight: 600; }
  .up { color: var(--red); } .down { color: var(--green); }

  .bottom-nav { display: flex; padding: 8px 12px 22px; gap: 4px; background: var(--white); border-top: 1px solid var(--border); flex-shrink: 0; box-shadow: 0 -8px 24px rgba(0,0,0,0.06); position: relative; z-index: 10; }
  .nav-btn { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 3px; padding: 8px 4px; border-radius: 14px; background: transparent; border: none; cursor: pointer; transition: all 0.2s; color: var(--muted); }
  .nav-btn.active { background: var(--navy); color: var(--green); }
  .nav-icon { font-size: 1.05rem; }
  .nav-label { font-size: 0.58rem; font-weight: 700; font-family: 'Outfit', sans-serif; }


  /* FILTER BLOCK */
  .filter-block { background: var(--white); border: 1px solid var(--border); border-radius: 16px; padding: 14px; margin-bottom: 12px; box-shadow: var(--shadow-sm); }
  .filter-row { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
  .filter-toggle { display: flex; align-items: center; gap: 6px; padding: 7px 14px; border-radius: 20px; border: 1.5px solid var(--border); background: var(--bg); font-size: 0.72rem; font-weight: 600; color: var(--muted); cursor: pointer; transition: all 0.2s; white-space: nowrap; }
  .filter-toggle.active { background: var(--green-light); border-color: var(--green); color: #008c69; }
  .filter-toggle.filter-neg { background: rgba(255,61,107,0.08); border-color: rgba(255,61,107,0.3); color: var(--red); }
  .filter-toggle.filter-neg .ft-dot { background: var(--red); }
  .ft-dot { width: 8px; height: 8px; border-radius: 50%; background: currentColor; opacity: 0.5; }
  .filter-toggle.active .ft-dot { opacity: 1; }
  .sort-btn { margin-left: auto; padding: 7px 14px; border-radius: 20px; border: 1.5px solid var(--navy); background: var(--navy); color: var(--green); font-size: 0.7rem; font-weight: 700; cursor: pointer; white-space: nowrap; font-family: 'Outfit', sans-serif; }
  .filter-input-wrap { display: flex; align-items: center; gap: 6px; flex: 1; background: var(--bg); border: 1.5px solid var(--border); border-radius: 12px; padding: 8px 12px; }
  .fi-label { font-size: 0.65rem; color: var(--muted); font-weight: 600; white-space: nowrap; }
  .fi-input { flex: 1; border: none; background: transparent; outline: none; font-family: 'Outfit', sans-serif; font-size: 0.82rem; font-weight: 600; color: var(--text); width: 0; min-width: 0; }
  .fi-unit { font-size: 0.65rem; color: var(--muted); font-weight: 700; }
  .results-count { font-size: 0.68rem; color: var(--muted); margin-top: 8px; text-align: right; }

  /* DP CARD */
  .dp-card { background: var(--white); border: 1px solid var(--border); border-radius: 16px; margin-bottom: 8px; box-shadow: var(--shadow-sm); overflow: hidden; }
  .dp-card-header { display: flex; align-items: center; justify-content: space-between; padding: 14px 16px; cursor: pointer; }
  .dp-card-left { display: flex; align-items: center; gap: 12px; }
  .dp-logo { width: 40px; height: 40px; border-radius: 12px; background: var(--navy); display: flex; align-items: center; justify-content: center; font-size: 0.58rem; font-weight: 800; color: var(--green); text-align: center; line-height: 1.2; flex-shrink: 0; }
  .dp-name { font-weight: 700; font-size: 0.83rem; color: var(--text); }
  .dp-sub { font-size: 0.67rem; color: var(--muted); margin-top: 1px; }
  .dp-rate-col { text-align: right; }
  .dp-tanb { font-family: 'Syne', sans-serif; font-size: 1.1rem; font-weight: 800; color: var(--text); }
  .dp-tanl { font-size: 0.68rem; color: var(--green); font-weight: 600; margin-top: 1px; }
  .dp-expand-icon { width: 24px; height: 24px; border-radius: 6px; background: var(--bg2); display: flex; align-items: center; justify-content: center; font-size: 0.75rem; color: var(--muted); margin-left: 8px; transition: transform 0.2s; flex-shrink: 0; }
  .dp-card.open .dp-expand-icon { transform: rotate(180deg); }
  .dp-details { display: none; border-top: 1px solid var(--bg2); padding: 12px 16px; background: var(--bg); }
  .dp-card.open .dp-details { display: block; animation: fadeUp 0.2s ease; }
  .dp-detail-row { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid var(--border); font-size: 0.78rem; }
  .dp-detail-row:last-child { border-bottom: none; }
  .dp-dk { color: var(--muted); }
  .dp-dv { font-weight: 600; color: var(--text); }
  .dp-dv.green { color: var(--green); }
  .dp-dv.red { color: var(--red); }
  .dp-dv.amber { color: var(--amber); }
  .dp-tags { display: flex; gap: 6px; flex-wrap: wrap; margin-top: 10px; }
  .dp-tag { padding: 3px 10px; border-radius: 20px; font-size: 0.62rem; font-weight: 700; }
  .dp-tag.green { background: var(--green-light); color: #008c69; border: 1px solid var(--border-green); }
  .dp-tag.gray { background: var(--bg2); color: var(--muted); border: 1px solid var(--border); }

  .dp-fin-link { display: flex; align-items: center; gap: 6px; margin-top: 10px; padding: 9px 14px; background: var(--navy); border-radius: 10px; color: var(--green); font-size: 0.75rem; font-weight: 600; text-decoration: none; }
  .dp-fin-link:hover { opacity: 0.85; }
  .loading-state { text-align: center; padding: 40px 20px; color: var(--muted); font-size: 0.85rem; }
  .empty-state { text-align: center; padding: 40px 20px; color: var(--muted); font-size: 0.85rem; }
  @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
</style>
</head>
<body>
<div class="phone">

  <div class="header">
    <div class="logo-mark">
      <div class="logo-icon">LF</div>
      <div class="logo-text">Literacia <span>Financeira</span></div>
    </div>
    <div class="header-right">
      <div class="icon-btn">üîî</div>
      <div class="icon-btn">‚öôÔ∏è</div>
    </div>
  </div>

  <div class="sub-tab-bar" id="sub-tab-bar"></div>

  <div class="scroll-area">

    <!-- ======== SIMULAR: SAL√ÅRIO ======== -->
    <div class="tab-content active" id="tab-salario">
      <div class="hero-card">
        <div class="hero-label">Calculadora Fiscal</div>
        <div class="hero-value"><span class="accent" id="hero-liquido">‚Äî</span></div>
        <div class="hero-sub">Sal√°rio l√≠quido estimado mensal</div>
        <div class="hero-badge">‚ú¶ Tabelas IRS 2025</div>
      </div>
      <div class="sim-card">
        <div class="sim-card-title"><div class="sim-icon">üí∂</div>Sal√°rio L√≠quido</div>
        <div class="input-group"><div class="input-label">Sal√°rio Bruto Mensal</div><div class="input-wrapper"><input class="input-field" type="number" id="sal-bruto" placeholder="2000" value="2000"><span class="input-unit">‚Ç¨</span></div></div>
        <div class="chip-row" id="irs-chips">
          <div class="chip active" onclick="selectChip(this,'irs-chips')">Solteiro</div>
          <div class="chip" onclick="selectChip(this,'irs-chips')">Casado 1T</div>
          <div class="chip" onclick="selectChip(this,'irs-chips')">Casado 2T</div>
        </div>
        <div class="input-group"><div class="input-label">Dependentes</div><div class="input-wrapper"><input class="input-field" type="number" id="dependentes" placeholder="0" value="0" min="0"><span class="input-unit">#</span></div></div>
        <button class="calc-btn" onclick="calcSalario()">Calcular L√≠quido</button>
        <div class="result-grid" id="sal-results" style="display:none">
          <div class="result-box highlight" style="grid-column:1/-1"><div class="result-label">Sal√°rio L√≠quido</div><div class="result-value" id="res-liquido">‚Äî</div></div>
          <div class="result-box"><div class="result-label">Reten√ß√£o IRS</div><div class="result-value" id="res-irs">‚Äî</div></div>
          <div class="result-box"><div class="result-label">Seg. Social</div><div class="result-value" id="res-ss">‚Äî</div></div>
          <div class="result-box" style="grid-column:1/-1"><div class="result-label">Total Descontos</div><div class="result-value" id="res-desc">‚Äî</div></div>
        </div>
      </div>
    </div>

    <!-- ======== SIMULAR: TAXA ESFOR√áO ======== -->
    <div class="tab-content" id="tab-esforco">
      <div class="hero-card">
        <div class="hero-label">Sa√∫de Financeira</div>
        <div class="hero-value"><span class="accent" id="hero-esforco">‚Äî</span></div>
        <div class="hero-sub">Taxa de esfor√ßo dos teus cr√©ditos</div>
        <div class="hero-badge">üìä Recomendado ‚â§ 33%</div>
      </div>
      <div class="sim-card">
        <div class="sim-card-title"><div class="sim-icon">üìä</div>Taxa de Esfor√ßo</div>
        <div class="input-group"><div class="input-label">Rendimento L√≠quido Mensal</div><div class="input-wrapper"><input class="input-field" type="number" id="esf-rend" placeholder="1500"><span class="input-unit">‚Ç¨</span></div></div>
        <div class="input-group"><div class="input-label">Total de Presta√ß√µes de Cr√©dito</div><div class="input-wrapper"><input class="input-field" type="number" id="esf-prest" placeholder="400"><span class="input-unit">‚Ç¨</span></div></div>
        <button class="calc-btn" onclick="calcEsforco()">Calcular Taxa</button>
        <div class="result-grid" id="esf-results" style="display:none">
          <div class="result-box highlight" style="grid-column:1/-1"><div class="result-label">Taxa de Esfor√ßo</div><div class="result-value" id="res-esforco">‚Äî</div></div>
          <div class="result-box" style="grid-column:1/-1"><div class="result-label">Avalia√ß√£o</div><div class="result-value" id="esf-status">‚Äî</div></div>
        </div>
        <div class="progress-bar" id="esf-bar" style="display:none"><div class="progress-fill" id="esf-fill" style="width:0%"></div></div>
      </div>
    </div>

    <!-- ======== SIMULAR: IMT ======== -->
    <div class="tab-content" id="tab-imt">
      <div class="hero-card">
        <div class="hero-label">Impostos na Compra</div>
        <div class="hero-value"><span class="accent" id="hero-imt">‚Äî</span></div>
        <div class="hero-sub">IMT + Imposto de Selo estimado</div>
        <div class="hero-badge">üè† Tabelas 2025</div>
      </div>
      <div class="sim-card">
        <div class="sim-card-title"><div class="sim-icon">üè†</div>IMT + Imposto de Selo</div>
        <div class="input-group"><div class="input-label">Valor do Im√≥vel</div><div class="input-wrapper"><input class="input-field" type="number" id="imt-valor" placeholder="200000"><span class="input-unit">‚Ç¨</span></div></div>
        <div class="chip-row" id="imt-chips">
          <div class="chip active" onclick="selectChip(this,'imt-chips')">Habita√ß√£o Pr√≥pria</div>
          <div class="chip" onclick="selectChip(this,'imt-chips')">Secund√°ria</div>
        </div>
        <button class="calc-btn" onclick="calcIMT()">Calcular Impostos</button>
        <div class="result-grid" id="imt-results" style="display:none">
          <div class="result-box"><div class="result-label">IMT</div><div class="result-value" id="res-imt">‚Äî</div></div>
          <div class="result-box"><div class="result-label">Imposto de Selo</div><div class="result-value" id="res-selo">‚Äî</div></div>
          <div class="result-box highlight" style="grid-column:1/-1"><div class="result-label">Total a Pagar</div><div class="result-value" id="res-imt-total">‚Äî</div></div>
        </div>
      </div>
    </div>

    <!-- ======== SIMULAR: POUPAN√áA (simulator) ======== -->
    <div class="tab-content" id="tab-sim-poupanca">
      <div class="hero-card">
        <div class="hero-label">Simulador de Poupan√ßa</div>
        <div class="hero-value"><span class="accent" id="hero-poup">‚Äî</span></div>
        <div class="hero-sub">Valor final l√≠quido ap√≥s impostos</div>
        <div class="hero-badge">üè¶ Com reten√ß√£o na fonte</div>
      </div>
      <div class="sim-card">
        <div class="sim-card-title"><div class="sim-icon">üè¶</div>Poupan√ßa com Juro Composto</div>

        <div class="info-box">üí° Os juros de poupan√ßas s√£o sujeitos a <strong>reten√ß√£o na fonte de 28%</strong> em Portugal. A capitaliza√ß√£o aplica reten√ß√£o em cada per√≠odo.</div>

        <div class="input-group"><div class="input-label">Capital Inicial</div><div class="input-wrapper"><input class="input-field" type="number" id="p-capital" placeholder="5000" value="5000"><span class="input-unit">‚Ç¨</span></div></div>
        <div class="input-group"><div class="input-label">Dep√≥sito Mensal Adicional</div><div class="input-wrapper"><input class="input-field" type="number" id="p-mensal" placeholder="200" value="200"><span class="input-unit">‚Ç¨</span></div></div>
        <div class="input-group"><div class="input-label">Taxa de Juro Bruta Anual</div><div class="input-wrapper"><input class="input-field" type="number" id="p-taxa" placeholder="3.5" value="3.5" step="0.1"><span class="input-unit">%</span></div></div>

        <div class="input-group">
          <div class="input-label">
            Taxa de Reten√ß√£o na Fonte
            <span class="retention-tag">‚ö†Ô∏è Estado fica</span>
          </div>
          <div class="input-wrapper"><input class="input-field" type="number" id="p-retencao" placeholder="28" value="28" step="1"><span class="input-unit">%</span></div>
        </div>

        <div class="input-group"><div class="input-label">Capitaliza√ß√£o dos Juros</div></div>
        <div class="chip-row" id="p-cap-chips">
          <div class="chip" onclick="selectChip(this,'p-cap-chips')">Mensal</div>
          <div class="chip" onclick="selectChip(this,'p-cap-chips')">3 Meses</div>
          <div class="chip active" onclick="selectChip(this,'p-cap-chips')">6 Meses</div>
          <div class="chip" onclick="selectChip(this,'p-cap-chips')">12 Meses</div>
        </div>

        <div class="input-group"><div class="input-label">Per√≠odo Total</div><div class="input-wrapper"><input class="input-field" type="number" id="p-anos" placeholder="5" value="5"><span class="input-unit">anos</span></div></div>

        <button class="calc-btn" onclick="calcPoupanca()">Calcular Poupan√ßa</button>

        <div id="p-results" style="display:none">
          <div class="result-grid">
            <div class="result-box highlight" style="grid-column:1/-1"><div class="result-label">Valor Final L√≠quido</div><div class="result-value" id="res-p-liquido">‚Äî</div></div>
            <div class="result-box"><div class="result-label">Capital Depositado</div><div class="result-value" id="res-p-depositado">‚Äî</div></div>
            <div class="result-box"><div class="result-label">Juros Brutos</div><div class="result-value" id="res-p-juros-brutos">‚Äî</div></div>
            <div class="result-box highlight-red"><div class="result-label">Reten√ß√£o (Estado)</div><div class="result-value" id="res-p-retencao">‚Äî</div></div>
            <div class="result-box"><div class="result-label">Juros L√≠quidos</div><div class="result-value" id="res-p-juros-liq">‚Äî</div></div>
          </div>
          <div class="mortgage-breakdown" style="margin-top:12px">
            <div class="breakdown-title">Detalhe por Per√≠odo</div>
            <div class="breakdown-row"><span class="key">Taxa L√≠quida Efetiva</span><span class="val green" id="bd-p-taxa-liq">‚Äî</span></div>
            <div class="breakdown-row"><span class="key">Capitaliza√ß√£o</span><span class="val" id="bd-p-cap">‚Äî</span></div>
            <div class="breakdown-row"><span class="key">N¬∫ de Per√≠odos</span><span class="val" id="bd-p-periodos">‚Äî</span></div>
            <div class="breakdown-row"><span class="key">Rentabilidade Total</span><span class="val green" id="bd-p-rentab">‚Äî</span></div>
          </div>
        </div>
      </div>
    </div>

    <!-- ======== SIMULAR: INVESTIMENTO ======== -->
    <div class="tab-content" id="tab-investimento">
      <div class="hero-card">
        <div class="hero-label">Retorno de Capital</div>
        <div class="hero-value"><span class="accent" id="hero-inv">‚Äî</span></div>
        <div class="hero-sub">Valor final l√≠quido ap√≥s impostos</div>
        <div class="hero-badge">üìä Mais-valias e dividendos</div>
      </div>
      <div class="sim-card">
        <div class="sim-card-title"><div class="sim-icon">üìà</div>Simulador de Investimento</div>

        <div class="info-box">üí° Mais-valias e dividendos de fundos/a√ß√µes est√£o sujeitos a <strong>28% de imposto</strong> em Portugal (ou englobamento).</div>

        <div class="input-group"><div class="input-label">Capital Investido</div><div class="input-wrapper"><input class="input-field" type="number" id="inv-capital" placeholder="10000" value="10000"><span class="input-unit">‚Ç¨</span></div></div>
        <div class="input-group"><div class="input-label">Refor√ßo Mensal</div><div class="input-wrapper"><input class="input-field" type="number" id="inv-mensal" placeholder="0" value="0"><span class="input-unit">‚Ç¨</span></div></div>
        <div class="input-group"><div class="input-label">Rentabilidade Anual Bruta</div><div class="input-wrapper"><input class="input-field" type="number" id="inv-taxa" placeholder="7" value="7" step="0.5"><span class="input-unit">%</span></div></div>
        <div class="input-group">
          <div class="input-label">
            Taxa de Reten√ß√£o / Imposto
            <span class="retention-tag">‚ö†Ô∏è Estado fica</span>
          </div>
          <div class="input-wrapper"><input class="input-field" type="number" id="inv-retencao" placeholder="28" value="28" step="1"><span class="input-unit">%</span></div>
        </div>
        <div class="input-group"><div class="input-label">Horizonte Temporal</div><div class="input-wrapper"><input class="input-field" type="number" id="inv-anos" placeholder="20" value="20"><span class="input-unit">anos</span></div></div>

        <button class="calc-btn" onclick="calcInvestimento()">Simular Investimento</button>

        <div id="inv-results" style="display:none">
          <div class="result-grid">
            <div class="result-box highlight" style="grid-column:1/-1"><div class="result-label">Valor Final L√≠quido</div><div class="result-value" id="res-inv-liq">‚Äî</div></div>
            <div class="result-box"><div class="result-label">Total Investido</div><div class="result-value" id="res-inv-dep">‚Äî</div></div>
            <div class="result-box"><div class="result-label">Ganho Bruto</div><div class="result-value" id="res-inv-bruto">‚Äî</div></div>
            <div class="result-box highlight-red"><div class="result-label">Imposto (Estado)</div><div class="result-value" id="res-inv-imposto">‚Äî</div></div>
            <div class="result-box"><div class="result-label">Ganho L√≠quido</div><div class="result-value" id="res-inv-liquido">‚Äî</div></div>
          </div>
          <div class="mortgage-breakdown" style="margin-top:12px">
            <div class="breakdown-title">Detalhe</div>
            <div class="breakdown-row"><span class="key">Taxa L√≠quida Efetiva</span><span class="val green" id="bd-inv-taxa-liq">‚Äî</span></div>
            <div class="breakdown-row"><span class="key">Multiplicador do Capital</span><span class="val" id="bd-inv-mult">‚Äî</span></div>
            <div class="breakdown-row"><span class="key">Rentabilidade L√≠quida</span><span class="val green" id="bd-inv-rentab">‚Äî</span></div>
          </div>
        </div>
      </div>
    </div>

    <!-- ======== SIMULAR: INFLA√á√ÉO ======== -->
    <div class="tab-content" id="tab-inflacao">
      <div class="hero-card">
        <div class="hero-label">Poder de Compra</div>
        <div class="hero-value"><span class="accent" id="hero-inf">‚Äî</span></div>
        <div class="hero-sub">Valor real futuro do teu dinheiro</div>
        <div class="hero-badge">üìâ Impacto da infla√ß√£o</div>
      </div>
      <div class="sim-card">
        <div class="sim-card-title"><div class="sim-icon">üìâ</div>Eros√£o pela Infla√ß√£o</div>
        <div class="input-group"><div class="input-label">Valor Atual</div><div class="input-wrapper"><input class="input-field" type="number" id="inf-valor" placeholder="100000" value="100000"><span class="input-unit">‚Ç¨</span></div></div>
        <div class="input-group"><div class="input-label">Taxa de Infla√ß√£o Anual</div><div class="input-wrapper"><input class="input-field" type="number" id="inf-taxa" placeholder="2.5" value="2.5" step="0.1"><span class="input-unit">%</span></div></div>
        <div class="input-group"><div class="input-label">Per√≠odo</div><div class="input-wrapper"><input class="input-field" type="number" id="inf-anos" placeholder="10" value="10"><span class="input-unit">anos</span></div></div>
        <button class="calc-btn" onclick="calcInflacao()">Calcular Impacto</button>
        <div class="result-grid" id="inf-results" style="display:none">
          <div class="result-box highlight" style="grid-column:1/-1"><div class="result-label">Poder de Compra Futuro</div><div class="result-value" id="res-inf-futuro">‚Äî</div></div>
          <div class="result-box" style="grid-column:1/-1"><div class="result-label">Perda de Valor Real</div><div class="result-value" id="res-inf-perda" style="color:var(--red)">‚Äî</div></div>
        </div>
      </div>
    </div>

    <!-- ======== POUPAN√áA: DEP√ìSITOS A PRAZO ======== -->
    <div class="tab-content" id="tab-dep-prazo">
      <div class="hero-card" id="dp-hero">
        <div class="hero-label">Melhor Dep√≥sito a Prazo</div>
        <div class="hero-value"><span class="accent" id="dp-best-rate">‚Äî</span></div>
        <div class="hero-sub" id="dp-best-sub">A carregar...</div>
        <div class="hero-badge">‚ö†Ô∏è Reten√ß√£o 28% sobre juros</div>
      </div>

      <div class="info-box">‚ö†Ô∏è Juros sujeitos a <strong>reten√ß√£o na fonte de 28%</strong>. A TANL √© o que efetivamente recebes.</div>

      <div class="filter-block">
        <div class="filter-row">
          <div class="filter-toggle" id="ft-novos-capitais" onclick="toggleFilter('novos_capitais')"><div class="ft-dot"></div><span class="ft-label">Novos Capitais</span></div>
          <div class="filter-toggle" id="ft-novos-clientes" onclick="toggleFilter('novos_clientes')"><div class="ft-dot"></div><span class="ft-label">Novos Clientes</span></div>
          <div class="sort-btn" onclick="toggleSort()" id="sort-btn">‚Üì TANB</div>
        </div>
        <div class="filter-row" style="gap:8px;margin-top:8px;">
          <div class="filter-input-wrap">
            <span class="fi-label">Dep. M√≠n. ‚â§</span>
            <input class="fi-input" type="number" id="f-dep-min" placeholder="ex: 1000" oninput="applyFilters()">
            <span class="fi-unit">‚Ç¨</span>
          </div>
          <div class="filter-input-wrap">
            <span class="fi-label">Dep. M√°x. ‚â•</span>
            <input class="fi-input" type="number" id="f-dep-max" placeholder="ex: 50000" oninput="applyFilters()">
            <span class="fi-unit">‚Ç¨</span>
          </div>
        </div>
        <div class="results-count" id="dp-count"></div>
      </div>

      <div id="dp-list"><div class="loading-state">‚è≥ A carregar dep√≥sitos...</div></div>
    </div>

    <!-- PLACEHOLDER removed old cards -->
    <div style="display:none" id="dp-placeholder">

      <div class="product-card">
        <div class="product-header">
          <div class="product-left"><div class="product-logo">ACTV</div><div><div class="product-name">Activobank</div><div class="product-type">Poupan√ßa Online ¬∑ 12M</div></div></div>
          <div><div class="product-rate">3.50%</div><div class="product-rate-label">TANB bruta</div></div>
        </div>
        <div class="product-detail-row"><span class="dk">Taxa L√≠quida (ap√≥s 28%)</span><span class="dv green">2.52%</span></div>
        <div class="product-detail-row"><span class="dk">Reten√ß√£o Estado (por ‚Ç¨1.000)</span><span class="dv red">9.80 ‚Ç¨</span></div>
        <div class="product-detail-row"><span class="dk">Juros L√≠quidos (por ‚Ç¨1.000)</span><span class="dv">25.20 ‚Ç¨</span></div>
        <div class="product-detail-row"><span class="dk">Capitaliza√ß√£o</span><span class="dv">No vencimento</span></div>
      </div>

      <div class="product-card">
        <div class="product-header">
          <div class="product-left"><div class="product-logo">CGD</div><div><div class="product-name">Caixa Geral Dep.</div><div class="product-type">Dep√≥sito a Prazo ¬∑ 12M</div></div></div>
          <div><div class="product-rate">3.25%</div><div class="product-rate-label">TANB bruta</div></div>
        </div>
        <div class="product-detail-row"><span class="dk">Taxa L√≠quida (ap√≥s 28%)</span><span class="dv green">2.34%</span></div>
        <div class="product-detail-row"><span class="dk">Reten√ß√£o Estado (por ‚Ç¨1.000)</span><span class="dv red">9.10 ‚Ç¨</span></div>
        <div class="product-detail-row"><span class="dk">Juros L√≠quidos (por ‚Ç¨1.000)</span><span class="dv">23.40 ‚Ç¨</span></div>
        <div class="product-detail-row"><span class="dk">Capitaliza√ß√£o</span><span class="dv">No vencimento</span></div>
      </div>

      <div class="product-card">
        <div class="product-header">
          <div class="product-left"><div class="product-logo">BPI</div><div><div class="product-name">Banco BPI</div><div class="product-type">Dep√≥sito a Prazo ¬∑ 12M</div></div></div>
          <div><div class="product-rate">3.00%</div><div class="product-rate-label">TANB bruta</div></div>
        </div>
        <div class="product-detail-row"><span class="dk">Taxa L√≠quida (ap√≥s 28%)</span><span class="dv green">2.16%</span></div>
        <div class="product-detail-row"><span class="dk">Reten√ß√£o Estado (por ‚Ç¨1.000)</span><span class="dv red">8.40 ‚Ç¨</span></div>
        <div class="product-detail-row"><span class="dk">Juros L√≠quidos (por ‚Ç¨1.000)</span><span class="dv">21.60 ‚Ç¨</span></div>
        <div class="product-detail-row"><span class="dk">Capitaliza√ß√£o</span><span class="dv">No vencimento</span></div>
      </div>

      <div class="product-card" style="margin-bottom:20px">
        <div class="product-header">
          <div class="product-left"><div class="product-logo">BCP</div><div><div class="product-name">Millennium BCP</div><div class="product-type">Dep√≥sito a Prazo ¬∑ 12M</div></div></div>
          <div><div class="product-rate">2.85%</div><div class="product-rate-label">TANB bruta</div></div>
        </div>
        <div class="product-detail-row"><span class="dk">Taxa L√≠quida (ap√≥s 28%)</span><span class="dv green">2.05%</span></div>
        <div class="product-detail-row"><span class="dk">Reten√ß√£o Estado (por ‚Ç¨1.000)</span><span class="dv red">7.98 ‚Ç¨</span></div>
        <div class="product-detail-row"><span class="dk">Juros L√≠quidos (por ‚Ç¨1.000)</span><span class="dv">20.52 ‚Ç¨</span></div>
        <div class="product-detail-row"><span class="dk">Capitaliza√ß√£o</span><span class="dv">No vencimento</span></div>
</div>

    <!-- ======== POUPAN√áA: CERTIFICADOS / D√çVIDA P√öBLICA ======== -->
    <div class="tab-content" id="tab-certificados">
      <div class="hero-card">
        <div class="hero-label">D√≠vida P√∫blica Portuguesa</div>
        <div class="hero-value"><span class="accent">3.50%</span></div>
        <div class="hero-sub">Certificados de Aforro ¬∑ S√©rie E ¬∑ l√≠quido: 2.52%</div>
        <div class="hero-badge">üáµüáπ Garantido pelo Estado</div>
      </div>

      <div class="info-box">‚ö†Ô∏è Os Certificados de Aforro e do Tesouro tamb√©m est√£o sujeitos a <strong>reten√ß√£o na fonte de 28%</strong> sobre os juros creditados.</div>

      <p class="section-title">Certificados de Aforro</p>

      <div class="product-card">
        <div class="product-header">
          <div class="product-left"><div class="product-logo">CA</div><div><div class="product-name">Certificados de Aforro</div><div class="product-type">S√©rie E ‚Äî capitaliza√ß√£o anual</div></div></div>
          <div><div class="product-rate">3.50%</div><div class="product-rate-label">TANB bruta</div></div>
        </div>
        <div class="product-detail-row"><span class="dk">Taxa L√≠quida (ap√≥s 28%)</span><span class="dv green">2.52%</span></div>
        <div class="product-detail-row"><span class="dk">Reten√ß√£o Estado (por ‚Ç¨1.000)</span><span class="dv red">9.80 ‚Ç¨/ano</span></div>
        <div class="product-detail-row"><span class="dk">Capitaliza√ß√£o</span><span class="dv">Anual (12M)</span></div>
        <div class="product-detail-row"><span class="dk">Prazo M√≠nimo</span><span class="dv">3 meses</span></div>
        <div class="product-detail-row"><span class="dk">Garantia</span><span class="dv green">Estado Portugu√™s</span></div>
      </div>

      <p class="section-title">Certificados do Tesouro</p>

      <div class="product-card" style="margin-bottom:20px">
        <div class="product-header">
          <div class="product-left"><div class="product-logo">CT</div><div><div class="product-name">Certificados do Tesouro</div><div class="product-type">CTPP ‚Äî 10 anos</div></div></div>
          <div><div class="product-rate">3.25%</div><div class="product-rate-label">ano 1 bruta</div></div>
        </div>
        <div class="product-detail-row"><span class="dk">Taxa L√≠quida Ano 1 (ap√≥s 28%)</span><span class="dv green">2.34%</span></div>
        <div class="product-detail-row"><span class="dk">Taxa Bruta Ano 5</span><span class="dv">3.50%</span></div>
        <div class="product-detail-row"><span class="dk">Taxa Bruta Ano 10</span><span class="dv">3.75%</span></div>
        <div class="product-detail-row"><span class="dk">Reten√ß√£o</span><span class="dv red">28% sobre juros</span></div>
        <div class="product-detail-row"><span class="dk">Capitaliza√ß√£o</span><span class="dv">Anual</span></div>
        <div class="product-detail-row"><span class="dk">Garantia</span><span class="dv green">Estado Portugu√™s</span></div>
      </div>
    </div>

    <!-- ======== POUPAN√áA: FUNDOS ======== -->
    <div class="tab-content" id="tab-fundos">
      <div class="hero-card">
        <div class="hero-label">Fundos de Investimento</div>
        <div class="hero-value">Retorno <span class="accent">vari√°vel</span></div>
        <div class="hero-sub">Rentabilidade hist√≥rica e tributa√ß√£o</div>
        <div class="hero-badge">üìä Imposto 28% sobre mais-valias</div>
      </div>

      <div class="info-box">‚ö†Ô∏è As mais-valias e dividendos de fundos est√£o sujeitos a <strong>28% de imposto</strong> em Portugal. ETFs domiciliados na Irlanda/Luxemburgo podem ter reten√ß√£o adicional na fonte.</div>

      <p class="section-title">Fundos / ETFs Populares em Portugal</p>

      <div class="product-card">
        <div class="product-header">
          <div class="product-left"><div class="product-logo" style="font-size:0.5rem">VWCE</div><div><div class="product-name">Vanguard FTSE All-World</div><div class="product-type">ETF Acumula√ß√£o ¬∑ IE</div></div></div>
          <div><div class="product-rate">~9%</div><div class="product-rate-label">retorno m√©dio</div></div>
        </div>
        <div class="product-detail-row"><span class="dk">Reten√ß√£o dividendos (IE‚ÜíPT)</span><span class="dv amber">15% + 28%</span></div>
        <div class="product-detail-row"><span class="dk">Imposto Mais-valias</span><span class="dv red">28%</span></div>
        <div class="product-detail-row"><span class="dk">TER (custo anual)</span><span class="dv">0.22%</span></div>
        <div class="product-detail-row"><span class="dk">Distribui√ß√£o</span><span class="dv">Acumula√ß√£o</span></div>
      </div>

      <div class="product-card">
        <div class="product-header">
          <div class="product-left"><div class="product-logo" style="font-size:0.5rem">IWDA</div><div><div class="product-name">iShares Core MSCI World</div><div class="product-type">ETF Acumula√ß√£o ¬∑ IE</div></div></div>
          <div><div class="product-rate">~10%</div><div class="product-rate-label">retorno m√©dio</div></div>
        </div>
        <div class="product-detail-row"><span class="dk">Imposto Mais-valias</span><span class="dv red">28%</span></div>
        <div class="product-detail-row"><span class="dk">TER (custo anual)</span><span class="dv">0.20%</span></div>
        <div class="product-detail-row"><span class="dk">Distribui√ß√£o</span><span class="dv">Acumula√ß√£o</span></div>
      </div>

      <div class="product-card">
        <div class="product-header">
          <div class="product-left"><div class="product-logo" style="font-size:0.5rem">PPR</div><div><div class="product-name">PPR ‚Äî Plano Poupan√ßa Reform.</div><div class="product-type">Benef√≠cio fiscal dedu√ß√£o IRS</div></div></div>
          <div><div class="product-rate">vari√°vel</div><div class="product-rate-label">depende do fundo</div></div>
        </div>
        <div class="product-detail-row"><span class="dk">Reten√ß√£o se resgate antes 5 anos</span><span class="dv red">21.5%</span></div>
        <div class="product-detail-row"><span class="dk">Reten√ß√£o ap√≥s 5 anos</span><span class="dv green">8%</span></div>
        <div class="product-detail-row"><span class="dk">Dedu√ß√£o IRS (at√© 400‚Ç¨)</span><span class="dv green">20% de benef√≠cio</span></div>
        <div class="product-detail-row"><span class="dk">Vantagem fiscal</span><span class="dv green">Alta se longo prazo</span></div>
      </div>

    </div>

    <!-- ======== CR√âDITO HABITA√á√ÉO ======== -->
    <div class="tab-content" id="tab-credito">
      <div class="hero-card">
        <div class="hero-label">Presta√ß√£o Estimada</div>
        <div class="hero-value"><span class="accent" id="cred-hero">‚Äî</span></div>
        <div class="hero-sub">Cr√©dito habita√ß√£o ¬∑ Euribor + Spread</div>
        <div class="hero-badge">üè† Simula√ß√£o completa</div>
      </div>
      <div class="sim-card">
        <div class="sim-card-title"><div class="sim-icon">üèóÔ∏è</div>Simulador Hipotec√°rio</div>
        <div class="input-group"><div class="input-label">Valor do Im√≥vel</div><div class="input-wrapper"><input class="input-field" type="number" id="cred-imovel" placeholder="250000" value="250000"><span class="input-unit">‚Ç¨</span></div></div>
        <div class="input-group"><div class="input-label">Entrada</div><div class="input-wrapper"><input class="input-field" type="number" id="cred-entrada" placeholder="50000" value="50000"><span class="input-unit">‚Ç¨</span></div></div>
        <div class="input-group"><div class="input-label">Euribor</div><div class="input-wrapper"><input class="input-field" type="number" id="cred-euribor" placeholder="2.65" value="2.65" step="0.01"><span class="input-unit">%</span></div></div>
        <div class="input-group"><div class="input-label">Spread do Banco</div><div class="input-wrapper"><input class="input-field" type="number" id="cred-spread" placeholder="1.0" value="1.0" step="0.1"><span class="input-unit">%</span></div></div>
        <div class="chip-row" id="prazo-chips">
          <div class="chip" onclick="selectChip(this,'prazo-chips');document.getElementById('cred-prazo').value=15">15 anos</div>
          <div class="chip active" onclick="selectChip(this,'prazo-chips');document.getElementById('cred-prazo').value=30">30 anos</div>
          <div class="chip" onclick="selectChip(this,'prazo-chips');document.getElementById('cred-prazo').value=40">40 anos</div>
        </div>
        <div class="input-group"><div class="input-label">Prazo Personalizado</div><div class="input-wrapper"><input class="input-field" type="number" id="cred-prazo" placeholder="30" value="30"><span class="input-unit">anos</span></div></div>
        <button class="calc-btn" onclick="calcCredito()">Simular Cr√©dito Habita√ß√£o</button>
        <div class="mortgage-breakdown" id="cred-breakdown" style="display:none">
          <div class="breakdown-title">Resumo do Cr√©dito</div>
          <div class="breakdown-row"><span class="key">Presta√ß√£o Mensal</span><span class="val green" id="bd-prestacao">‚Äî</span></div>
          <div class="breakdown-row"><span class="key">Capital Financiado</span><span class="val" id="bd-capital">‚Äî</span></div>
          <div class="breakdown-row"><span class="key">TAN Total</span><span class="val" id="bd-tan">‚Äî</span></div>
          <div class="breakdown-row"><span class="key">Total a Pagar</span><span class="val" id="bd-total">‚Äî</span></div>
          <div class="breakdown-row"><span class="key">Juros Totais</span><span class="val red" id="bd-juros">‚Äî</span></div>
          <div class="breakdown-row"><span class="key">LTV</span><span class="val" id="bd-ltv">‚Äî</span></div>
        </div>
      </div>
    </div>

    <!-- ======== TAXAS: EURIBOR ======== -->
    <div class="tab-content" id="tab-euribor">
      <div class="hero-card">
        <div class="hero-label">Euribor 12M ¬∑ Fevereiro 2025</div>
        <div class="hero-value"><span class="accent">2.65%</span></div>
        <div class="hero-sub">Actualizado mensalmente pela equipa</div>
        <div class="hero-badge down">‚ñº ‚àí0.08% vs m√™s anterior</div>
      </div>
      <p class="section-title">Euribor por Prazo</p>
      <div class="euribor-strip">
        <div class="euribor-box"><div class="euribor-label">3 Meses</div><div class="euribor-val">2.41%</div><div class="euribor-change down">‚ñº ‚àí0.05%</div></div>
        <div class="euribor-box"><div class="euribor-label">6 Meses</div><div class="euribor-val">2.52%</div><div class="euribor-change down">‚ñº ‚àí0.06%</div></div>
        <div class="euribor-box"><div class="euribor-label">12 Meses</div><div class="euribor-val">2.65%</div><div class="euribor-change down">‚ñº ‚àí0.08%</div></div>
      </div>
    </div>

    <!-- ======== TAXAS: SPREADS ======== -->
    <div class="tab-content" id="tab-spreads">
      <div class="hero-card">
        <div class="hero-label">Melhor Spread</div>
        <div class="hero-value"><span class="accent">0.85%</span></div>
        <div class="hero-sub">Caixa Geral de Dep√≥sitos</div>
        <div class="hero-badge">üè† Cr√©dito Habita√ß√£o</div>
      </div>
      <p class="section-title">Spreads ‚Äî Cr√©dito Habita√ß√£o</p>
      <div class="rate-card"><div class="rate-left"><div class="rate-logo">CGD</div><div><div class="rate-name">Caixa Geral Dep.</div><div class="rate-type">Cr√©dito Habita√ß√£o</div></div></div><div><div class="rate-value">0.85%</div><div class="rate-period">spread</div></div></div>
      <div class="rate-card"><div class="rate-left"><div class="rate-logo">BPI</div><div><div class="rate-name">Banco BPI</div><div class="rate-type">Cr√©dito Habita√ß√£o</div></div></div><div><div class="rate-value">0.95%</div><div class="rate-period">spread</div></div></div>
      <div class="rate-card"><div class="rate-left"><div class="rate-logo">SNT</div><div><div class="rate-name">Santander</div><div class="rate-type">Cr√©dito Habita√ß√£o</div></div></div><div><div class="rate-value">1.00%</div><div class="rate-period">spread</div></div></div>
      <div class="rate-card" style="margin-bottom:20px"><div class="rate-left"><div class="rate-logo">NVB</div><div><div class="rate-name">Novobanco</div><div class="rate-type">Cr√©dito Habita√ß√£o</div></div></div><div><div class="rate-value">1.10%</div><div class="rate-period">spread</div></div></div>
    </div>

  </div><!-- end scroll -->

  <div class="bottom-nav">
    <button class="nav-btn active" onclick="switchSection('simular', this)">
      <div class="nav-icon">üßÆ</div><div class="nav-label">Simular</div>
    </button>
    <button class="nav-btn" onclick="switchSection('poupanca', this)">
      <div class="nav-icon">üè¶</div><div class="nav-label">Poupan√ßa</div>
    </button>
    <button class="nav-btn" onclick="switchSection('credito', this)">
      <div class="nav-icon">üè†</div><div class="nav-label">Cr√©dito</div>
    </button>
    <button class="nav-btn" onclick="switchSection('taxas', this)">
      <div class="nav-icon">üìà</div><div class="nav-label">Taxas</div>
    </button>
  </div>

</div>

<script>
const sections = {
  simular: {
    tabs: [
      { label: 'Sal√°rio L√≠quido', id: 'salario' },
      { label: 'Taxa de Esfor√ßo', id: 'esforco' },
      { label: 'IMT', id: 'imt' },
      { label: 'Poupan√ßa', id: 'sim-poupanca' },
      { label: 'Investimento', id: 'investimento' },
      { label: 'Infla√ß√£o', id: 'inflacao' },
    ],
    default: 'salario'
  },
  poupanca: {
    tabs: [
      { label: 'Dep√≥sitos a Prazo', id: 'dep-prazo' },
      { label: 'Certificados', id: 'certificados' },
      { label: 'Fundos & ETFs', id: 'fundos' },
    ],
    default: 'dep-prazo'
  },
  credito: {
    tabs: [{ label: 'Cr√©dito Habita√ß√£o', id: 'credito' }],
    default: 'credito'
  },
  taxas: {
    tabs: [
      { label: 'Euribor', id: 'euribor' },
      { label: 'Spreads', id: 'spreads' },
    ],
    default: 'euribor'
  }
};

function renderSubTabs(section, activeId) {
  const bar = document.getElementById('sub-tab-bar');
  bar.innerHTML = '';
  sections[section].tabs.forEach(t => {
    const btn = document.createElement('button');
    btn.className = 'sub-tab-btn' + (t.id === activeId ? ' active' : '');
    btn.textContent = t.label;
    btn.onclick = () => {
      document.querySelectorAll('.sub-tab-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      showTab(t.id);
    };
    bar.appendChild(btn);
  });
}

function switchSection(section, navBtn) {
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  navBtn.classList.add('active');
  const def = sections[section].default;
  renderSubTabs(section, def);
  showTab(def);
}

function showTab(tabId) {
  document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
  const el = document.getElementById('tab-' + tabId);
  if (el) el.classList.add('active');
  maybeLoadDeposits(tabId);
}

renderSubTabs('simular', 'salario');

function selectChip(el, group) {
  document.querySelectorAll('#' + group + ' .chip').forEach(c => c.classList.remove('active'));
  el.classList.add('active');
}

const fmt = v => v.toLocaleString('pt-PT', {minimumFractionDigits:2, maximumFractionDigits:2}) + ' ‚Ç¨';
const fmtPct = v => v.toFixed(2) + '%';

// SAL√ÅRIO
function calcSalario() {
  const bruto = parseFloat(document.getElementById('sal-bruto').value) || 0;
  const ss = bruto * 0.11;
  const base_irs = bruto - ss;
  let irs = 0;
  if (base_irs <= 792) irs = 0;
  else if (base_irs <= 10700) irs = base_irs * 0.1325 - 102.64;
  else if (base_irs <= 15216) irs = base_irs * 0.18 - 710.77;
  else if (base_irs <= 19696) irs = base_irs * 0.23 - 1472.37;
  else if (base_irs <= 25076) irs = base_irs * 0.26 - 2063.29;
  else if (base_irs <= 36757) irs = base_irs * 0.3275 - 4006.36;
  else if (base_irs <= 48033) irs = base_irs * 0.37 - 5563.82;
  else if (base_irs <= 75009) irs = base_irs * 0.435 - 8682.49;
  else irs = base_irs * 0.48 - 12439.74;
  irs = Math.max(0, irs / 12);
  const liquido = bruto - ss - irs;
  document.getElementById('res-liquido').textContent = fmt(liquido);
  document.getElementById('res-irs').textContent = fmt(irs);
  document.getElementById('res-ss').textContent = fmt(ss);
  document.getElementById('res-desc').textContent = fmt(ss + irs);
  document.getElementById('sal-results').style.display = 'grid';
  document.getElementById('hero-liquido').textContent = fmt(liquido);
}

// ESFOR√áO
function calcEsforco() {
  const rend = parseFloat(document.getElementById('esf-rend').value) || 0;
  const prest = parseFloat(document.getElementById('esf-prest').value) || 0;
  if (!rend) return;
  const taxa = (prest / rend) * 100;
  document.getElementById('res-esforco').textContent = fmtPct(taxa);
  document.getElementById('hero-esforco').textContent = fmtPct(taxa);
  let status, color;
  if (taxa <= 33) { status = '‚úÖ Saud√°vel (‚â§33%)'; color = 'var(--green)'; }
  else if (taxa <= 40) { status = '‚ö†Ô∏è Aten√ß√£o (33‚Äì40%)'; color = 'var(--amber)'; }
  else { status = '‚ùå Elevada (>40%)'; color = 'var(--red)'; }
  document.getElementById('esf-status').textContent = status;
  document.getElementById('esf-status').style.color = color;
  document.getElementById('esf-results').style.display = 'grid';
  document.getElementById('esf-bar').style.display = 'block';
  setTimeout(() => {
    document.getElementById('esf-fill').style.width = Math.min(taxa, 100) + '%';
    document.getElementById('esf-fill').style.background = color;
  }, 50);
}

// IMT
function calcIMT() {
  const valor = parseFloat(document.getElementById('imt-valor').value) || 0;
  const tipo = document.querySelector('#imt-chips .chip.active')?.textContent || '';
  let imt = 0;
  if (tipo.includes('Pr√≥pria')) {
    if (valor <= 97064) imt = 0;
    else if (valor <= 132774) imt = valor * 0.02 - 1941.28;
    else if (valor <= 181034) imt = valor * 0.05 - 5924.54;
    else if (valor <= 301688) imt = valor * 0.07 - 9545.22;
    else if (valor <= 603289) imt = valor * 0.08 - 12562.10;
    else imt = valor * 0.06;
  } else { imt = valor * 0.065; }
  const selo = valor * 0.008;
  document.getElementById('res-imt').textContent = fmt(imt);
  document.getElementById('res-selo').textContent = fmt(selo);
  document.getElementById('res-imt-total').textContent = fmt(imt + selo);
  document.getElementById('hero-imt').textContent = fmt(imt + selo);
  document.getElementById('imt-results').style.display = 'grid';
}

// POUPAN√áA com capitaliza√ß√£o e reten√ß√£o
function calcPoupanca() {
  const capital = parseFloat(document.getElementById('p-capital').value) || 0;
  const mensal = parseFloat(document.getElementById('p-mensal').value) || 0;
  const taxaBruta = parseFloat(document.getElementById('p-taxa').value) / 100 || 0;
  const retencao = parseFloat(document.getElementById('p-retencao').value) / 100 || 0.28;
  const anos = parseFloat(document.getElementById('p-anos').value) || 0;

  // capitaliza√ß√£o: mensal=1, 3m=3, 6m=6, 12m=12
  const capLabel = document.querySelector('#p-cap-chips .chip.active')?.textContent || '6 Meses';
  const capMap = { 'Mensal': 1, '3 Meses': 3, '6 Meses': 6, '12 Meses': 12 };
  const capMeses = capMap[capLabel.trim()] || 6;
  const periodsPerYear = 12 / capMeses;
  const totalPeriods = anos * periodsPerYear;

  // taxa bruta por per√≠odo
  const taxaBrutaPeriod = taxaBruta / periodsPerYear;
  // taxa l√≠quida por per√≠odo (reten√ß√£o aplicada em cada capitaliza√ß√£o)
  const taxaLiqPeriod = taxaBrutaPeriod * (1 - retencao);
  const taxaLiqAnual = Math.pow(1 + taxaLiqPeriod, periodsPerYear) - 1;

  // calcular valor final com capitaliza√ß√£o l√≠quida
  // contribui√ß√µes mensais convertidas para por per√≠odo
  const contribuicaoPeriod = mensal * capMeses;

  let saldo = capital;
  let totalDepositado = capital;
  let jurosBrutos = 0;
  let retencaoTotal = 0;

  for (let i = 0; i < totalPeriods; i++) {
    const juroBruto = saldo * taxaBrutaPeriod;
    const retencaoP = juroBruto * retencao;
    const juroLiq = juroBruto - retencaoP;
    jurosBrutos += juroBruto;
    retencaoTotal += retencaoP;
    saldo += juroLiq + contribuicaoPeriod;
    totalDepositado += contribuicaoPeriod;
  }

  const jurosLiquidos = saldo - totalDepositado;
  const rentabTotal = ((saldo / capital) - 1) * 100;

  document.getElementById('res-p-liquido').textContent = fmt(saldo);
  document.getElementById('res-p-depositado').textContent = fmt(totalDepositado);
  document.getElementById('res-p-juros-brutos').textContent = fmt(jurosBrutos);
  document.getElementById('res-p-retencao').textContent = fmt(retencaoTotal);
  document.getElementById('res-p-juros-liq').textContent = fmt(jurosLiquidos);
  document.getElementById('bd-p-taxa-liq').textContent = fmtPct(taxaLiqAnual * 100);
  document.getElementById('bd-p-cap').textContent = capLabel;
  document.getElementById('bd-p-periodos').textContent = Math.round(totalPeriods) + ' per√≠odos';
  document.getElementById('bd-p-rentab').textContent = fmtPct(rentabTotal) + ' total';
  document.getElementById('p-results').style.display = 'block';
  document.getElementById('hero-poup').textContent = fmt(saldo);
}

// INVESTIMENTO
function calcInvestimento() {
  const capital = parseFloat(document.getElementById('inv-capital').value) || 0;
  const mensal = parseFloat(document.getElementById('inv-mensal').value) || 0;
  const taxaBruta = parseFloat(document.getElementById('inv-taxa').value) / 100 || 0;
  const retencao = parseFloat(document.getElementById('inv-retencao').value) / 100 || 0.28;
  const anos = parseFloat(document.getElementById('inv-anos').value) || 0;

  // For investments, tax typically applied at end (capital gains)
  const taxaLiq = taxaBruta; // grows at full rate
  const n = anos * 12;
  const r = taxaBruta / 12;

  let finalBruto = capital * Math.pow(1 + r, n);
  if (r > 0) finalBruto += mensal * (Math.pow(1 + r, n) - 1) / r;
  else finalBruto += mensal * n;

  const totalInvestido = capital + mensal * n;
  const ganhoBruto = finalBruto - totalInvestido;
  const imposto = ganhoBruto * retencao;
  const finalLiq = finalBruto - imposto;
  const ganhoLiq = finalLiq - totalInvestido;
  const taxaLiqEfetiva = (Math.pow(finalLiq / capital, 1 / anos) - 1) * 100;

  document.getElementById('res-inv-liq').textContent = fmt(finalLiq);
  document.getElementById('res-inv-dep').textContent = fmt(totalInvestido);
  document.getElementById('res-inv-bruto').textContent = fmt(ganhoBruto);
  document.getElementById('res-inv-imposto').textContent = fmt(imposto);
  document.getElementById('res-inv-liquido').textContent = fmt(ganhoLiq);
  document.getElementById('bd-inv-taxa-liq').textContent = fmtPct(taxaLiqEfetiva);
  document.getElementById('bd-inv-mult').textContent = 'x' + (finalLiq / capital).toFixed(2);
  document.getElementById('bd-inv-rentab').textContent = fmtPct((ganhoLiq / totalInvestido) * 100);
  document.getElementById('inv-results').style.display = 'block';
  document.getElementById('hero-inv').textContent = fmt(finalLiq);
}

// INFLA√á√ÉO
function calcInflacao() {
  const valor = parseFloat(document.getElementById('inf-valor').value) || 0;
  const taxa = parseFloat(document.getElementById('inf-taxa').value) / 100 || 0;
  const anos = parseFloat(document.getElementById('inf-anos').value) || 0;
  const futuro = valor / Math.pow(1 + taxa, anos);
  document.getElementById('res-inf-futuro').textContent = fmt(futuro);
  document.getElementById('res-inf-perda').textContent = fmt(valor - futuro);
  document.getElementById('hero-inf').textContent = fmt(futuro);
  document.getElementById('inf-results').style.display = 'grid';
}

// CR√âDITO
function calcCredito() {
  const imovel = parseFloat(document.getElementById('cred-imovel').value) || 0;
  const entrada = parseFloat(document.getElementById('cred-entrada').value) || 0;
  const euribor = parseFloat(document.getElementById('cred-euribor').value) / 100 || 0;
  const spread = parseFloat(document.getElementById('cred-spread').value) / 100 || 0;
  const prazo = parseFloat(document.getElementById('cred-prazo').value) || 30;
  const capital = imovel - entrada;
  const tan = euribor + spread;
  const r = tan / 12;
  const n = prazo * 12;
  const prestacao = capital * r * Math.pow(1 + r, n) / (Math.pow(1 + r, n) - 1);
  const totalPagar = prestacao * n;
  document.getElementById('cred-hero').textContent = fmt(prestacao);
  document.getElementById('bd-prestacao').textContent = fmt(prestacao);
  document.getElementById('bd-capital').textContent = fmt(capital);
  document.getElementById('bd-tan').textContent = fmtPct(tan * 100);
  document.getElementById('bd-total').textContent = fmt(totalPagar);
  document.getElementById('bd-juros').textContent = fmt(totalPagar - capital);
  document.getElementById('bd-ltv').textContent = ((capital / imovel) * 100).toFixed(1) + '%';
  document.getElementById('cred-breakdown').style.display = 'block';
}


// ============================================================
// DEPOSITS ‚Äî Supabase integration + fallback demo data
// ============================================================

// ---- CONFIG: replace with your Supabase credentials ----
const SUPABASE_URL = 'https://zdjfscurtpbmdzybjaqf.supabase.co'; // e.g. https://abcde.supabase.co
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpkamZzY3VydHBibWR6eWJqYXFmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE5NTY0MDUsImV4cCI6MjA4NzUzMjQwNX0.ZqSqKwGcy8GzOsk7Ui500vatlMKhn-g6EK7lHrfkU-w';
// --------------------------------------------------------

// Demo data ‚Äî used when Supabase is not configured
const DEMO_DEPOSITS = [
  { id:1, banco:'Activobank', nome_deposito:'Poupan√ßa Online', prazo:12, unidade:'meses', tanb:3.50, tanl:2.52, tipo_taxa:'Fixa', deposito_minimo:500, deposito_maximo:null, mobilizacao_antecipada:'Perda total de juros', novos_capitais:false, novos_clientes:false },
  { id:2, banco:'Caixa Geral Dep.', nome_deposito:'Dep√≥sito a Prazo', prazo:12, unidade:'meses', tanb:3.25, tanl:2.34, tipo_taxa:'Fixa', deposito_minimo:1000, deposito_maximo:null, mobilizacao_antecipada:'Perda de 50% dos juros', novos_capitais:true, novos_clientes:false },
  { id:3, banco:'Banco BPI', nome_deposito:'Dep√≥sito a Prazo 12M', prazo:12, unidade:'meses', tanb:3.00, tanl:2.16, tipo_taxa:'Fixa', deposito_minimo:2500, deposito_maximo:500000, mobilizacao_antecipada:'Sem juros', novos_capitais:true, novos_clientes:true },
  { id:4, banco:'Millennium BCP', nome_deposito:'Dep√≥sito BCP', prazo:12, unidade:'meses', tanb:2.85, tanl:2.05, tipo_taxa:'Fixa', deposito_minimo:1000, deposito_maximo:null, mobilizacao_antecipada:'Perda total de juros', novos_capitais:false, novos_clientes:true },
  { id:5, banco:'Banco Santander', nome_deposito:'Dep√≥sito Santander Plus', prazo:6, unidade:'meses', tanb:2.70, tanl:1.94, tipo_taxa:'Fixa', deposito_minimo:5000, deposito_maximo:250000, mobilizacao_antecipada:'Perda total de juros', novos_capitais:true, novos_clientes:true },
  { id:6, banco:'Novobanco', nome_deposito:'Dep√≥sito NB Online', prazo:6, unidade:'meses', tanb:2.60, tanl:1.87, tipo_taxa:'Fixa', deposito_minimo:1000, deposito_maximo:null, mobilizacao_antecipada:'50% dos juros', novos_capitais:false, novos_clientes:false },
  { id:7, banco:'Banco CTT', nome_deposito:'Dep√≥sito CTT 12M', prazo:12, unidade:'meses', tanb:3.10, tanl:2.23, tipo_taxa:'Fixa', deposito_minimo:500, deposito_maximo:100000, mobilizacao_antecipada:'Sem juros', novos_capitais:true, novos_clientes:false },
];

let allDeposits = [];
// null = sem filtro | true = s√≥ "Sim" | false = s√≥ "N√£o"
let activeFilters = { novos_capitais: null, novos_clientes: null };
let sortAsc = false;

async function loadDeposits() {
  try {
    const res = await fetch(
      `${SUPABASE_URL}/rest/v1/Taxas%20DP?select=*&order=TANB.desc`,
      {
        headers: {
          'apikey': SUPABASE_KEY,
          'Authorization': `Bearer ${SUPABASE_KEY}`,
          'Content-Type': 'application/json'
        }
      }
    );
    if (!res.ok) {
      const err = await res.text();
      console.error('Supabase erro:', res.status, err);
      throw new Error(err);
    }
    const data = await res.json();
    console.log('Supabase OK, registos:', data.length);
    if (data.length > 0) {
      console.log('=== COLUNAS REAIS (copia isto) ===');
      console.log(JSON.stringify(data[0], null, 2));
      console.log('=== CHAVES ===', Object.keys(data[0]));
    }
    allDeposits = data;
    applyFilters();
  } catch(e) {
    console.error('Supabase fetch falhou:', e);
    const container = document.getElementById('dp-list');
    if (container) container.innerHTML = '<div class="empty-state">‚ùå Erro ao carregar dados: ' + e.message + '</div>';
  }
}

function toggleFilter(key) {
  // Cycle: null ‚Üí true (Sim) ‚Üí false (N√£o) ‚Üí null
  if (activeFilters[key] === null)       activeFilters[key] = true;
  else if (activeFilters[key] === true)  activeFilters[key] = false;
  else                                   activeFilters[key] = null;

  const el = document.getElementById('ft-' + key.replace('_','-'));
  if (el) {
    el.classList.toggle('active', activeFilters[key] !== null);
    el.classList.toggle('filter-neg', activeFilters[key] === false);
    // Update label
    const base = key === 'novos_capitais' ? 'Novos Capitais' : 'Novos Clientes';
    if (activeFilters[key] === true)       el.querySelector('.ft-label').textContent = '‚úì ' + base;
    else if (activeFilters[key] === false) el.querySelector('.ft-label').textContent = '‚úó ' + base;
    else                                   el.querySelector('.ft-label').textContent = base;
  }
  applyFilters();
}

function toggleSort() {
  sortAsc = !sortAsc;
  const btn = document.getElementById('sort-btn');
  if (btn) btn.textContent = (sortAsc ? '‚Üë' : '‚Üì') + ' TANB';
  applyFilters();
}

function applyFilters() {
  const fMin = parseFloat(document.getElementById('f-dep-min')?.value) || null;
  const fMax = parseFloat(document.getElementById('f-dep-max')?.value) || null;

  const normalized = allDeposits.map(normalizeRow);

  let filtered = normalized.filter(d => {
    if (activeFilters.novos_capitais === true  && !d.novos_capitais) return false;
    if (activeFilters.novos_capitais === false &&  d.novos_capitais) return false;
    if (activeFilters.novos_clientes === true  && !d.novos_clientes) return false;
    if (activeFilters.novos_clientes === false &&  d.novos_clientes) return false;
    if (fMin !== null && d.deposito_minimo !== null && d.deposito_minimo > fMin) return false;
    if (fMax !== null && d.deposito_maximo !== null && d.deposito_maximo < fMax) return false;
    return true;
  });

  filtered.sort((a, b) => sortAsc ? a.tanb - b.tanb : b.tanb - a.tanb);

  renderDeposits(filtered);
}

function getBankAbbr(banco) {
  if (!banco) return '??';
  const map = {
    'Activobank': 'ACTV', 'Caixa Geral de Dep√≥sitos': 'CGD', 'Caixa Geral Dep.': 'CGD',
    'Banco BPI': 'BPI', 'BPI': 'BPI', 'Millennium BCP': 'BCP', 'BCP': 'BCP',
    'Banco Santander': 'SNT', 'Santander': 'SNT', 'Novobanco': 'NVB',
    'Banco CTT': 'CTT', 'CTT': 'CTT', 'Montepio': 'MTPO', 'Cr√©dito Agr√≠cola': 'CA'
  };
  return map[banco] || banco.substring(0,4).toUpperCase();
}

// Parse Portuguese number format: "5,00" ‚Üí 5.0 | "3.600" ‚Üí 3.6 | "1 000" ‚Üí 1000
function ptNum(val) {
  if (val === null || val === undefined || val === '') return null;
  const s = String(val).trim();
  // If it has a comma ‚Üí comma is decimal separator (e.g. "5,00" or "1.234,56")
  if (s.includes(',')) {
    return parseFloat(s.replace(/\./g, '').replace(',', '.'));
  }
  // If it has a dot ‚Üí check if it looks like thousands sep (e.g. "3.600" = 3.6%, "50.000" = 50000)
  // Heuristic: if digits after dot <= 3 AND value > 100 when taken literally ‚Üí likely thousands sep
  if (s.includes('.')) {
    const direct = parseFloat(s.replace(/\s/g, ''));
    const noThousands = parseFloat(s.replace(/\./g, '').replace(/\s/g, ''));
    // For tax rates: value should be < 100. If direct parse gives e.g. 3.6 that's fine.
    // "3.600" direct = 3.6 which is reasonable for a rate
    // "50.000" direct = 50 which is reasonable for a rate too... 
    // Better: if decimal part has exactly 3 digits ‚Üí thousands separator
    const parts = s.split('.');
    if (parts.length === 2 && parts[1].replace(/\s/g,'').length === 3) {
      // e.g. "3.600" ‚Üí parts = ["3","600"] ‚Üí 3 digits after dot ‚Üí thousands sep ‚Üí 3.6? No wait
      // "3.600" as thousands = 3600, but as rate means 3.6%
      // In the context of TANL: "3.600" means 3.600% (3 decimal places)
      // So we should treat dot as decimal here for small numbers
      if (direct < 100) return direct; // treat as decimal for rates
      return noThousands; // treat as thousands for large numbers
    }
    return direct;
  }
  // No separators ‚Äî could have spaces as thousands sep: "1 000" ‚Üí 1000
  return parseFloat(s.replace(/\s/g, '')) || null;
}

// Normalize row ‚Äî maps exact Supabase column names to internal keys
function normalizeRow(d) {
  return {
    id:               d.id || Math.random(),
    banco:            d['Banco']             || '‚Äî',
    prazo:            d['Prazo']             || '‚Äî',
    unidade:          d['Dias /meses /anos'] || '',
    nome_deposito:    d['Nome do Dep√≥sito']  || '‚Äî',
    tanb:             ptNum(d['TANB'])       || 0,
    tanl:             ptNum(d['TANL']),
    tipo_taxa:        d['Tipo de Taxa']      || 'Fixa',
    deposito_minimo:  ptNum(d['Dep√≥sito M√≠nimo']),
    deposito_maximo:  ptNum(d['Dep√≥sito M√°ximo']),
    mobilizacao:      d['Perda de juros com mobiliza√ß√£o antecipada'] || '‚Äî',
    novos_capitais:   d['Novos capitais?'] === 'Sim' || d['Novos capitais?'] === true || false,
    novos_clientes:   d['Novos clientes?'] === 'Sim' || d['Novos clientes?'] === true || false,
    outras:           d['Outras restri√ß√µes?'] || '',
    fin:              d['FIN (use o endere√ßo)'] || '',
    renovacoes:       d['Permite renova√ß√µes?'] || '',
    reforcos:         d['Permite refor√ßos?']   || '',
    data_conf:        d['Data Confirma√ß√£o']    || '',
  };
}

function renderDeposits(list) {
  const container = document.getElementById('dp-list');
  const countEl = document.getElementById('dp-count');
  if (!container) return;

  if (countEl) countEl.textContent = list.length + ' resultado' + (list.length !== 1 ? 's' : '');

  if (list.length === 0) {
    container.innerHTML = '<div class="empty-state">üòï Nenhum dep√≥sito corresponde aos filtros.</div>';
    return;
  }

  // Update hero with best rate
  const best = list[0];
  const bestRateEl = document.getElementById('dp-best-rate');
  const bestSubEl  = document.getElementById('dp-best-sub');
  if (bestRateEl) bestRateEl.textContent = best.tanb.toFixed(2) + '%';
  if (bestSubEl)  bestSubEl.textContent  = best.banco + ' ¬∑ ' + best.prazo + ' ' + best.unidade + ' ¬∑ l√≠q: ' + (best.tanl || best.tanb * 0.72).toFixed(2) + '%';

  container.innerHTML = list.map(d => {
    const tanl           = d.tanl || parseFloat((d.tanb * 0.72).toFixed(2));
    const retencao1k     = ((d.tanb - tanl) * 10).toFixed(2);
    const jurosLiq1k     = (tanl * 10).toFixed(2);
    const abbr           = getBankAbbr(d.banco);
    const prazoStr       = d.prazo + (d.unidade ? ' ' + d.unidade : '');
    const uid            = String(d.id).replace(/[^a-z0-9]/gi, '_');

    return `<div class="dp-card" id="dp-card-${uid}">
      <div class="dp-card-header" onclick="toggleDpCard('${uid}')">
        <div class="dp-card-left">
          <div class="dp-logo">${abbr}</div>
          <div>
            <div class="dp-name">${d.banco}</div>
            <div class="dp-sub">${d.nome_deposito} ¬∑ ${prazoStr}</div>
          </div>
        </div>
        <div class="dp-rate-col">
          <div class="dp-tanb">${d.tanb.toFixed(2)}%</div>
          <div class="dp-tanl">l√≠q. ${tanl.toFixed(2)}%</div>
        </div>
        <div class="dp-expand-icon">‚ñæ</div>
      </div>
      <div class="dp-details">
        <div class="dp-detail-row"><span class="dp-dk">TANB (bruta)</span><span class="dp-dv">${d.tanb.toFixed(2)}%</span></div>
        <div class="dp-detail-row"><span class="dp-dk">TANL (l√≠quida ap√≥s 28%)</span><span class="dp-dv green">${tanl.toFixed(2)}%</span></div>
        <div class="dp-detail-row"><span class="dp-dk">Reten√ß√£o Estado (por ‚Ç¨1.000)</span><span class="dp-dv red">${retencao1k} ‚Ç¨</span></div>
        <div class="dp-detail-row"><span class="dp-dk">Juros l√≠quidos (por ‚Ç¨1.000)</span><span class="dp-dv">${jurosLiq1k} ‚Ç¨</span></div>
        <div class="dp-detail-row"><span class="dp-dk">Tipo de Taxa</span><span class="dp-dv">${d.tipo_taxa}</span></div>
        <div class="dp-detail-row"><span class="dp-dk">Dep√≥sito M√≠nimo</span><span class="dp-dv">${d.deposito_minimo ? d.deposito_minimo.toLocaleString('pt-PT') + ' ‚Ç¨' : '‚Äî'}</span></div>
        <div class="dp-detail-row"><span class="dp-dk">Dep√≥sito M√°ximo</span><span class="dp-dv">${d.deposito_maximo ? d.deposito_maximo.toLocaleString('pt-PT') + ' ‚Ç¨' : 'Sem limite'}</span></div>
        <div class="dp-detail-row"><span class="dp-dk">Mobiliza√ß√£o Antecipada</span><span class="dp-dv amber">${d.mobilizacao}</span></div>
        <div class="dp-tags">
          <span class="dp-tag ${d.novos_capitais ? 'green' : 'gray'}">${d.novos_capitais ? '‚úì' : '‚úó'} Novos Capitais</span>
          <span class="dp-tag ${d.novos_clientes ? 'green' : 'gray'}">${d.novos_clientes ? '‚úì' : '‚úó'} Novos Clientes</span>
        </div>
        ${d.fin ? `<a class="dp-fin-link" href="${d.fin}" target="_blank">üìÑ Ver Ficha de Informa√ß√£o Normalizada ‚Üí</a>` : ''}
      </div>
    </div>`;
  }).join('');
}

function toggleDpCard(id) {
  const card = document.getElementById('dp-card-' + id);
  if (card) card.classList.toggle('open');
}

// Load deposits on first visit - called from showTab
function maybeLoadDeposits(tabId) {
  if (tabId === 'dep-prazo' && allDeposits.length === 0) loadDeposits();
}

</script>
</body>
</html>
