<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f1923">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="LitFinanceira">
<link rel="apple-touch-icon" href="icon-192.png">
<title>Literacia Financeira</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --green: #00c896;
    --green-light: rgba(0,200,150,0.08);
    --navy: #0a1628;
    --bg: #f4f7fb;
    --bg2: #eef2f8;
    --white: #ffffff;
    --border: rgba(0,0,0,0.07);
    --border-green: rgba(0,200,150,0.25);
    --text: #0d1b2e;
    --muted: #8fa0b8;
    --red: #ff3d6b;
    --amber: #f59e0b;
    --shadow-sm: 0 2px 8px rgba(0,0,0,0.06);
    --shadow-md: 0 8px 24px rgba(0,0,0,0.09);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  html, body { height: 100%; background: var(--bg); color: var(--text); font-family: 'Outfit', sans-serif; overflow: hidden; }

  .phone { max-width: 420px; height: 100dvh; margin: 0 auto; display: flex; flex-direction: column; overflow: hidden; background: var(--bg); position: relative; }
  .phone::before { content: ''; position: fixed; top: -100px; right: -80px; width: 280px; height: 280px; border-radius: 50%; background: radial-gradient(circle, rgba(0,200,150,0.1), transparent 70%); pointer-events: none; z-index: 0; }

  /* ‚îÄ‚îÄ AUTH SCREEN ‚îÄ‚îÄ */
  .auth-screen { position: absolute; inset: 0; background: var(--navy); z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 32px 28px; }
  .auth-screen.hidden { display: none; }
  .auth-logo { width: 64px; height: 64px; background: rgba(0,200,150,0.15); border: 1px solid var(--border-green); border-radius: 20px; display: flex; align-items: center; justify-content: center; font-family: 'Syne', sans-serif; font-weight: 800; font-size: 1.1rem; color: var(--green); margin-bottom: 20px; }
  .auth-title { font-family: 'Syne', sans-serif; font-weight: 800; font-size: 1.6rem; color: #fff; text-align: center; margin-bottom: 6px; }
  .auth-sub { font-size: 0.82rem; color: rgba(255,255,255,0.4); text-align: center; margin-bottom: 36px; line-height: 1.5; }
  .auth-card { width: 100%; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 24px; }
  .auth-tabs { display: flex; gap: 4px; background: rgba(255,255,255,0.06); border-radius: 12px; padding: 4px; margin-bottom: 22px; }
  .auth-tab { flex: 1; padding: 8px; border-radius: 9px; border: none; background: transparent; color: rgba(255,255,255,0.4); font-family: 'Outfit', sans-serif; font-size: 0.82rem; font-weight: 600; cursor: pointer; transition: all 0.2s; }
  .auth-tab.active { background: var(--green); color: var(--navy); }
  .auth-input { width: 100%; background: rgba(255,255,255,0.07); border: 1.5px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 13px 16px; color: #fff; font-family: 'Outfit', sans-serif; font-size: 0.92rem; font-weight: 500; outline: none; margin-bottom: 12px; transition: border-color 0.2s; }
  .auth-input::placeholder { color: rgba(255,255,255,0.25); }
  .auth-input:focus { border-color: var(--green); }
  .auth-btn { width: 100%; background: var(--green); color: var(--navy); border: none; border-radius: 12px; padding: 14px; font-family: 'Syne', sans-serif; font-size: 0.88rem; font-weight: 800; cursor: pointer; transition: all 0.2s; margin-top: 4px; letter-spacing: 0.02em; }
  .auth-btn:active { transform: scale(0.98); opacity: 0.9; }
  .auth-error { font-size: 0.75rem; color: var(--red); text-align: center; margin-top: 10px; min-height: 18px; }
  .auth-magic-sent { display: none; text-align: center; }
  .auth-magic-sent .magic-icon { font-size: 2.5rem; margin-bottom: 12px; }
  .auth-magic-sent p { color: rgba(255,255,255,0.7); font-size: 0.85rem; line-height: 1.6; }
  .auth-magic-sent strong { color: var(--green); }

  /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
  .header { padding: 16px 20px 10px; display: flex; align-items: center; justify-content: space-between; flex-shrink: 0; position: relative; z-index: 1; }
  .logo-mark { display: flex; align-items: center; gap: 10px; }
  .logo-icon { width: 38px; height: 38px; background: var(--navy); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-family: 'Syne', sans-serif; font-weight: 800; font-size: 0.72rem; color: var(--green); box-shadow: 0 4px 12px rgba(10,22,40,0.25); }
  .logo-text { font-family: 'Syne', sans-serif; font-weight: 800; font-size: 0.95rem; color: var(--text); line-height: 1.1; }
  .logo-text span { display: block; font-size: 0.58rem; font-weight: 500; color: var(--muted); letter-spacing: 0.1em; text-transform: uppercase; }
  .header-right { display: flex; gap: 8px; }
  .icon-btn { width: 38px; height: 38px; border-radius: 12px; background: var(--white); border: 1px solid var(--border); box-shadow: var(--shadow-sm); display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 1rem; transition: all 0.2s; }
  .icon-btn:active { transform: scale(0.94); }
  .avatar-btn { width: 38px; height: 38px; border-radius: 12px; background: var(--navy); border: none; display: flex; align-items: center; justify-content: center; cursor: pointer; font-family: 'Syne', sans-serif; font-size: 0.75rem; font-weight: 800; color: var(--green); box-shadow: 0 4px 12px rgba(10,22,40,0.2); }

  .sub-tab-bar { display: flex; padding: 0 16px 10px; gap: 6px; flex-shrink: 0; overflow-x: auto; scrollbar-width: none; position: relative; z-index: 1; }
  .sub-tab-bar::-webkit-scrollbar { display: none; }
  .sub-tab-btn { flex-shrink: 0; padding: 7px 16px; border-radius: 20px; border: 1.5px solid var(--border); background: var(--white); color: var(--muted); font-family: 'Outfit', sans-serif; font-size: 0.74rem; font-weight: 600; cursor: pointer; transition: all 0.2s; white-space: nowrap; box-shadow: var(--shadow-sm); }
  .sub-tab-btn.active { background: var(--navy); border-color: var(--navy); color: var(--green); box-shadow: 0 4px 14px rgba(10,22,40,0.2); }

  .scroll-area { flex: 1; overflow-y: auto; padding: 4px 16px 16px; scrollbar-width: none; position: relative; z-index: 1; }
  .scroll-area::-webkit-scrollbar { display: none; }

  .tab-content { display: none; }
  .tab-content.active { display: block; animation: fadeUp 0.25s ease both; }

  /* ‚îÄ‚îÄ HERO CARDS ‚îÄ‚îÄ */
  .hero-card { background: var(--navy); border-radius: 22px; padding: 22px; margin-bottom: 16px; position: relative; overflow: hidden; box-shadow: 0 12px 40px rgba(10,22,40,0.22); }
  .hero-card::before { content: ''; position: absolute; top: -60px; right: -60px; width: 180px; height: 180px; border-radius: 50%; background: radial-gradient(circle, rgba(0,200,150,0.2), transparent 70%); }
  .hero-label { font-size: 0.68rem; text-transform: uppercase; letter-spacing: 0.12em; color: rgba(255,255,255,0.4); margin-bottom: 6px; position: relative; z-index: 1; }
  .hero-value { font-family: 'Syne', sans-serif; font-size: 2.2rem; font-weight: 800; color: #fff; line-height: 1; margin-bottom: 4px; position: relative; z-index: 1; }
  .hero-value .accent { color: var(--green); }
  .hero-sub { font-size: 0.75rem; color: rgba(255,255,255,0.45); position: relative; z-index: 1; }
  .hero-badge { display: inline-flex; align-items: center; gap: 5px; background: rgba(0,200,150,0.15); border: 1px solid rgba(0,200,150,0.25); border-radius: 20px; padding: 4px 12px; font-size: 0.68rem; color: var(--green); margin-top: 14px; position: relative; z-index: 1; font-weight: 600; }

  /* ‚îÄ‚îÄ PROFILE / DASHBOARD ‚îÄ‚îÄ */
  .profile-hero { background: var(--navy); border-radius: 22px; padding: 22px; margin-bottom: 16px; position: relative; overflow: hidden; box-shadow: 0 12px 40px rgba(10,22,40,0.22); }
  .profile-hero::before { content: ''; position: absolute; top: -60px; right: -60px; width: 200px; height: 200px; border-radius: 50%; background: radial-gradient(circle, rgba(0,200,150,0.18), transparent 70%); }
  .profile-avatar { width: 52px; height: 52px; border-radius: 16px; background: rgba(0,200,150,0.2); border: 1.5px solid var(--border-green); display: flex; align-items: center; justify-content: center; font-family: 'Syne', sans-serif; font-size: 1.1rem; font-weight: 800; color: var(--green); margin-bottom: 12px; position: relative; z-index: 1; }
  .profile-name { font-family: 'Syne', sans-serif; font-size: 1.3rem; font-weight: 800; color: #fff; position: relative; z-index: 1; }
  .profile-email { font-size: 0.72rem; color: rgba(255,255,255,0.4); margin-top: 2px; position: relative; z-index: 1; }
  .profile-stats { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-top: 16px; position: relative; z-index: 1; }
  .profile-stat { background: rgba(255,255,255,0.06); border-radius: 12px; padding: 10px; text-align: center; }
  .profile-stat-val { font-family: 'Syne', sans-serif; font-size: 1rem; font-weight: 800; color: var(--green); }
  .profile-stat-label { font-size: 0.58rem; color: rgba(255,255,255,0.35); text-transform: uppercase; letter-spacing: 0.06em; margin-top: 2px; }

  .dash-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 14px; }
  .dash-card { background: var(--white); border: 1px solid var(--border); border-radius: 16px; padding: 14px; box-shadow: var(--shadow-sm); }
  .dash-card.full { grid-column: 1/-1; }
  .dash-card.income { border-left: 3px solid var(--green); }
  .dash-card.expense { border-left: 3px solid var(--red); }
  .dash-card.savings { border-left: 3px solid var(--amber); }
  .dash-icon { font-size: 1.1rem; margin-bottom: 6px; }
  .dash-label { font-size: 0.62rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 4px; }
  .dash-value { font-family: 'Syne', sans-serif; font-size: 1.05rem; font-weight: 800; color: var(--text); }
  .dash-sub { font-size: 0.65rem; color: var(--muted); margin-top: 2px; }
  .dash-delta { font-size: 0.65rem; font-weight: 700; margin-top: 3px; }
  .dash-delta.up { color: var(--green); }
  .dash-delta.down { color: var(--red); }

  .month-bar { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
  .month-nav { display: flex; align-items: center; gap: 10px; }
  .month-btn { width: 30px; height: 30px; border-radius: 8px; border: 1px solid var(--border); background: var(--white); display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 0.8rem; color: var(--muted); box-shadow: var(--shadow-sm); }
  .month-label { font-family: 'Syne', sans-serif; font-size: 0.85rem; font-weight: 700; color: var(--text); }

  /* ‚îÄ‚îÄ REGISTOS ‚îÄ‚îÄ */
  .registo-list { margin-top: 4px; }
  .registo-item { display: flex; align-items: center; gap: 12px; padding: 11px 14px; background: var(--white); border: 1px solid var(--border); border-radius: 14px; margin-bottom: 8px; box-shadow: var(--shadow-sm); }
  .registo-icon { width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; flex-shrink: 0; }
  .registo-icon.income { background: rgba(0,200,150,0.1); }
  .registo-icon.expense { background: rgba(255,61,107,0.1); }
  .registo-info { flex: 1; min-width: 0; }
  .registo-nome { font-size: 0.83rem; font-weight: 600; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .registo-cat { font-size: 0.65rem; color: var(--muted); margin-top: 1px; }
  .registo-valor { font-family: 'Syne', sans-serif; font-size: 0.95rem; font-weight: 800; }
  .registo-valor.income { color: var(--green); }
  .registo-valor.expense { color: var(--red); }
  .registo-del { width: 28px; height: 28px; border-radius: 8px; border: none; background: rgba(255,61,107,0.08); color: var(--red); cursor: pointer; font-size: 0.75rem; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }

  /* ‚îÄ‚îÄ FAB (add button) ‚îÄ‚îÄ */
  .fab { position: fixed; bottom: 90px; right: calc(50% - 200px); width: 52px; height: 52px; border-radius: 16px; background: var(--navy); border: none; color: var(--green); font-size: 1.4rem; cursor: pointer; box-shadow: 0 8px 24px rgba(10,22,40,0.3); z-index: 20; display: none; align-items: center; justify-content: center; transition: all 0.2s; }
  .fab:active { transform: scale(0.94); }
  .fab.visible { display: flex; }

  /* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
  .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 50; display: none; align-items: flex-end; justify-content: center; backdrop-filter: blur(4px); }
  .modal-overlay.open { display: flex; }
  .modal { background: var(--white); border-radius: 24px 24px 0 0; width: 100%; max-width: 420px; padding: 24px 20px 36px; animation: slideUp 0.3s cubic-bezier(0.34,1.56,0.64,1); }
  .modal-handle { width: 36px; height: 4px; background: var(--bg2); border-radius: 2px; margin: 0 auto 20px; }
  .modal-title { font-family: 'Syne', sans-serif; font-size: 1rem; font-weight: 800; color: var(--text); margin-bottom: 18px; }
  .modal-type-row { display: flex; gap: 8px; margin-bottom: 16px; }
  .type-btn { flex: 1; padding: 10px; border-radius: 12px; border: 1.5px solid var(--border); background: var(--bg); font-family: 'Outfit', sans-serif; font-size: 0.8rem; font-weight: 700; cursor: pointer; transition: all 0.2s; color: var(--muted); }
  .type-btn.income.active { background: rgba(0,200,150,0.1); border-color: var(--green); color: #008c69; }
  .type-btn.expense.active { background: rgba(255,61,107,0.1); border-color: var(--red); color: var(--red); }
  @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

  /* ‚îÄ‚îÄ SETTINGS DENTRO DO PERFIL ‚îÄ‚îÄ */
  .settings-row { display: flex; align-items: center; justify-content: space-between; padding: 13px 0; border-bottom: 1px solid var(--bg2); }
  .settings-row:last-child { border-bottom: none; }
  .settings-label { font-size: 0.85rem; font-weight: 500; color: var(--text); }
  .settings-sub { font-size: 0.7rem; color: var(--muted); margin-top: 1px; }
  .settings-action { font-size: 0.8rem; color: var(--green); font-weight: 600; cursor: pointer; }
  .logout-btn { width: 100%; background: rgba(255,61,107,0.08); border: 1.5px solid rgba(255,61,107,0.2); border-radius: 14px; padding: 13px; color: var(--red); font-family: 'Syne', sans-serif; font-size: 0.85rem; font-weight: 700; cursor: pointer; margin-top: 16px; }

  /* ‚îÄ‚îÄ SIM CARDS ‚îÄ‚îÄ */
  .section-title { font-family: 'Syne', sans-serif; font-size: 0.68rem; text-transform: uppercase; letter-spacing: 0.14em; color: var(--muted); margin-bottom: 10px; margin-top: 20px; padding-left: 2px; }
  .sim-card { background: var(--white); border: 1px solid var(--border); border-radius: 18px; padding: 16px; margin-bottom: 10px; box-shadow: var(--shadow-sm); }
  .sim-card-title { font-family: 'Syne', sans-serif; font-weight: 700; font-size: 0.88rem; color: var(--text); display: flex; align-items: center; gap: 10px; margin-bottom: 14px; }
  .sim-icon { width: 34px; height: 34px; border-radius: 10px; background: var(--green-light); border: 1px solid var(--border-green); display: flex; align-items: center; justify-content: center; font-size: 0.9rem; flex-shrink: 0; }
  .input-group { margin-bottom: 10px; }
  .input-label { font-size: 0.7rem; color: var(--muted); margin-bottom: 5px; font-weight: 500; display: flex; justify-content: space-between; align-items: center; }
  .input-wrapper { position: relative; }
  .input-field { width: 100%; background: var(--bg); border: 1.5px solid var(--border); border-radius: 12px; padding: 11px 44px 11px 14px; color: var(--text); font-family: 'Outfit', sans-serif; font-size: 0.92rem; font-weight: 600; outline: none; transition: border-color 0.2s, box-shadow 0.2s; }
  .input-field:focus { border-color: var(--green); box-shadow: 0 0 0 3px var(--green-light); background: var(--white); }
  .input-unit { position: absolute; right: 14px; top: 50%; transform: translateY(-50%); font-size: 0.72rem; color: var(--muted); font-weight: 700; }
  .select-field { width: 100%; background: var(--bg); border: 1.5px solid var(--border); border-radius: 12px; padding: 11px 14px; color: var(--text); font-family: 'Outfit', sans-serif; font-size: 0.88rem; font-weight: 600; outline: none; transition: border-color 0.2s; appearance: none; -webkit-appearance: none; cursor: pointer; }
  .select-field:focus { border-color: var(--green); box-shadow: 0 0 0 3px var(--green-light); background: var(--white); }
  .card-section-label { font-family: 'Syne', sans-serif; font-size: 0.62rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em; color: var(--green); border-top: 1px solid var(--bg2); padding-top: 12px; margin: 12px 0 10px; }
  .check-row { display: flex; align-items: center; gap: 10px; padding: 8px 0; }
  .check-row input[type="checkbox"] { width: 18px; height: 18px; accent-color: var(--green); cursor: pointer; flex-shrink: 0; }
  .check-row label { font-size: 0.82rem; color: var(--text); font-weight: 500; cursor: pointer; }
  .calc-btn { width: 100%; background: var(--navy); color: #fff; border: none; border-radius: 14px; padding: 14px; font-family: 'Syne', sans-serif; font-size: 0.85rem; font-weight: 700; cursor: pointer; transition: all 0.2s; margin-top: 4px; letter-spacing: 0.03em; box-shadow: 0 6px 20px rgba(10,22,40,0.2); position: relative; overflow: hidden; }
  .calc-btn::after { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px; background: linear-gradient(90deg, transparent, rgba(0,200,150,0.5), transparent); }
  .calc-btn:active { transform: scale(0.98); }
  .result-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 12px; }
  .result-box { background: var(--bg); border: 1px solid var(--border); border-radius: 12px; padding: 11px 14px; }
  .result-box.highlight { background: var(--navy); border-color: var(--navy); }
  .result-box.highlight-red { background: rgba(255,61,107,0.08); border-color: rgba(255,61,107,0.2); }
  .result-box.highlight-amber { background: rgba(245,158,11,0.08); border-color: rgba(245,158,11,0.2); }
  .result-label { font-size: 0.62rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 3px; }
  .result-box.highlight .result-label { color: rgba(255,255,255,0.4); }
  .result-box.highlight-red .result-label { color: rgba(255,61,107,0.6); }
  .result-box.highlight-amber .result-label { color: rgba(245,158,11,0.6); }
  .result-value { font-family: 'Syne', sans-serif; font-size: 0.98rem; font-weight: 800; color: var(--text); }
  .result-box.highlight .result-value { color: var(--green); }
  .result-box.highlight-red .result-value { color: var(--red); }
  .result-box.highlight-amber .result-value { color: var(--amber); }
  .mortgage-breakdown { background: var(--navy); border-radius: 18px; padding: 18px; margin-top: 12px; box-shadow: 0 8px 30px rgba(10,22,40,0.18); }
  .breakdown-title { font-family: 'Syne', sans-serif; font-size: 0.72rem; font-weight: 700; color: rgba(255,255,255,0.5); margin-bottom: 14px; text-transform: uppercase; letter-spacing: 0.08em; }
  .breakdown-row { display: flex; justify-content: space-between; align-items: center; padding: 9px 0; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 0.8rem; }
  .breakdown-row:last-child { border-bottom: none; }
  .breakdown-row .key { color: rgba(255,255,255,0.45); }
  .breakdown-row .val { font-weight: 700; color: #fff; }
  .breakdown-row .val.green { color: var(--green); }
  .breakdown-row .val.red { color: var(--red); }
  .breakdown-row .val.amber { color: var(--amber); }
  .chip-row { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px; }
  .chip { padding: 6px 13px; border-radius: 20px; border: 1.5px solid var(--border); background: var(--bg); font-size: 0.72rem; font-weight: 600; color: var(--muted); cursor: pointer; transition: all 0.2s; }
  .chip.active { background: var(--green-light); border-color: var(--green); color: #008c69; }
  .progress-bar { height: 6px; background: var(--bg2); border-radius: 3px; margin-top: 12px; overflow: hidden; }
  .progress-fill { height: 100%; border-radius: 3px; background: var(--green); transition: width 0.8s cubic-bezier(0.4,0,0.2,1); }
  .info-box { background: rgba(0,200,150,0.06); border: 1px solid var(--border-green); border-radius: 12px; padding: 10px 14px; margin-bottom: 12px; font-size: 0.75rem; color: #008c69; line-height: 1.5; }
  .retention-tag { display: inline-flex; align-items: center; gap: 4px; background: rgba(245,158,11,0.1); border: 1px solid rgba(245,158,11,0.25); border-radius: 20px; padding: 3px 10px; font-size: 0.65rem; color: var(--amber); font-weight: 700; margin-left: 6px; }
  .legal-note { font-size: 0.7rem; color: var(--muted); line-height: 1.5; margin-top: 12px; padding: 10px 12px; background: var(--bg2); border-radius: 10px; }

  /* ‚îÄ‚îÄ DEPOSITS ‚îÄ‚îÄ */
  .product-card { background: var(--white); border: 1px solid var(--border); border-radius: 18px; padding: 16px; margin-bottom: 10px; box-shadow: var(--shadow-sm); }
  .product-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
  .product-left { display: flex; align-items: center; gap: 12px; }
  .product-logo { width: 40px; height: 40px; border-radius: 12px; background: var(--navy); display: flex; align-items: center; justify-content: center; font-size: 0.62rem; font-weight: 800; color: var(--green); text-align: center; flex-shrink: 0; }
  .product-name { font-weight: 700; font-size: 0.85rem; color: var(--text); }
  .product-type { font-size: 0.67rem; color: var(--muted); margin-top: 1px; }
  .product-rate { font-family: 'Syne', sans-serif; font-size: 1.2rem; font-weight: 800; color: var(--text); text-align: right; }
  .product-rate-label { font-size: 0.62rem; color: var(--muted); text-align: right; }
  .product-detail-row { display: flex; justify-content: space-between; padding: 5px 0; border-top: 1px solid var(--bg2); font-size: 0.75rem; }
  .product-detail-row .dk { color: var(--muted); }
  .product-detail-row .dv { font-weight: 600; color: var(--text); }
  .product-detail-row .dv.green { color: var(--green); }
  .product-detail-row .dv.red { color: var(--red); }

  .filter-block { background: var(--white); border: 1px solid var(--border); border-radius: 16px; padding: 14px; margin-bottom: 12px; box-shadow: var(--shadow-sm); }
  .filter-row { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
  .filter-toggle { display: flex; align-items: center; gap: 6px; padding: 7px 14px; border-radius: 20px; border: 1.5px solid var(--border); background: var(--bg); font-size: 0.72rem; font-weight: 600; color: var(--muted); cursor: pointer; transition: all 0.2s; white-space: nowrap; }
  .filter-toggle.active { background: var(--green-light); border-color: var(--green); color: #008c69; }
  .filter-toggle.filter-neg { background: rgba(255,61,107,0.08); border-color: rgba(255,61,107,0.3); color: var(--red); }
  .filter-toggle.filter-neg .ft-dot { background: var(--red); }
  .ft-dot { width: 8px; height: 8px; border-radius: 50%; background: currentColor; opacity: 0.5; }
  .filter-toggle.active .ft-dot { opacity: 1; }
  .sort-btn { margin-left: auto; padding: 7px 14px; border-radius: 20px; border: 1.5px solid var(--navy); background: var(--navy); color: var(--green); font-size: 0.7rem; font-weight: 700; cursor: pointer; white-space: nowrap; font-family: 'Outfit', sans-serif; }
  .filter-input-wrap { display: flex; align-items: center; gap: 6px; flex: 1; background: var(--bg); border: 1.5px solid var(--border); border-radius: 12px; padding: 8px 12px; }
  .fi-label { font-size: 0.65rem; color: var(--muted); font-weight: 600; white-space: nowrap; }
  .fi-input { flex: 1; border: none; background: transparent; outline: none; font-family: 'Outfit', sans-serif; font-size: 0.82rem; font-weight: 600; color: var(--text); width: 0; min-width: 0; }
  .fi-unit { font-size: 0.65rem; color: var(--muted); font-weight: 700; }
  .results-count { font-size: 0.68rem; color: var(--muted); margin-top: 8px; text-align: right; }
  .dp-card { background: var(--white); border: 1px solid var(--border); border-radius: 16px; margin-bottom: 8px; box-shadow: var(--shadow-sm); overflow: hidden; }
  .dp-card-header { display: flex; align-items: center; justify-content: space-between; padding: 14px 16px; cursor: pointer; }
  .dp-card-left { display: flex; align-items: center; gap: 12px; }
  .dp-logo { width: 40px; height: 40px; border-radius: 12px; background: var(--navy); display: flex; align-items: center; justify-content: center; font-size: 0.58rem; font-weight: 800; color: var(--green); text-align: center; line-height: 1.2; flex-shrink: 0; }
  .dp-name { font-weight: 700; font-size: 0.83rem; color: var(--text); }
  .dp-sub { font-size: 0.67rem; color: var(--muted); margin-top: 1px; }
  .dp-rate-col { text-align: right; }
  .dp-tanb { font-family: 'Syne', sans-serif; font-size: 1.1rem; font-weight: 800; color: var(--text); }
  .dp-tanl { font-size: 0.68rem; color: var(--green); font-weight: 600; margin-top: 1px; }
  .dp-expand-icon { width: 24px; height: 24px; border-radius: 6px; background: var(--bg2); display: flex; align-items: center; justify-content: center; font-size: 0.75rem; color: var(--muted); margin-left: 8px; transition: transform 0.2s; flex-shrink: 0; }
  .dp-card.open .dp-expand-icon { transform: rotate(180deg); }
  .dp-details { display: none; border-top: 1px solid var(--bg2); padding: 12px 16px; background: var(--bg); }
  .dp-card.open .dp-details { display: block; animation: fadeUp 0.2s ease; }
  .dp-detail-row { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid var(--border); font-size: 0.78rem; }
  .dp-detail-row:last-child { border-bottom: none; }
  .dp-dk { color: var(--muted); }
  .dp-dv { font-weight: 600; color: var(--text); }
  .dp-dv.green { color: var(--green); }
  .dp-dv.red { color: var(--red); }
  .dp-dv.amber { color: var(--amber); }
  .dp-tags { display: flex; gap: 6px; flex-wrap: wrap; margin-top: 10px; }
  .dp-tag { padding: 3px 10px; border-radius: 20px; font-size: 0.62rem; font-weight: 700; }
  .dp-tag.green { background: var(--green-light); color: #008c69; border: 1px solid var(--border-green); }
  .dp-tag.gray { background: var(--bg2); color: var(--muted); border: 1px solid var(--border); }
  .dp-fin-link { display: flex; align-items: center; gap: 6px; margin-top: 10px; padding: 9px 14px; background: var(--navy); border-radius: 10px; color: var(--green); font-size: 0.75rem; font-weight: 600; text-decoration: none; }
  .loading-state { text-align: center; padding: 40px 20px; color: var(--muted); font-size: 0.85rem; }
  .empty-state { text-align: center; padding: 40px 20px; color: var(--muted); font-size: 0.85rem; }

  /* ‚îÄ‚îÄ TAXAS ‚îÄ‚îÄ */
  .euribor-strip { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 16px; }
  .euribor-box { background: var(--white); border: 1px solid var(--border); border-radius: 14px; padding: 14px 10px; text-align: center; box-shadow: var(--shadow-sm); }
  .euribor-label { font-size: 0.62rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 5px; font-weight: 600; }
  .euribor-val { font-family: 'Syne', sans-serif; font-size: 1.05rem; font-weight: 800; color: var(--text); }
  .euribor-change { font-size: 0.63rem; margin-top: 3px; font-weight: 600; }
  .up { color: var(--red); } .down { color: var(--green); }
  .rate-card { background: var(--white); border: 1px solid var(--border); border-radius: 16px; padding: 14px 16px; margin-bottom: 8px; display: flex; align-items: center; justify-content: space-between; box-shadow: var(--shadow-sm); }
  .rate-left { display: flex; align-items: center; gap: 12px; }
  .rate-logo { width: 40px; height: 40px; border-radius: 12px; background: var(--navy); display: flex; align-items: center; justify-content: center; font-size: 0.62rem; font-weight: 800; color: var(--green); }
  .rate-name { font-weight: 700; font-size: 0.83rem; color: var(--text); }
  .rate-type { font-size: 0.67rem; color: var(--muted); margin-top: 1px; }
  .rate-value { font-family: 'Syne', sans-serif; font-size: 1.15rem; font-weight: 800; color: var(--text); text-align: right; }
  .rate-period { font-size: 0.62rem; color: var(--muted); text-align: right; margin-top: 1px; }

  /* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
  .bottom-nav { display: flex; padding: 8px 12px 22px; gap: 4px; background: var(--white); border-top: 1px solid var(--border); flex-shrink: 0; box-shadow: 0 -8px 24px rgba(0,0,0,0.06); position: relative; z-index: 10; }
  .nav-btn { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 3px; padding: 8px 4px; border-radius: 14px; background: transparent; border: none; cursor: pointer; transition: all 0.2s; color: var(--muted); }
  .nav-btn.active { background: var(--navy); color: var(--green); }
  .nav-icon { font-size: 1.05rem; }
  .nav-label { font-size: 0.58rem; font-weight: 700; font-family: 'Outfit', sans-serif; }

  @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
</style>
</head>
<body>
<div class="phone">

  <!-- ‚ïê‚ïê AUTH SCREEN ‚ïê‚ïê -->
  <div class="auth-screen" id="auth-screen">
    <div class="auth-logo">LF</div>
    <div class="auth-title">Literacia Financeira</div>
    <div class="auth-sub">Gere as tuas finan√ßas pessoais,<br>simula cr√©ditos e acompanha taxas.</div>
    <div class="auth-card">
      <div class="auth-tabs">
        <button class="auth-tab active" onclick="switchAuthTab('login',this)">Entrar</button>
        <button class="auth-tab" onclick="switchAuthTab('register',this)">Registar</button>
      </div>
      <div id="auth-form-login">
        <input class="auth-input" type="email" id="auth-email-login" placeholder="email@exemplo.com">
        <input class="auth-input" type="password" id="auth-pass-login" placeholder="Palavra-passe">
        <button class="auth-btn" onclick="doLogin()">Entrar</button>
        <div style="text-align:center;margin-top:14px;">
          <span style="font-size:0.75rem;color:rgba(255,255,255,0.35)">ou</span>
        </div>
        <button class="auth-btn" style="background:rgba(0,200,150,0.15);color:var(--green);margin-top:8px;" onclick="doMagicLink()">‚úâÔ∏è Entrar com Magic Link</button>
      </div>
      <div id="auth-form-register" style="display:none">
        <input class="auth-input" type="text" id="auth-name" placeholder="Nome completo">
        <input class="auth-input" type="email" id="auth-email-reg" placeholder="email@exemplo.com">
        <input class="auth-input" type="password" id="auth-pass-reg" placeholder="Palavra-passe (m√≠n. 6 caracteres)">
        <button class="auth-btn" onclick="doRegister()">Criar conta</button>
      </div>
      <div class="auth-magic-sent" id="magic-sent">
        <div class="magic-icon">üì¨</div>
        <p>Email enviado para<br><strong id="magic-email-display"></strong><br><br>Clica no link para entrar.</p>
      </div>
      <div class="auth-error" id="auth-error"></div>
    </div>
  </div>

  <!-- ‚ïê‚ïê APP ‚ïê‚ïê -->
  <div class="header">
    <div class="logo-mark">
      <div class="logo-icon">LF</div>
      <div class="logo-text">Literacia <span>Financeira</span></div>
    </div>
    <div class="header-right">
      <button class="avatar-btn" id="avatar-btn" onclick="switchSection('perfil', document.querySelector('.nav-btn:first-child'))">?</button>
    </div>
  </div>

  <div class="sub-tab-bar" id="sub-tab-bar"></div>
  <div class="scroll-area">

    <!-- ‚ïê‚ïê PERFIL: DASHBOARD ‚ïê‚ïê -->
    <div class="tab-content" id="tab-dashboard">
      <div class="profile-hero">
        <div class="profile-avatar" id="dash-avatar">?</div>
        <div class="profile-name" id="dash-nome">‚Äî</div>
        <div class="profile-email" id="dash-email">‚Äî</div>
        <div class="profile-stats">
          <div class="profile-stat"><div class="profile-stat-val" id="stat-saldo">‚Äî</div><div class="profile-stat-label">Saldo</div></div>
          <div class="profile-stat"><div class="profile-stat-val" id="stat-poupanca">‚Äî</div><div class="profile-stat-label">Poupan√ßa</div></div>
          <div class="profile-stat"><div class="profile-stat-val" id="stat-meses">‚Äî</div><div class="profile-stat-label">Meses</div></div>
        </div>
      </div>

      <div class="month-bar">
        <div class="month-nav">
          <div class="month-btn" onclick="mudaMes(-1)">‚Äπ</div>
          <div class="month-label" id="mes-label">‚Äî</div>
          <div class="month-btn" onclick="mudaMes(1)">‚Ä∫</div>
        </div>
      </div>

      <div class="dash-grid">
        <div class="dash-card income">
          <div class="dash-icon">üíö</div>
          <div class="dash-label">Rendimentos</div>
          <div class="dash-value" id="dash-rendimentos">0 ‚Ç¨</div>
          <div class="dash-sub" id="dash-n-rendimentos">0 entradas</div>
        </div>
        <div class="dash-card expense">
          <div class="dash-icon">üî¥</div>
          <div class="dash-label">Despesas</div>
          <div class="dash-value" id="dash-despesas">0 ‚Ç¨</div>
          <div class="dash-sub" id="dash-n-despesas">0 sa√≠das</div>
        </div>
        <div class="dash-card savings full">
          <div class="dash-icon">üè¶</div>
          <div class="dash-label">Saldo do M√™s</div>
          <div class="dash-value" id="dash-saldo-mes" style="font-size:1.3rem">0 ‚Ç¨</div>
          <div class="dash-sub">Rendimentos ‚àí Despesas</div>
        </div>
      </div>

      <p class="section-title">Movimentos do M√™s</p>
      <div class="registo-list" id="lista-movimentos">
        <div class="empty-state">Sem movimentos registados neste m√™s.</div>
      </div>
    </div>

    <!-- ‚ïê‚ïê PERFIL: REGISTAR ‚ïê‚ïê -->
    <div class="tab-content" id="tab-registar">
      <div class="hero-card">
        <div class="hero-label">Novo Movimento</div>
        <div class="hero-value"><span class="accent">+ Adicionar</span></div>
        <div class="hero-sub">Regista rendimentos e despesas mensais</div>
        <div class="hero-badge">üìä Dados guardados na tua conta</div>
      </div>
      <div class="sim-card">
        <div class="sim-card-title"><div class="sim-icon">üìù</div>Tipo de Movimento</div>
        <div class="modal-type-row">
          <button class="type-btn income active" id="tipo-income" onclick="selectTipo('income')">üíö Rendimento</button>
          <button class="type-btn expense" id="tipo-expense" onclick="selectTipo('expense')">üî¥ Despesa</button>
        </div>
        <div class="input-group">
          <div class="input-label">Descri√ß√£o</div>
          <input class="input-field" type="text" id="reg-descricao" placeholder="Ex: Sal√°rio, Renda, Supermercado‚Ä¶" style="padding:11px 14px;">
        </div>
        <div class="input-group">
          <div class="input-label">Valor</div>
          <div class="input-wrapper">
            <input class="input-field" type="number" id="reg-valor" placeholder="0.00" step="0.01">
            <span class="input-unit">‚Ç¨</span>
          </div>
        </div>
        <div class="input-group">
          <div class="input-label">Categoria</div>
          <select class="select-field" id="reg-categoria">
            <optgroup label="Rendimentos">
              <option value="Sal√°rio">Sal√°rio</option>
              <option value="Freelance">Freelance</option>
              <option value="Rendas">Rendas</option>
              <option value="Investimentos">Investimentos</option>
              <option value="Outros Rendimentos">Outros Rendimentos</option>
            </optgroup>
            <optgroup label="Despesas">
              <option value="Habita√ß√£o">Habita√ß√£o (Renda/Cr√©dito)</option>
              <option value="Alimenta√ß√£o">Alimenta√ß√£o</option>
              <option value="Transportes">Transportes</option>
              <option value="Sa√∫de">Sa√∫de</option>
              <option value="Educa√ß√£o">Educa√ß√£o</option>
              <option value="Lazer">Lazer</option>
              <option value="Seguros">Seguros</option>
              <option value="Comunica√ß√µes">Comunica√ß√µes</option>
              <option value="Outros">Outros</option>
            </optgroup>
          </select>
        </div>
        <div class="input-group">
          <div class="input-label">Data</div>
          <input class="input-field" type="date" id="reg-data" style="padding:11px 14px;">
        </div>
        <div class="input-group">
          <div class="input-label">Notas (opcional)</div>
          <input class="input-field" type="text" id="reg-notas" placeholder="Notas opcionais‚Ä¶" style="padding:11px 14px;">
        </div>
        <button class="calc-btn" onclick="guardarMovimento()">üíæ Guardar Movimento</button>
        <div id="reg-feedback" style="text-align:center;font-size:0.8rem;margin-top:10px;min-height:20px;"></div>
      </div>
    </div>

    <!-- ‚ïê‚ïê PERFIL: DEFINI√á√ïES ‚ïê‚ïê -->
    <div class="tab-content" id="tab-definicoes">
      <div class="hero-card">
        <div class="hero-label">Conta</div>
        <div class="hero-value" style="font-size:1.4rem"><span class="accent" id="def-nome-hero">‚Äî</span></div>
        <div class="hero-sub" id="def-email-hero">‚Äî</div>
        <div class="hero-badge">üë§ Perfil Pessoal</div>
      </div>
      <div class="sim-card">
        <div class="sim-card-title"><div class="sim-icon">üë§</div>Informa√ß√£o Pessoal</div>
        <div class="input-group">
          <div class="input-label">Nome</div>
          <input class="input-field" type="text" id="def-nome" placeholder="O teu nome" style="padding:11px 14px;">
        </div>
        <div class="input-group">
          <div class="input-label">Data de Nascimento</div>
          <input class="input-field" type="date" id="def-datanasc" style="padding:11px 14px;">
        </div>
        <div class="input-group">
          <div class="input-label">Estado Civil</div>
          <select class="select-field" id="def-estadocivil">
            <option value="nc_c2t">N√£o Casado / Casado 2 Titulares</option>
            <option value="c1t">Casado 1 Titular</option>
          </select>
        </div>
        <div class="input-group">
          <div class="input-label">N¬∫ de Dependentes</div>
          <div class="input-wrapper">
            <input class="input-field" type="number" id="def-ndep" value="0" min="0" max="10">
            <span class="input-unit">#</span>
          </div>
        </div>
        <button class="calc-btn" onclick="guardarPerfil()">üíæ Guardar Perfil</button>
        <div id="perfil-feedback" style="text-align:center;font-size:0.8rem;margin-top:10px;min-height:20px;color:var(--green);"></div>
      </div>
      <button class="logout-btn" onclick="doLogout()">üö™ Terminar Sess√£o</button>
    </div>

    <!-- ‚ïê‚ïê SIMULAR: SAL√ÅRIO ‚ïê‚ïê -->
    <div class="tab-content" id="tab-salario">
      <div class="hero-card">
        <div class="hero-label">Calculadora Fiscal</div>
        <div class="hero-value"><span class="accent" id="hero-liquido">‚Äî</span></div>
        <div class="hero-sub" id="hero-sal-sub">Sal√°rio l√≠quido estimado mensal</div>
        <div class="hero-badge">‚ú¶ Tabelas IRS 2026 ¬∑ Art. 99.¬∫-C CIRS</div>
      </div>
      <div class="sim-card">
        <div class="sim-card-title"><div class="sim-icon">üí∂</div>Dados Pessoais e Salariais</div>
        <div class="input-group"><div class="input-label">Estado Civil</div><select class="select-field" id="irs-estadoCivil"><option value="nc_c2t">N√£o Casado / Casado 2 Titulares</option><option value="c1t">Casado 1 Titular</option></select></div>
        <div class="input-group"><div class="input-label">N¬∫ de Dependentes</div><div class="input-wrapper"><input class="input-field" type="number" id="irs-dependentes" value="0" min="0" max="10"><span class="input-unit">#</span></div></div>
        <div class="check-row"><input type="checkbox" id="irs-incapacidade"><label for="irs-incapacidade">Incapacidade ‚â• 60% (fator 0.85)</label></div>
        <div class="card-section-label">Rendimentos Mensais</div>
        <div class="input-group"><div class="input-label">Vencimento Base Bruto</div><div class="input-wrapper"><input class="input-field" type="number" id="irs-base" value="1500" step="0.01"><span class="input-unit">‚Ç¨</span></div></div>
        <div class="input-group"><div class="input-label">Horas Extra <span class="retention-tag">Ret. Aut√≥noma</span></div><div class="input-wrapper"><input class="input-field" type="number" id="irs-extras" value="0" step="0.01"><span class="input-unit">‚Ç¨</span></div></div>
        <div class="input-group"><div class="input-label">Outros Rendimentos Sujeitos</div><div class="input-wrapper"><input class="input-field" type="number" id="irs-outros" value="0" step="0.01"><span class="input-unit">‚Ç¨</span></div></div>
        <div class="input-group"><div class="input-label">Rendimentos Isentos</div><div class="input-wrapper"><input class="input-field" type="number" id="irs-isentos" value="0" step="0.01"><span class="input-unit">‚Ç¨</span></div></div>
        <div class="card-section-label">Subs√≠dio de Alimenta√ß√£o</div>
        <div class="input-group"><div class="input-label">Valor por Dia</div><div class="input-wrapper"><input class="input-field" type="number" id="irs-subAlimValor" value="6.00" step="0.01"><span class="input-unit">‚Ç¨</span></div></div>
        <div class="input-group"><div class="input-label">Dias Trabalhados</div><div class="input-wrapper"><input class="input-field" type="number" id="irs-subAlimDias" value="22"><span class="input-unit">dias</span></div></div>
        <div class="input-group"><div class="input-label">Forma de Pagamento</div><select class="select-field" id="irs-tipoPagAlim"><option value="cartao">Cart√£o / Vale (isento at√© 9,60 ‚Ç¨)</option><option value="dinheiro">Dinheiro (isento at√© 6,00 ‚Ç¨)</option></select></div>
        <div class="card-section-label">Subs√≠dios de F√©rias / Natal</div>
        <div class="input-group"><div class="input-label">Pagamento em Duod√©cimos <span class="retention-tag">Ret. Aut√≥noma</span></div><select class="select-field" id="irs-duodecimos"><option value="0">Pagamento por inteiro (0%)</option><option value="50">50% em Duod√©cimos</option><option value="100">100% em Duod√©cimos</option></select></div>
        <div class="card-section-label">Seguran√ßa Social</div>
        <div class="input-group"><div class="input-label">Taxa SS Trabalhador</div><div class="input-wrapper"><input class="input-field" type="number" id="irs-taxaSS" value="11" step="0.1"><span class="input-unit">%</span></div></div>
        <button class="calc-btn" onclick="calcSalarioCompleto()">Calcular Sal√°rio L√≠quido</button>
      </div>
      <div id="irs-results-block" style="display:none">
        <p class="section-title">Processamento Salarial</p>
        <div class="result-grid">
          <div class="result-box" style="grid-column:1/-1"><div class="result-label">Vencimento Base</div><div class="result-value" id="rr-base">‚Äî</div></div>
          <div class="result-box" id="rr-box-extras" style="display:none"><div class="result-label">Horas Extra</div><div class="result-value" id="rr-extras">‚Äî</div></div>
          <div class="result-box" id="rr-box-duo" style="display:none"><div class="result-label">Duod√©cimos</div><div class="result-value" id="rr-duo">‚Äî</div></div>
          <div class="result-box"><div class="result-label">Sub. Alimenta√ß√£o</div><div class="result-value" id="rr-subAlim">‚Äî</div></div>
          <div class="result-box" id="rr-box-trib" style="display:none"><div class="result-label">‚Ü≥ Parte Tribut√°vel</div><div class="result-value" style="color:var(--amber)" id="rr-subAlimTrib">‚Äî</div></div>
        </div>
        <div class="mortgage-breakdown" style="margin-top:10px">
          <div class="breakdown-title">Resumo Mensal Completo</div>
          <div class="breakdown-row"><span class="key">Total Bruto</span><span class="val" id="bd-totalBruto">‚Äî</span></div>
          <div class="breakdown-row"><span class="key">Seguran√ßa Social (<span id="bd-taxaSS-pct">11%</span>)</span><span class="val red" id="bd-ss">‚Äî</span></div>
          <div class="breakdown-row"><span class="key">Taxa IRS aplicada</span><span class="val amber" id="bd-taxaIRS">‚Äî</span></div>
          <div class="breakdown-row"><span class="key">Total IRS</span><span class="val red" id="bd-totalIRS">‚Äî</span></div>
          <div class="breakdown-row"><span class="key">Total Descontos</span><span class="val red" id="bd-totalDesc">‚Äî</span></div>
          <div class="breakdown-row"><span class="key">Sal√°rio L√≠quido</span><span class="val green" id="bd-liquido">‚Äî</span></div>
          <div class="breakdown-row"><span class="key">Taxa Efectiva Total</span><span class="val amber" id="bd-taxaEfetiva">‚Äî</span></div>
          <div class="breakdown-row" id="bd-row-irsExtras" style="display:none"><span class="key">IRS Horas Extra (Aut√≥n.)</span><span class="val red" id="bd-irsExtras">‚Äî</span></div>
          <div class="breakdown-row" id="bd-row-irsDuo" style="display:none"><span class="key">IRS Duod√©cimos (Aut√≥n.)</span><span class="val red" id="bd-irsDuo">‚Äî</span></div>
        </div>
        <div class="result-grid" style="margin-top:10px">
          <div class="result-box highlight" style="grid-column:1/-1"><div class="result-label">Sal√°rio L√≠quido Estimado</div><div class="result-value" id="rr-liquido">‚Äî</div></div>
          <div class="result-box highlight-red"><div class="result-label">Total Descontos</div><div class="result-value" id="rr-descontos">‚Äî</div></div>
          <div class="result-box highlight-amber"><div class="result-label">Taxa Efectiva</div><div class="result-value" id="rr-taxaEfetiva">‚Äî</div></div>
        </div>
        <div class="legal-note">‚öñÔ∏è F√≥rmula AT: <strong>Remunera√ß√£o √ó Taxa ‚àí Parcela a abater ‚àí (Adicional √ó Dependentes)</strong></div>
      </div>
    </div>

    <!-- ‚ïê‚ïê SIMULAR: TAXA ESFOR√áO ‚ïê‚ïê -->
    <div class="tab-content" id="tab-esforco">
      <div class="hero-card">
        <div class="hero-label">An√°lise Banc√°ria de Cr√©dito</div>
        <div class="hero-value"><span class="accent" id="hero-esforco">‚Äî</span></div>
        <div class="hero-sub" id="hero-esforco-sub">Taxa de esfor√ßo ¬∑ DSTI ¬∑ LTV</div>
        <div class="hero-badge">üè¶ Regula√ß√£o Banco de Portugal</div>
      </div>
      <div class="sim-card">
        <div class="sim-card-title"><div class="sim-icon">üë§</div>Titular 1</div>
        <div class="input-group"><div class="input-label">Data de Nascimento <span style="font-size:0.65rem;color:var(--amber);font-weight:700;margin-left:4px;">‚Ü≥ limita prazo m√°ximo</span></div><input class="input-field" type="date" id="esf-dn1" style="padding:11px 14px;" onchange="esf_atualizarPrazo()"></div>
        <div class="input-group"><div class="input-label">Sal√°rio L√≠quido Mensal</div><div class="input-wrapper"><input class="input-field" type="number" id="esf-rend1" placeholder="1500" step="100"><span class="input-unit">‚Ç¨</span></div></div>
        <div class="input-group"><div class="input-label">Outras Presta√ß√µes Mensais</div><div class="input-wrapper"><input class="input-field" type="number" id="esf-op1" value="0" step="10"><span class="input-unit">‚Ç¨</span></div></div>
        <div class="input-group"><div class="input-label">Outros Encargos Mensais</div><div class="input-wrapper"><input class="input-field" type="number" id="esf-enc1" value="0" step="10"><span class="input-unit">‚Ç¨</span></div></div>
      </div>
      <div class="sim-card">
        <div class="sim-card-title"><div class="sim-icon">üë§</div>Titular 2 <span style="font-size:0.65rem;color:var(--muted);font-weight:500;margin-left:4px;">(opcional)</span></div>
        <div class="input-group"><div class="input-label">Data de Nascimento</div><input class="input-field" type="date" id="esf-dn2" style="padding:11px 14px;" onchange="esf_atualizarPrazo()"></div>
        <div class="input-group"><div class="input-label">Sal√°rio L√≠quido Mensal</div><div class="input-wrapper"><input class="input-field" type="number" id="esf-rend2" value="0" step="100"><span class="input-unit">‚Ç¨</span></div></div>
        <div class="input-group"><div class="input-label">Outras Presta√ß√µes Mensais</div><div class="input-wrapper"><input class="input-field" type="number" id="esf-op2" value="0" step="10"><span class="input-unit">‚Ç¨</span></div></div>
        <div class="input-group"><div class="input-label">Encargos M√∫tuos Mensais</div><div class="input-wrapper"><input class="input-field" type="number" id="esf-encMutuos" value="0" step="10"><span class="input-unit">‚Ç¨</span></div></div>
      </div>
      <div class="sim-card">
        <div class="sim-card-title"><div class="sim-icon">üè†</div>Im√≥vel e Empr√©stimo</div>
        <div class="input-group"><div class="input-label">Valor do Im√≥vel</div><div class="input-wrapper"><input class="input-field" type="number" id="esf-vImovel" placeholder="200000" step="1000"><span class="input-unit">‚Ç¨</span></div></div>
        <div class="input-group"><div class="input-label">Montante do Empr√©stimo</div><div class="input-wrapper"><input class="input-field" type="number" id="esf-montante" placeholder="160000" step="1000"><span class="input-unit">‚Ç¨</span></div></div>
        <div class="input-group"><div class="input-label">Taxa de Juro Anual</div><div class="input-wrapper"><input class="input-field" type="number" id="esf-taxa" placeholder="3.65" step="0.01" value="3.65"><span class="input-unit">%</span></div></div>
        <div class="input-group"><div class="input-label">Prazo do Empr√©stimo</div><div class="input-wrapper"><input class="input-field" type="number" id="esf-prazo" placeholder="360" step="1" value="360" min="12" max="480"><span class="input-unit">meses</span></div><div id="esf-prazo-info" style="font-size:0.7rem;color:var(--green);margin-top:5px;padding:6px 10px;background:var(--green-light);border-radius:8px;display:none;font-weight:600;"></div></div>
        <button class="calc-btn" onclick="calcEsforco()">Calcular DSTI ¬∑ Taxa de Esfor√ßo ¬∑ LTV</button>
      </div>
      <div id="esf-results-block" style="display:none">
        <p class="section-title">Resultados da An√°lise</p>
        <div class="result-grid">
          <div class="result-box" id="esf-box-te"><div class="result-label">Taxa de Esfor√ßo</div><div class="result-value" id="res-esforco">‚Äî</div><div class="progress-bar" style="margin-top:8px"><div class="progress-fill" id="esf-fill-te" style="width:0%"></div></div><div style="font-size:0.62rem;color:var(--muted);margin-top:4px;">Limite recomendado: 60%</div></div>
          <div class="result-box" id="esf-box-dsti"><div class="result-label">DSTI (c/ stress +1.5%)</div><div class="result-value" id="res-dsti">‚Äî</div><div class="progress-bar" style="margin-top:8px"><div class="progress-fill" id="esf-fill-dsti" style="width:0%"></div></div><div style="font-size:0.62rem;color:var(--muted);margin-top:4px;">Limite BdP: 50%</div></div>
          <div class="result-box" id="esf-box-ltv" style="grid-column:1/-1"><div class="result-label">LTV ‚Äî Loan-to-Value</div><div class="result-value" id="res-ltv">‚Äî</div><div class="progress-bar" style="margin-top:8px"><div class="progress-fill" id="esf-fill-ltv" style="width:0%"></div></div><div style="font-size:0.62rem;color:var(--muted);margin-top:4px;">Limite BdP: 90%</div></div>
        </div>
        <div class="mortgage-breakdown" style="margin-top:10px">
          <div class="breakdown-title">Detalhe do C√°lculo</div>
          <div class="breakdown-row"><span class="key">Presta√ß√£o Mensal</span><span class="val green" id="bd-esf-prest">‚Äî</span></div>
          <div class="breakdown-row"><span class="key">Presta√ß√£o c/ Stress (+1,5%)</span><span class="val amber" id="bd-esf-prestStress">‚Äî</span></div>
          <div class="breakdown-row"><span class="key">Rendimento Total Mensal</span><span class="val" id="bd-esf-rendTotal">‚Äî</span></div>
          <div class="breakdown-row"><span class="key">Rendimento Ajustado (idade)</span><span class="val" id="bd-esf-rendAjust">‚Äî</span></div>
          <div class="breakdown-row"><span class="key">Prazo M√°ximo BdP</span><span class="val amber" id="bd-esf-prazoMax">‚Äî</span></div>
          <div class="breakdown-row"><span class="key">Taxa de Esfor√ßo</span><span class="val" id="bd-esf-te">‚Äî</span></div>
          <div class="breakdown-row"><span class="key">DSTI</span><span class="val" id="bd-esf-dsti">‚Äî</span></div>
          <div class="breakdown-row"><span class="key">LTV</span><span class="val" id="bd-esf-ltv">‚Äî</span></div>
        </div>
        <p class="section-title">Montantes M√°ximos de Empr√©stimo</p>
        <div class="result-grid">
          <div class="result-box"><div class="result-label">Por Taxa Esfor√ßo (60%)</div><div class="result-value" id="res-maxTE">‚Äî</div></div>
          <div class="result-box"><div class="result-label">Por DSTI (50%)</div><div class="result-value" id="res-maxDSTI">‚Äî</div></div>
          <div class="result-box"><div class="result-label">Por LTV (90%)</div><div class="result-value" id="res-maxLTV">‚Äî</div></div>
          <div class="result-box highlight" style="grid-column:1/-1"><div class="result-label">Montante M√°ximo Recomendado</div><div class="result-value" id="res-maxRec">‚Äî</div></div>
        </div>
        <div class="legal-note">‚öñÔ∏è DSTI calculado com teste de stress <strong>+1,5%</strong> conforme Aviso BdP n.¬∫ 4/2017.</div>
      </div>
    </div>

    <!-- ‚ïê‚ïê SIMULAR: IMT ‚ïê‚ïê -->
    <div class="tab-content" id="tab-imt">
      <div class="hero-card"><div class="hero-label">Impostos na Compra</div><div class="hero-value"><span class="accent" id="hero-imt">‚Äî</span></div><div class="hero-sub">IMT + Imposto de Selo estimado</div><div class="hero-badge">üè† Tabelas 2025</div></div>
      <div class="sim-card">
        <div class="sim-card-title"><div class="sim-icon">üè†</div>IMT + Imposto de Selo</div>
        <div class="input-group"><div class="input-label">Valor do Im√≥vel</div><div class="input-wrapper"><input class="input-field" type="number" id="imt-valor" placeholder="200000"><span class="input-unit">‚Ç¨</span></div></div>
        <div class="chip-row" id="imt-chips"><div class="chip active" onclick="selectChip(this,'imt-chips')">Habita√ß√£o Pr√≥pria</div><div class="chip" onclick="selectChip(this,'imt-chips')">Secund√°ria</div></div>
        <button class="calc-btn" onclick="calcIMT()">Calcular Impostos</button>
        <div class="result-grid" id="imt-results" style="display:none">
          <div class="result-box"><div class="result-label">IMT</div><div class="result-value" id="res-imt">‚Äî</div></div>
          <div class="result-box"><div class="result-label">Imposto de Selo</div><div class="result-value" id="res-selo">‚Äî</div></div>
          <div class="result-box highlight" style="grid-column:1/-1"><div class="result-label">Total a Pagar</div><div class="result-value" id="res-imt-total">‚Äî</div></div>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê SIMULAR: POUPAN√áA ‚ïê‚ïê -->
    <div class="tab-content" id="tab-sim-poupanca">
      <div class="hero-card"><div class="hero-label">Simulador de Poupan√ßa</div><div class="hero-value"><span class="accent" id="hero-poup">‚Äî</span></div><div class="hero-sub">Valor final l√≠quido ap√≥s impostos</div><div class="hero-badge">üè¶ Com reten√ß√£o na fonte</div></div>
      <div class="sim-card">
        <div class="sim-card-title"><div class="sim-icon">üè¶</div>Poupan√ßa com Juro Composto</div>
        <div class="info-box">üí° Os juros s√£o sujeitos a <strong>reten√ß√£o na fonte de 28%</strong> em Portugal.</div>
        <div class="input-group"><div class="input-label">Capital Inicial</div><div class="input-wrapper"><input class="input-field" type="number" id="p-capital" value="5000"><span class="input-unit">‚Ç¨</span></div></div>
        <div class="input-group"><div class="input-label">Dep√≥sito Mensal</div><div class="input-wrapper"><input class="input-field" type="number" id="p-mensal" value="200"><span class="input-unit">‚Ç¨</span></div></div>
        <div class="input-group"><div class="input-label">Taxa de Juro Bruta Anual</div><div class="input-wrapper"><input class="input-field" type="number" id="p-taxa" value="3.5" step="0.1"><span class="input-unit">%</span></div></div>
        <div class="input-group"><div class="input-label">Taxa de Reten√ß√£o <span class="retention-tag">‚ö†Ô∏è Estado fica</span></div><div class="input-wrapper"><input class="input-field" type="number" id="p-retencao" value="28" step="1"><span class="input-unit">%</span></div></div>
        <div class="input-group"><div class="input-label">Capitaliza√ß√£o dos Juros</div></div>
        <div class="chip-row" id="p-cap-chips"><div class="chip" onclick="selectChip(this,'p-cap-chips')">Mensal</div><div class="chip" onclick="selectChip(this,'p-cap-chips')">3 Meses</div><div class="chip active" onclick="selectChip(this,'p-cap-chips')">6 Meses</div><div class="chip" onclick="selectChip(this,'p-cap-chips')">12 Meses</div></div>
        <div class="input-group"><div class="input-label">Per√≠odo Total</div><div class="input-wrapper"><input class="input-field" type="number" id="p-anos" value="5"><span class="input-unit">anos</span></div></div>
        <button class="calc-btn" onclick="calcPoupanca()">Calcular Poupan√ßa</button>
        <div id="p-results" style="display:none">
          <div class="result-grid">
            <div class="result-box highlight" style="grid-column:1/-1"><div class="result-label">Valor Final L√≠quido</div><div class="result-value" id="res-p-liquido">‚Äî</div></div>
            <div class="result-box"><div class="result-label">Capital Depositado</div><div class="result-value" id="res-p-depositado">‚Äî</div></div>
            <div class="result-box"><div class="result-label">Juros Brutos</div><div class="result-value" id="res-p-juros-brutos">‚Äî</div></div>
            <div class="result-box highlight-red"><div class="result-label">Reten√ß√£o (Estado)</div><div class="result-value" id="res-p-retencao">‚Äî</div></div>
            <div class="result-box"><div class="result-label">Juros L√≠quidos</div><div class="result-value" id="res-p-juros-liq">‚Äî</div></div>
          </div>
          <div class="mortgage-breakdown" style="margin-top:12px">
            <div class="breakdown-title">Detalhe</div>
            <div class="breakdown-row"><span class="key">Taxa L√≠quida Efetiva</span><span class="val green" id="bd-p-taxa-liq">‚Äî</span></div>
            <div class="breakdown-row"><span class="key">Capitaliza√ß√£o</span><span class="val" id="bd-p-cap">‚Äî</span></div>
            <div class="breakdown-row"><span class="key">N¬∫ de Per√≠odos</span><span class="val" id="bd-p-periodos">‚Äî</span></div>
            <div class="breakdown-row"><span class="key">Rentabilidade Total</span><span class="val green" id="bd-p-rentab">‚Äî</span></div>
          </div>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê SIMULAR: INVESTIMENTO ‚ïê‚ïê -->
    <div class="tab-content" id="tab-investimento">
      <div class="hero-card"><div class="hero-label">Retorno de Capital</div><div class="hero-value"><span class="accent" id="hero-inv">‚Äî</span></div><div class="hero-sub">Valor final l√≠quido ap√≥s impostos</div><div class="hero-badge">üìä Mais-valias e dividendos</div></div>
      <div class="sim-card">
        <div class="sim-card-title"><div class="sim-icon">üìà</div>Simulador de Investimento</div>
        <div class="info-box">üí° Mais-valias e dividendos sujeitos a <strong>28% de imposto</strong> em Portugal.</div>
        <div class="input-group"><div class="input-label">Capital Investido</div><div class="input-wrapper"><input class="input-field" type="number" id="inv-capital" value="10000"><span class="input-unit">‚Ç¨</span></div></div>
        <div class="input-group"><div class="input-label">Refor√ßo Mensal</div><div class="input-wrapper"><input class="input-field" type="number" id="inv-mensal" value="0"><span class="input-unit">‚Ç¨</span></div></div>
        <div class="input-group"><div class="input-label">Rentabilidade Anual Bruta</div><div class="input-wrapper"><input class="input-field" type="number" id="inv-taxa" value="7" step="0.5"><span class="input-unit">%</span></div></div>
        <div class="input-group"><div class="input-label">Imposto <span class="retention-tag">‚ö†Ô∏è Estado fica</span></div><div class="input-wrapper"><input class="input-field" type="number" id="inv-retencao" value="28" step="1"><span class="input-unit">%</span></div></div>
        <div class="input-group"><div class="input-label">Horizonte Temporal</div><div class="input-wrapper"><input class="input-field" type="number" id="inv-anos" value="20"><span class="input-unit">anos</span></div></div>
        <button class="calc-btn" onclick="calcInvestimento()">Simular Investimento</button>
        <div id="inv-results" style="display:none">
          <div class="result-grid">
            <div class="result-box highlight" style="grid-column:1/-1"><div class="result-label">Valor Final L√≠quido</div><div class="result-value" id="res-inv-liq">‚Äî</div></div>
            <div class="result-box"><div class="result-label">Total Investido</div><div class="result-value" id="res-inv-dep">‚Äî</div></div>
            <div class="result-box"><div class="result-label">Ganho Bruto</div><div class="result-value" id="res-inv-bruto">‚Äî</div></div>
            <div class="result-box highlight-red"><div class="result-label">Imposto (Estado)</div><div class="result-value" id="res-inv-imposto">‚Äî</div></div>
            <div class="result-box"><div class="result-label">Ganho L√≠quido</div><div class="result-value" id="res-inv-liquido">‚Äî</div></div>
          </div>
          <div class="mortgage-breakdown" style="margin-top:12px">
            <div class="breakdown-title">Detalhe</div>
            <div class="breakdown-row"><span class="key">Taxa L√≠quida Efetiva</span><span class="val green" id="bd-inv-taxa-liq">‚Äî</span></div>
            <div class="breakdown-row"><span class="key">Multiplicador do Capital</span><span class="val" id="bd-inv-mult">‚Äî</span></div>
            <div class="breakdown-row"><span class="key">Rentabilidade L√≠quida</span><span class="val green" id="bd-inv-rentab">‚Äî</span></div>
          </div>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê SIMULAR: INFLA√á√ÉO ‚ïê‚ïê -->
    <div class="tab-content" id="tab-inflacao">
      <div class="hero-card"><div class="hero-label">Poder de Compra</div><div class="hero-value"><span class="accent" id="hero-inf">‚Äî</span></div><div class="hero-sub">Valor real futuro do teu dinheiro</div><div class="hero-badge">üìâ Impacto da infla√ß√£o</div></div>
      <div class="sim-card">
        <div class="sim-card-title"><div class="sim-icon">üìâ</div>Eros√£o pela Infla√ß√£o</div>
        <div class="input-group"><div class="input-label">Valor Atual</div><div class="input-wrapper"><input class="input-field" type="number" id="inf-valor" value="100000"><span class="input-unit">‚Ç¨</span></div></div>
        <div class="input-group"><div class="input-label">Taxa de Infla√ß√£o Anual</div><div class="input-wrapper"><input class="input-field" type="number" id="inf-taxa" value="2.5" step="0.1"><span class="input-unit">%</span></div></div>
        <div class="input-group"><div class="input-label">Per√≠odo</div><div class="input-wrapper"><input class="input-field" type="number" id="inf-anos" value="10"><span class="input-unit">anos</span></div></div>
        <button class="calc-btn" onclick="calcInflacao()">Calcular Impacto</button>
        <div class="result-grid" id="inf-results" style="display:none">
          <div class="result-box highlight" style="grid-column:1/-1"><div class="result-label">Poder de Compra Futuro</div><div class="result-value" id="res-inf-futuro">‚Äî</div></div>
          <div class="result-box" style="grid-column:1/-1"><div class="result-label">Perda de Valor Real</div><div class="result-value" id="res-inf-perda" style="color:var(--red)">‚Äî</div></div>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê POUPAN√áA: DEP√ìSITOS ‚ïê‚ïê -->
    <div class="tab-content" id="tab-dep-prazo">
      <div class="hero-card" id="dp-hero"><div class="hero-label">Melhor Dep√≥sito a Prazo</div><div class="hero-value"><span class="accent" id="dp-best-rate">‚Äî</span></div><div class="hero-sub" id="dp-best-sub">A carregar...</div><div class="hero-badge">‚ö†Ô∏è Reten√ß√£o 28% sobre juros</div></div>
      <div class="info-box">‚ö†Ô∏è Juros sujeitos a <strong>reten√ß√£o na fonte de 28%</strong>. A TANL √© o que efetivamente recebes.</div>
      <div class="filter-block">
        <div class="filter-row">
          <div class="filter-toggle" id="ft-novos-capitais" onclick="toggleFilter('novos_capitais')"><div class="ft-dot"></div><span class="ft-label">Novos Capitais</span></div>
          <div class="filter-toggle" id="ft-novos-clientes" onclick="toggleFilter('novos_clientes')"><div class="ft-dot"></div><span class="ft-label">Novos Clientes</span></div>
          <div class="sort-btn" onclick="toggleSort()" id="sort-btn">‚Üì TANB</div>
        </div>
        <div class="filter-row" style="gap:8px;margin-top:8px;">
          <div class="filter-input-wrap"><span class="fi-label">Dep. M√≠n. ‚â§</span><input class="fi-input" type="number" id="f-dep-min" placeholder="ex: 1000" oninput="applyFilters()"><span class="fi-unit">‚Ç¨</span></div>
          <div class="filter-input-wrap"><span class="fi-label">Dep. M√°x. ‚â•</span><input class="fi-input" type="number" id="f-dep-max" placeholder="ex: 50000" oninput="applyFilters()"><span class="fi-unit">‚Ç¨</span></div>
        </div>
        <div class="results-count" id="dp-count"></div>
      </div>
      <div id="dp-list"><div class="loading-state">‚è≥ A carregar dep√≥sitos...</div></div>
    </div>

    <!-- ‚ïê‚ïê POUPAN√áA: CERTIFICADOS ‚ïê‚ïê -->
    <div class="tab-content" id="tab-certificados">
      <div class="hero-card"><div class="hero-label">D√≠vida P√∫blica Portuguesa</div><div class="hero-value"><span class="accent">3.50%</span></div><div class="hero-sub">Certificados de Aforro ¬∑ S√©rie E ¬∑ l√≠quido: 2.52%</div><div class="hero-badge">üáµüáπ Garantido pelo Estado</div></div>
      <div class="info-box">‚ö†Ô∏è Os Certificados de Aforro e do Tesouro est√£o sujeitos a <strong>reten√ß√£o de 28%</strong> sobre os juros.</div>
      <p class="section-title">Certificados de Aforro</p>
      <div class="product-card">
        <div class="product-header"><div class="product-left"><div class="product-logo">CA</div><div><div class="product-name">Certificados de Aforro</div><div class="product-type">S√©rie E ‚Äî capitaliza√ß√£o anual</div></div></div><div><div class="product-rate">3.50%</div><div class="product-rate-label">TANB bruta</div></div></div>
        <div class="product-detail-row"><span class="dk">Taxa L√≠quida (ap√≥s 28%)</span><span class="dv green">2.52%</span></div>
        <div class="product-detail-row"><span class="dk">Capitaliza√ß√£o</span><span class="dv">Anual (12M)</span></div>
        <div class="product-detail-row"><span class="dk">Prazo M√≠nimo</span><span class="dv">3 meses</span></div>
        <div class="product-detail-row"><span class="dk">Garantia</span><span class="dv green">Estado Portugu√™s</span></div>
      </div>
      <p class="section-title">Certificados do Tesouro</p>
      <div class="product-card" style="margin-bottom:20px">
        <div class="product-header"><div class="product-left"><div class="product-logo">CT</div><div><div class="product-name">Certificados do Tesouro</div><div class="product-type">CTPP ‚Äî 10 anos</div></div></div><div><div class="product-rate">3.25%</div><div class="product-rate-label">ano 1 bruta</div></div></div>
        <div class="product-detail-row"><span class="dk">Taxa L√≠quida Ano 1</span><span class="dv green">2.34%</span></div>
        <div class="product-detail-row"><span class="dk">Taxa Bruta Ano 5</span><span class="dv">3.50%</span></div>
        <div class="product-detail-row"><span class="dk">Taxa Bruta Ano 10</span><span class="dv">3.75%</span></div>
        <div class="product-detail-row"><span class="dk">Garantia</span><span class="dv green">Estado Portugu√™s</span></div>
      </div>
    </div>

    <!-- ‚ïê‚ïê TAXAS: EURIBOR ‚ïê‚ïê -->
    <div class="tab-content" id="tab-euribor">
      <div class="hero-card">
        <div class="hero-label" id="eur-hero-label">Euribor 12M</div>
        <div class="hero-value"><span class="accent" id="eur-hero-val">‚Äî</span></div>
        <div class="hero-sub" id="eur-hero-sub">A carregar...</div>
        <div class="hero-badge" id="eur-hero-badge">üì° ECB ¬∑ Actualiza√ß√£o di√°ria</div>
      </div>
      <p class="section-title">Euribor por Prazo</p>
      <div class="euribor-strip">
        <div class="euribor-box"><div class="euribor-label">3 Meses</div><div class="euribor-val" id="eur-3m">‚Äî</div><div class="euribor-change" id="eur-3m-chg">‚Äî</div></div>
        <div class="euribor-box"><div class="euribor-label">6 Meses</div><div class="euribor-val" id="eur-6m">‚Äî</div><div class="euribor-change" id="eur-6m-chg">‚Äî</div></div>
        <div class="euribor-box"><div class="euribor-label">12 Meses</div><div class="euribor-val" id="eur-12m">‚Äî</div><div class="euribor-change" id="eur-12m-chg">‚Äî</div></div>
      </div>
      <div id="eur-updated" style="text-align:center;font-size:0.65rem;color:var(--muted);margin-top:6px;"></div>
    </div>

    <!-- ‚ïê‚ïê TAXAS: SPREADS ‚ïê‚ïê -->
    <div class="tab-content" id="tab-spreads">
      <div class="hero-card"><div class="hero-label">Melhor Spread</div><div class="hero-value"><span class="accent">0.85%</span></div><div class="hero-sub">Caixa Geral de Dep√≥sitos</div><div class="hero-badge">üè† Cr√©dito Habita√ß√£o</div></div>
      <p class="section-title">Spreads ‚Äî Cr√©dito Habita√ß√£o</p>
      <div class="rate-card"><div class="rate-left"><div class="rate-logo">CGD</div><div><div class="rate-name">Caixa Geral Dep.</div><div class="rate-type">Cr√©dito Habita√ß√£o</div></div></div><div><div class="rate-value">0.85%</div><div class="rate-period">spread</div></div></div>
      <div class="rate-card"><div class="rate-left"><div class="rate-logo">BPI</div><div><div class="rate-name">Banco BPI</div><div class="rate-type">Cr√©dito Habita√ß√£o</div></div></div><div><div class="rate-value">0.95%</div><div class="rate-period">spread</div></div></div>
      <div class="rate-card"><div class="rate-left"><div class="rate-logo">SNT</div><div><div class="rate-name">Santander</div><div class="rate-type">Cr√©dito Habita√ß√£o</div></div></div><div><div class="rate-value">1.00%</div><div class="rate-period">spread</div></div></div>
      <div class="rate-card" style="margin-bottom:20px"><div class="rate-left"><div class="rate-logo">NVB</div><div><div class="rate-name">Novobanco</div><div class="rate-type">Cr√©dito Habita√ß√£o</div></div></div><div><div class="rate-value">1.10%</div><div class="rate-period">spread</div></div></div>
    </div>

  </div><!-- end scroll -->

  <div class="bottom-nav">
    <button class="nav-btn active" onclick="switchSection('perfil', this)"><div class="nav-icon">üë§</div><div class="nav-label">Perfil</div></button>
    <button class="nav-btn" onclick="switchSection('simular', this)"><div class="nav-icon">üßÆ</div><div class="nav-label">Simular</div></button>
    <button class="nav-btn" onclick="switchSection('poupanca', this)"><div class="nav-icon">üè¶</div><div class="nav-label">Poupan√ßa</div></button>
    <button class="nav-btn" onclick="switchSection('taxas', this)"><div class="nav-icon">üìà</div><div class="nav-label">Taxas</div></button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
// ============================================================
// SUPABASE CLIENT
// ============================================================
const SUPABASE_URL = 'https://zdjfscurtpbmdzybjaqf.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpkamZzY3VydHBibWR6eWJqYXFmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE5NTY0MDUsImV4cCI6MjA4NzUzMjQwNX0.ZqSqKwGcy8GzOsk7Ui500vatlMKhn-g6EK7lHrfkU-w';
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

const EDGE_URL = 'https://zdjfscurtpbmdzybjaqf.supabase.co/functions/v1/calcular';
const ANON_KEY = SUPABASE_KEY;

let currentUser = null;
let currentPerfil = null;
let mesAtual = new Date();
mesAtual.setDate(1);

// ‚îÄ‚îÄ Formatters ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const fmt    = v => v.toLocaleString('pt-PT', {minimumFractionDigits:2, maximumFractionDigits:2}) + ' ‚Ç¨';
const fmtPct = v => v.toFixed(2) + '%';
const fmtK   = v => Math.abs(v) >= 1000
  ? (v/1000).toFixed(1) + 'k ‚Ç¨'
  : v.toFixed(0) + ' ‚Ç¨';

// ============================================================
// AUTH
// ============================================================
function switchAuthTab(tab, el) {
  document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('auth-form-login').style.display  = tab === 'login'    ? '' : 'none';
  document.getElementById('auth-form-register').style.display= tab === 'register' ? '' : 'none';
  document.getElementById('magic-sent').style.display        = 'none';
  document.getElementById('auth-error').textContent          = '';
}

function setAuthError(msg) { document.getElementById('auth-error').textContent = msg; }

async function doLogin() {
  const email = document.getElementById('auth-email-login').value.trim();
  const pass  = document.getElementById('auth-pass-login').value;
  if (!email || !pass) return setAuthError('Preenche email e palavra-passe.');
  const { error } = await sb.auth.signInWithPassword({ email, password: pass });
  if (error) return setAuthError(error.message);
}

async function doRegister() {
  const nome  = document.getElementById('auth-name').value.trim();
  const email = document.getElementById('auth-email-reg').value.trim();
  const pass  = document.getElementById('auth-pass-reg').value;
  if (!nome || !email || !pass) return setAuthError('Preenche todos os campos.');
  if (pass.length < 6) return setAuthError('Palavra-passe m√≠nimo 6 caracteres.');
  const { data, error } = await sb.auth.signUp({ email, password: pass, options: { data: { nome } } });
  if (error) return setAuthError(error.message);
  // Criar perfil
  if (data.user) {
    await sb.from('perfis').upsert({ id: data.user.id, nome });
  }
  setAuthError('‚úÖ Conta criada! Verifica o email de confirma√ß√£o.');
}

async function doMagicLink() {
  const email = document.getElementById('auth-email-login').value.trim();
  if (!email) return setAuthError('Introduz o teu email primeiro.');
  const { error } = await sb.auth.signInWithOtp({ email });
  if (error) return setAuthError(error.message);
  document.getElementById('auth-form-login').style.display = 'none';
  document.getElementById('magic-sent').style.display = 'block';
  document.getElementById('magic-email-display').textContent = email;
}

async function doLogout() {
  await sb.auth.signOut();
}

// ‚îÄ‚îÄ Auth state listener ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
sb.auth.onAuthStateChange(async (event, session) => {
  if (session?.user) {
    currentUser = session.user;
    document.getElementById('auth-screen').classList.add('hidden');
    await carregarPerfil();
    renderDashboard();
  } else {
    currentUser = null;
    currentPerfil = null;
    document.getElementById('auth-screen').classList.remove('hidden');
  }
});

// ‚îÄ‚îÄ Carregar perfil do utilizador ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function carregarPerfil() {
  if (!currentUser) return;
  const { data } = await sb.from('perfis').select('*').eq('id', currentUser.id).single();
  currentPerfil = data;
  const nome   = data?.nome || currentUser.email.split('@')[0];
  const initials = nome.split(' ').map(n => n[0]).join('').substring(0,2).toUpperCase();
  // Header avatar
  document.getElementById('avatar-btn').textContent = initials;
  // Dashboard
  document.getElementById('dash-avatar').textContent = initials;
  document.getElementById('dash-nome').textContent   = nome;
  document.getElementById('dash-email').textContent  = currentUser.email;
  // Defini√ß√µes
  document.getElementById('def-nome-hero').textContent  = nome;
  document.getElementById('def-email-hero').textContent = currentUser.email;
  if (data?.nome)          document.getElementById('def-nome').value         = data.nome;
  if (data?.data_nasc)     document.getElementById('def-datanasc').value     = data.data_nasc;
  if (data?.estado_civil)  document.getElementById('def-estadocivil').value  = data.estado_civil;
  if (data?.n_dep != null) document.getElementById('def-ndep').value         = data.n_dep;
  // Pr√©-preencher simuladores com dados do perfil
  if (data?.estado_civil) document.getElementById('irs-estadoCivil').value = data.estado_civil;
  if (data?.n_dep != null) document.getElementById('irs-dependentes').value = data.n_dep;
}

async function guardarPerfil() {
  if (!currentUser) return;
  const payload = {
    id:           currentUser.id,
    nome:         document.getElementById('def-nome').value.trim(),
    data_nasc:    document.getElementById('def-datanasc').value || null,
    estado_civil: document.getElementById('def-estadocivil').value,
    n_dep:        parseInt(document.getElementById('def-ndep').value) || 0,
  };
  const { error } = await sb.from('perfis').upsert(payload);
  const fb = document.getElementById('perfil-feedback');
  if (error) { fb.style.color = 'var(--red)'; fb.textContent = '‚ùå ' + error.message; }
  else {
    fb.style.color = 'var(--green)';
    fb.textContent = '‚úÖ Perfil guardado!';
    await carregarPerfil();
    setTimeout(() => fb.textContent = '', 3000);
  }
}

// ============================================================
// MOVIMENTOS FINANCEIROS
// ============================================================
let tipoMovimento = 'income';

function selectTipo(tipo) {
  tipoMovimento = tipo;
  document.getElementById('tipo-income').classList.toggle('active', tipo === 'income');
  document.getElementById('tipo-expense').classList.toggle('active', tipo === 'expense');
}

async function guardarMovimento() {
  if (!currentUser) return;
  const descricao  = document.getElementById('reg-descricao').value.trim();
  const valor      = parseFloat(document.getElementById('reg-valor').value);
  const categoria  = document.getElementById('reg-categoria').value;
  const data       = document.getElementById('reg-data').value;
  const notas      = document.getElementById('reg-notas').value.trim();
  const fb         = document.getElementById('reg-feedback');
  if (!descricao || !valor || !data) { fb.style.color='var(--red)'; fb.textContent='‚ö†Ô∏è Preenche descri√ß√£o, valor e data.'; return; }
  const { error } = await sb.from('movimentos').insert({
    user_id:   currentUser.id,
    tipo:      tipoMovimento,
    descricao,
    valor:     Math.abs(valor),
    categoria,
    data,
    notas: notas || null,
  });
  if (error) { fb.style.color='var(--red)'; fb.textContent='‚ùå ' + error.message; return; }
  fb.style.color = 'var(--green)';
  fb.textContent = '‚úÖ Movimento guardado!';
  // Limpar campos
  document.getElementById('reg-descricao').value = '';
  document.getElementById('reg-valor').value     = '';
  document.getElementById('reg-notas').value     = '';
  await renderDashboard();
  setTimeout(() => fb.textContent = '', 3000);
}

async function apagarMovimento(id) {
  if (!confirm('Apagar este movimento?')) return;
  await sb.from('movimentos').delete().eq('id', id);
  await renderDashboard();
}

// ‚îÄ‚îÄ Dashboard ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function mudaMes(dir) {
  mesAtual.setMonth(mesAtual.getMonth() + dir);
  renderDashboard();
}

async function renderDashboard() {
  if (!currentUser) return;
  const ano = mesAtual.getFullYear();
  const mes = mesAtual.getMonth() + 1;
  const ini = `${ano}-${String(mes).padStart(2,'0')}-01`;
  const fim = `${ano}-${String(mes).padStart(2,'0')}-31`;

  document.getElementById('mes-label').textContent = mesAtual.toLocaleDateString('pt-PT', { month: 'long', year: 'numeric' });

  const { data: movs } = await sb.from('movimentos')
    .select('*')
    .eq('user_id', currentUser.id)
    .gte('data', ini)
    .lte('data', fim)
    .order('data', { ascending: false });

  const lista = movs || [];
  const rendTotal = lista.filter(m => m.tipo === 'income').reduce((s,m) => s + parseFloat(m.valor), 0);
  const despTotal = lista.filter(m => m.tipo === 'expense').reduce((s,m) => s + parseFloat(m.valor), 0);
  const saldo     = rendTotal - despTotal;

  document.getElementById('dash-rendimentos').textContent  = fmtK(rendTotal);
  document.getElementById('dash-despesas').textContent     = fmtK(despTotal);
  document.getElementById('dash-n-rendimentos').textContent= lista.filter(m=>m.tipo==='income').length + ' entradas';
  document.getElementById('dash-n-despesas').textContent   = lista.filter(m=>m.tipo==='expense').length + ' sa√≠das';
  const saldoEl = document.getElementById('dash-saldo-mes');
  saldoEl.textContent  = fmtK(saldo);
  saldoEl.style.color  = saldo >= 0 ? 'var(--green)' : 'var(--red)';

  // Stats do hero (total hist√≥rico)
  const { data: todos } = await sb.from('movimentos').select('tipo,valor').eq('user_id', currentUser.id);
  const tRend  = (todos||[]).filter(m=>m.tipo==='income').reduce((s,m)=>s+parseFloat(m.valor),0);
  const tDesp  = (todos||[]).filter(m=>m.tipo==='expense').reduce((s,m)=>s+parseFloat(m.valor),0);
  const tSaldo = tRend - tDesp;
  // meses com dados
  const mesesComDados = new Set((todos||[]).map(m => m.data?.substring(0,7))).size;
  document.getElementById('stat-saldo').textContent   = fmtK(tSaldo);
  document.getElementById('stat-poupanca').textContent= fmtK(tRend);
  document.getElementById('stat-meses').textContent   = mesesComDados;

  // Lista movimentos
  const container = document.getElementById('lista-movimentos');
  if (lista.length === 0) {
    container.innerHTML = '<div class="empty-state">Sem movimentos registados neste m√™s.<br><small>Vai a "Registar" para adicionar.</small></div>';
    return;
  }
  container.innerHTML = lista.map(m => {
    const isIncome = m.tipo === 'income';
    return `<div class="registo-item">
      <div class="registo-icon ${m.tipo}">${isIncome ? 'üíö' : 'üî¥'}</div>
      <div class="registo-info">
        <div class="registo-nome">${m.descricao}</div>
        <div class="registo-cat">${m.categoria} ¬∑ ${new Date(m.data+'T12:00:00').toLocaleDateString('pt-PT', {day:'numeric',month:'short'})}</div>
      </div>
      <div class="registo-valor ${m.tipo}">${isIncome ? '+' : '-'}${fmt(parseFloat(m.valor))}</div>
      <button class="registo-del" onclick="apagarMovimento(${m.id})">‚úï</button>
    </div>`;
  }).join('');
}

// ============================================================
// NAV & TAB SYSTEM
// ============================================================
const sections = {
  perfil: {
    tabs: [
      { label: 'Dashboard', id: 'dashboard' },
      { label: 'Registar', id: 'registar' },
      { label: 'Defini√ß√µes', id: 'definicoes' },
    ],
    default: 'dashboard'
  },
  simular: {
    tabs: [
      { label: 'Sal√°rio L√≠quido', id: 'salario' },
      { label: 'Taxa de Esfor√ßo', id: 'esforco' },
      { label: 'IMT', id: 'imt' },
      { label: 'Poupan√ßa', id: 'sim-poupanca' },
      { label: 'Investimento', id: 'investimento' },
      { label: 'Infla√ß√£o', id: 'inflacao' },
    ],
    default: 'salario'
  },
  poupanca: {
    tabs: [
      { label: 'Dep√≥sitos a Prazo', id: 'dep-prazo' },
      { label: 'Certificados', id: 'certificados' },
    ],
    default: 'dep-prazo'
  },
  taxas: {
    tabs: [
      { label: 'Euribor', id: 'euribor' },
      { label: 'Spreads', id: 'spreads' },
    ],
    default: 'euribor'
  }
};

function renderSubTabs(section, activeId) {
  const bar = document.getElementById('sub-tab-bar');
  bar.innerHTML = '';
  sections[section].tabs.forEach(t => {
    const btn = document.createElement('button');
    btn.className = 'sub-tab-btn' + (t.id === activeId ? ' active' : '');
    btn.textContent = t.label;
    btn.onclick = () => {
      document.querySelectorAll('.sub-tab-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      showTab(t.id);
    };
    bar.appendChild(btn);
  });
}

function switchSection(section, navBtn) {
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  navBtn.classList.add('active');
  const def = sections[section].default;
  renderSubTabs(section, def);
  showTab(def);
}

function showTab(tabId) {
  document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
  const el = document.getElementById('tab-' + tabId);
  if (el) el.classList.add('active');
  if (tabId === 'dep-prazo' && allDeposits.length === 0) loadDeposits();
  if (tabId === 'euribor') loadEuribor();
  // Definir data de hoje no registo
  if (tabId === 'registar') {
    const today = new Date().toISOString().split('T')[0];
    if (!document.getElementById('reg-data').value) document.getElementById('reg-data').value = today;
  }
}

renderSubTabs('perfil', 'dashboard');

// ‚îÄ‚îÄ Euribor ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadEuribor() {
  try {
    const data = await chamarAPI('euribor', {});
    if (!Array.isArray(data) || data.length === 0) return;
    const byPrazo = Object.fromEntries(data.map(d => [d.prazo, d]));
    function renderBox(id, chgId, prazo) {
      const d = byPrazo[prazo]; if (!d) return;
      document.getElementById(id).textContent = d.taxa.toFixed(3) + '%';
      const chgEl = document.getElementById(chgId);
      if (d.variacao !== null) {
        const sign = d.variacao > 0 ? '‚ñ≤ +' : d.variacao < 0 ? '‚ñº ' : '= ';
        chgEl.textContent = sign + d.variacao.toFixed(3) + '%';
        chgEl.className   = 'euribor-change ' + (d.variacao > 0 ? 'up' : d.variacao < 0 ? 'down' : 'flat');
      }
    }
    renderBox('eur-3m',  'eur-3m-chg',  '3M');
    renderBox('eur-6m',  'eur-6m-chg',  '6M');
    renderBox('eur-12m', 'eur-12m-chg', '12M');
    const e12 = byPrazo['12M'];
    if (e12) {
      document.getElementById('eur-hero-val').textContent   = e12.taxa.toFixed(3) + '%';
      document.getElementById('eur-hero-label').textContent = `Euribor 12M ¬∑ ${new Date(e12.data_obs).toLocaleDateString('pt-PT', { month: 'long', year: 'numeric' })}`;
      if (e12.variacao !== null) {
        const sign = e12.variacao > 0 ? '‚ñ≤ +' : '‚ñº ';
        const badge = document.getElementById('eur-hero-badge');
        badge.textContent = sign + e12.variacao.toFixed(3) + '% vs dia anterior';
        badge.className   = 'hero-badge ' + (e12.variacao < 0 ? 'down' : 'up');
      }
    }
    const latest = data.reduce((a, b) => a.updated_at > b.updated_at ? a : b);
    const dtStr  = new Date(latest.updated_at).toLocaleString('pt-PT', { dateStyle: 'short', timeStyle: 'short' });
    document.getElementById('eur-updated').textContent  = `Fonte: ECB ¬∑ √öltima actualiza√ß√£o: ${dtStr}`;
    document.getElementById('eur-hero-sub').textContent = 'Fonte BCE ¬∑ Actualiza√ß√£o di√°ria autom√°tica';
  } catch (e) { console.warn('Euribor:', e.message); }
}

function selectChip(el, group) {
  document.querySelectorAll('#' + group + ' .chip').forEach(c => c.classList.remove('active'));
  el.classList.add('active');
}

// ============================================================
// EDGE FUNCTION
// ============================================================
async function chamarAPI(acao, params) {
  const res = await fetch(EDGE_URL, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${ANON_KEY}`,
      'apikey': ANON_KEY,
    },
    body: JSON.stringify({ acao, params }),
  });
  const data = await res.json();
  if (!data.ok) throw new Error(data.erro ?? 'Erro desconhecido');
  return data.resultado;
}

function setLoading(btn, loading) {
  if (!btn) return;
  if (loading) { btn.dataset.original = btn.textContent; btn.textContent = '‚è≥ A calcular...'; btn.disabled = true; btn.style.opacity = '0.7'; }
  else { btn.textContent = btn.dataset.original || btn.textContent; btn.disabled = false; btn.style.opacity = ''; }
}

// ‚îÄ‚îÄ 1. SAL√ÅRIO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function calcSalarioCompleto() {
  const btn = document.querySelector('#tab-salario .calc-btn');
  setLoading(btn, true);
  try {
    const r = await chamarAPI('salario', {
      base: parseFloat(document.getElementById('irs-base').value)||0,
      extras: parseFloat(document.getElementById('irs-extras').value)||0,
      outros: parseFloat(document.getElementById('irs-outros').value)||0,
      isentos: parseFloat(document.getElementById('irs-isentos').value)||0,
      nDep: parseInt(document.getElementById('irs-dependentes').value)||0,
      subV: parseFloat(document.getElementById('irs-subAlimValor').value)||0,
      subD: parseInt(document.getElementById('irs-subAlimDias').value)||0,
      tipoPag: document.getElementById('irs-tipoPagAlim').value,
      percDuo: parseFloat(document.getElementById('irs-duodecimos').value)||0,
      taxaSS: parseFloat(document.getElementById('irs-taxaSS').value)||11,
      estadoCivil: document.getElementById('irs-estadoCivil').value,
      incap: document.getElementById('irs-incapacidade').checked,
    });
    document.getElementById('hero-liquido').textContent = fmt(r.liquido);
    document.getElementById('hero-sal-sub').textContent = 'L√≠quido ¬∑ IRS ' + fmtPct(r.taxaMarginal * 100) + ' marginal ¬∑ SS ' + fmtPct(r.taxaSSDecimal * 100);
    document.getElementById('rr-base').textContent = fmt(r.base);
    document.getElementById('rr-subAlim').textContent = fmt(r.subAlimTotal);
    const showExtras = r.extras > 0; const showDuo = r.duoBruto > 0; const showTrib = r.subAlimTrib > 0;
    document.getElementById('rr-box-extras').style.display = showExtras ? '' : 'none';
    if (showExtras) document.getElementById('rr-extras').textContent = fmt(r.extras);
    document.getElementById('rr-box-duo').style.display = showDuo ? '' : 'none';
    if (showDuo) document.getElementById('rr-duo').textContent = fmt(r.duoBruto);
    document.getElementById('rr-box-trib').style.display = showTrib ? '' : 'none';
    if (showTrib) document.getElementById('rr-subAlimTrib').textContent = fmt(r.subAlimTrib);
    document.getElementById('bd-taxaSS-pct').textContent = fmtPct(r.taxaSSDecimal * 100);
    document.getElementById('bd-totalBruto').textContent = fmt(r.totalBruto);
    document.getElementById('bd-ss').textContent = fmt(r.valorSS);
    document.getElementById('bd-taxaIRS').textContent = fmtPct(r.taxaMarginal * 100) + ' marginal';
    document.getElementById('bd-totalIRS').textContent = fmt(r.totalIRS);
    document.getElementById('bd-totalDesc').textContent = fmt(r.totalDesc);
    document.getElementById('bd-liquido').textContent = fmt(r.liquido);
    document.getElementById('bd-taxaEfetiva').textContent = fmtPct(r.taxaEfetiva);
    document.getElementById('bd-row-irsExtras').style.display = showExtras ? '' : 'none';
    if (showExtras) document.getElementById('bd-irsExtras').textContent = fmt(r.irsExtras);
    document.getElementById('bd-row-irsDuo').style.display = showDuo ? '' : 'none';
    if (showDuo) document.getElementById('bd-irsDuo').textContent = fmt(r.irsDuo);
    document.getElementById('rr-liquido').textContent = fmt(r.liquido);
    document.getElementById('rr-descontos').textContent = fmt(r.totalDesc);
    document.getElementById('rr-taxaEfetiva').textContent = fmtPct(r.taxaEfetiva);
    document.getElementById('irs-results-block').style.display = 'block';
    document.querySelector('.scroll-area').scrollTo({ top: 500, behavior: 'smooth' });
  } catch (e) { alert('Erro: ' + e.message); } finally { setLoading(btn, false); }
}

// ‚îÄ‚îÄ 2. DSTI ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function esf_atualizarPrazo() {
  const dn1 = document.getElementById('esf-dn1').value;
  if (!dn1) { document.getElementById('esf-prazo-info').style.display = 'none'; return; }
  try {
    const r = await chamarAPI('prazo_max', { dn1, dn2: document.getElementById('esf-dn2').value || undefined });
    const infoEl = document.getElementById('esf-prazo-info');
    const prazoInput = document.getElementById('esf-prazo');
    prazoInput.max = r.prazoMax;
    if (parseInt(prazoInput.value) > r.prazoMax) prazoInput.value = r.prazoMax;
    const anos = Math.floor(r.prazoMax / 12); const meses = r.prazoMax % 12;
    infoEl.style.display = 'block';
    infoEl.textContent = `Prazo m√°ximo BdP: ${meses > 0 ? anos+'a '+meses+'m' : anos+' anos'} (titular mais velho: ${r.idade} anos)`;
    prazoInput.value = r.prazoMax;
  } catch (_) {}
}

async function calcEsforco() {
  const btn = document.querySelector('#tab-esforco .calc-btn');
  setLoading(btn, true);
  try {
    const r = await chamarAPI('dsti', {
      rend1: parseFloat(document.getElementById('esf-rend1').value)||0,
      rend2: parseFloat(document.getElementById('esf-rend2').value)||0,
      op1: parseFloat(document.getElementById('esf-op1').value)||0,
      enc1: parseFloat(document.getElementById('esf-enc1').value)||0,
      op2: parseFloat(document.getElementById('esf-op2').value)||0,
      encMut: parseFloat(document.getElementById('esf-encMutuos').value)||0,
      vImovel: parseFloat(document.getElementById('esf-vImovel').value)||0,
      montante: parseFloat(document.getElementById('esf-montante').value)||0,
      taxa: parseFloat(document.getElementById('esf-taxa').value)||0,
      prazo: parseInt(document.getElementById('esf-prazo').value)||0,
      dn1: document.getElementById('esf-dn1').value,
      dn2: document.getElementById('esf-dn2').value || undefined,
    });
    document.getElementById('hero-esforco').textContent = fmtPct(r.te);
    document.getElementById('hero-esforco-sub').textContent = `DSTI ${fmtPct(r.dsti)} ¬∑ LTV ${fmtPct(r.ltv)}`;
    document.getElementById('res-esforco').textContent = fmtPct(r.te);
    document.getElementById('res-dsti').textContent = fmtPct(r.dsti);
    document.getElementById('res-ltv').textContent = fmtPct(r.ltv);
    document.getElementById('bd-esf-prest').textContent = fmt(r.prest);
    document.getElementById('bd-esf-prestStress').textContent = fmt(r.prestStress);
    document.getElementById('bd-esf-rendTotal').textContent = fmt(r.rendTotalMens);
    document.getElementById('bd-esf-rendAjust').textContent = fmt(r.rendTotalAjust);
    const prazoMaxStr = r.prazoMaxMeses > 0 ? `${r.prazoMaxAnos}a ${r.prazoMaxMeses}m` : `${r.prazoMaxAnos} anos`;
    document.getElementById('bd-esf-prazoMax').textContent = prazoMaxStr;
    document.getElementById('bd-esf-te').textContent = fmtPct(r.te);
    document.getElementById('bd-esf-dsti').textContent = fmtPct(r.dsti);
    document.getElementById('bd-esf-ltv').textContent = fmtPct(r.ltv);
    document.getElementById('res-maxTE').textContent = fmt(r.valMaxTE);
    document.getElementById('res-maxDSTI').textContent = fmt(r.valMaxDSTI);
    document.getElementById('res-maxLTV').textContent = fmt(r.valMaxLTV);
    document.getElementById('res-maxRec').textContent = fmt(r.valMaxRec);
    esf_setBar('esf-fill-te','esf-box-te',r.te,60);
    esf_setBar('esf-fill-dsti','esf-box-dsti',r.dsti,50);
    esf_setBar('esf-fill-ltv','esf-box-ltv',r.ltv,90);
    document.getElementById('esf-results-block').style.display = 'block';
    document.querySelector('.scroll-area').scrollTo({ top: 600, behavior: 'smooth' });
  } catch (e) { alert('Erro: ' + e.message); } finally { setLoading(btn, false); }
}

function esf_barColor(pct) { return pct < 70 ? 'var(--green)' : pct < 90 ? 'var(--amber)' : 'var(--red)'; }
function esf_setBar(fillId, boxId, valor, limite) {
  const pct = Math.min((valor / limite) * 100, 100);
  const color = esf_barColor(pct);
  const fill = document.getElementById(fillId);
  const box = document.getElementById(boxId);
  setTimeout(() => { fill.style.width = pct + '%'; fill.style.background = color; }, 60);
  box.style.borderColor = color;
  box.style.background = pct < 70 ? 'rgba(0,200,150,0.05)' : pct < 90 ? 'rgba(245,158,11,0.06)' : 'rgba(255,61,107,0.07)';
}

// ‚îÄ‚îÄ 3. IMT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function calcIMT() {
  const btn = document.querySelector('#tab-imt .calc-btn');
  setLoading(btn, true);
  try {
    const r = await chamarAPI('imt', {
      valor: parseFloat(document.getElementById('imt-valor').value)||0,
      tipo: document.querySelector('#imt-chips .chip.active')?.textContent.includes('Pr√≥pria') ? 'propria' : 'secundaria',
    });
    document.getElementById('res-imt').textContent = fmt(r.imt);
    document.getElementById('res-selo').textContent = fmt(r.selo);
    document.getElementById('res-imt-total').textContent = fmt(r.total);
    document.getElementById('hero-imt').textContent = fmt(r.total);
    document.getElementById('imt-results').style.display = 'grid';
  } catch (e) { alert('Erro: ' + e.message); } finally { setLoading(btn, false); }
}

// ‚îÄ‚îÄ 4. POUPAN√áA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function calcPoupanca() {
  const btn = document.querySelector('#tab-sim-poupanca .calc-btn');
  setLoading(btn, true);
  try {
    const capLabel = document.querySelector('#p-cap-chips .chip.active')?.textContent || '6 Meses';
    const capMap = { 'Mensal': 1, '3 Meses': 3, '6 Meses': 6, '12 Meses': 12 };
    const r = await chamarAPI('poupanca', {
      capital: parseFloat(document.getElementById('p-capital').value)||0,
      mensal: parseFloat(document.getElementById('p-mensal').value)||0,
      taxa: parseFloat(document.getElementById('p-taxa').value)||0,
      retencao: parseFloat(document.getElementById('p-retencao').value)||28,
      anos: parseFloat(document.getElementById('p-anos').value)||0,
      capMeses: capMap[capLabel.trim()] || 6,
    });
    document.getElementById('res-p-liquido').textContent = fmt(r.saldo);
    document.getElementById('res-p-depositado').textContent = fmt(r.totalDep);
    document.getElementById('res-p-juros-brutos').textContent = fmt(r.jurosBrutos);
    document.getElementById('res-p-retencao').textContent = fmt(r.retTotal);
    document.getElementById('res-p-juros-liq').textContent = fmt(r.jurosLiquidos);
    document.getElementById('bd-p-taxa-liq').textContent = fmtPct(r.taxaLiqAnualPct);
    document.getElementById('bd-p-cap').textContent = capLabel;
    document.getElementById('bd-p-periodos').textContent = r.totalPeriods + ' per√≠odos';
    document.getElementById('bd-p-rentab').textContent = fmtPct(r.rentabTotal) + ' total';
    document.getElementById('p-results').style.display = 'block';
    document.getElementById('hero-poup').textContent = fmt(r.saldo);
  } catch (e) { alert('Erro: ' + e.message); } finally { setLoading(btn, false); }
}

// ‚îÄ‚îÄ 5. INVESTIMENTO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function calcInvestimento() {
  const btn = document.querySelector('#tab-investimento .calc-btn');
  setLoading(btn, true);
  try {
    const r = await chamarAPI('investimento', {
      capital: parseFloat(document.getElementById('inv-capital').value)||0,
      mensal: parseFloat(document.getElementById('inv-mensal').value)||0,
      taxa: parseFloat(document.getElementById('inv-taxa').value)||0,
      retencao: parseFloat(document.getElementById('inv-retencao').value)||28,
      anos: parseFloat(document.getElementById('inv-anos').value)||0,
    });
    document.getElementById('res-inv-liq').textContent = fmt(r.finalLiq);
    document.getElementById('res-inv-dep').textContent = fmt(r.totalInv);
    document.getElementById('res-inv-bruto').textContent = fmt(r.ganhoBruto);
    document.getElementById('res-inv-imposto').textContent = fmt(r.imposto);
    document.getElementById('res-inv-liquido').textContent = fmt(r.ganhoLiq);
    document.getElementById('bd-inv-taxa-liq').textContent = fmtPct(r.taxaLiqEf);
    document.getElementById('bd-inv-mult').textContent = 'x' + r.multiplicador.toFixed(2);
    document.getElementById('bd-inv-rentab').textContent = fmtPct(r.rentabLiq);
    document.getElementById('inv-results').style.display = 'block';
    document.getElementById('hero-inv').textContent = fmt(r.finalLiq);
  } catch (e) { alert('Erro: ' + e.message); } finally { setLoading(btn, false); }
}

// ‚îÄ‚îÄ 6. INFLA√á√ÉO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function calcInflacao() {
  const btn = document.querySelector('#tab-inflacao .calc-btn');
  setLoading(btn, true);
  try {
    const r = await chamarAPI('inflacao', {
      valor: parseFloat(document.getElementById('inf-valor').value)||0,
      taxa: parseFloat(document.getElementById('inf-taxa').value)||0,
      anos: parseFloat(document.getElementById('inf-anos').value)||0,
    });
    document.getElementById('res-inf-futuro').textContent = fmt(r.futuro);
    document.getElementById('res-inf-perda').textContent = fmt(r.perda);
    document.getElementById('hero-inf').textContent = fmt(r.futuro);
    document.getElementById('inf-results').style.display = 'grid';
  } catch (e) { alert('Erro: ' + e.message); } finally { setLoading(btn, false); }
}

// ============================================================
// DEPOSITS
// ============================================================
let allDeposits = [];
let activeFilters = { novos_capitais: null, novos_clientes: null };
let sortAsc = false;

async function loadDeposits() {
  try {
    const res = await fetch(`${SUPABASE_URL}/rest/v1/Taxas%20DP?select=*&order=TANB.desc`,
      { headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}`, 'Content-Type': 'application/json' } });
    if (!res.ok) throw new Error(await res.text());
    allDeposits = await res.json();
    applyFilters();
  } catch(e) {
    document.getElementById('dp-list').innerHTML = '<div class="empty-state">‚ùå Erro: ' + e.message + '</div>';
  }
}

function toggleFilter(key) {
  if (activeFilters[key] === null) activeFilters[key] = true;
  else if (activeFilters[key] === true) activeFilters[key] = false;
  else activeFilters[key] = null;
  const el = document.getElementById('ft-' + key.replace('_','-'));
  if (el) {
    el.classList.toggle('active', activeFilters[key] !== null);
    el.classList.toggle('filter-neg', activeFilters[key] === false);
    const base = key === 'novos_capitais' ? 'Novos Capitais' : 'Novos Clientes';
    if (activeFilters[key] === true) el.querySelector('.ft-label').textContent = '‚úì ' + base;
    else if (activeFilters[key] === false) el.querySelector('.ft-label').textContent = '‚úó ' + base;
    else el.querySelector('.ft-label').textContent = base;
  }
  applyFilters();
}

function toggleSort() {
  sortAsc = !sortAsc;
  const btn = document.getElementById('sort-btn');
  if (btn) btn.textContent = (sortAsc ? '‚Üë' : '‚Üì') + ' TANB';
  applyFilters();
}

function applyFilters() {
  const fMin = parseFloat(document.getElementById('f-dep-min')?.value) || null;
  const fMax = parseFloat(document.getElementById('f-dep-max')?.value) || null;
  const normalized = allDeposits.map(normalizeRow);
  let filtered = normalized.filter(d => {
    if (activeFilters.novos_capitais === true  && !d.novos_capitais) return false;
    if (activeFilters.novos_capitais === false &&  d.novos_capitais) return false;
    if (activeFilters.novos_clientes === true  && !d.novos_clientes) return false;
    if (activeFilters.novos_clientes === false &&  d.novos_clientes) return false;
    if (fMin !== null && d.deposito_minimo !== null && d.deposito_minimo > fMin) return false;
    if (fMax !== null && d.deposito_maximo !== null && d.deposito_maximo < fMax) return false;
    return true;
  });
  filtered.sort((a, b) => sortAsc ? a.tanb - b.tanb : b.tanb - a.tanb);
  renderDeposits(filtered);
}

function getBankAbbr(banco) {
  if (!banco) return '??';
  const map = { 'Activobank':'ACTV','Caixa Geral de Dep√≥sitos':'CGD','Banco BPI':'BPI','BPI':'BPI','Millennium BCP':'BCP','BCP':'BCP','Banco Santander':'SNT','Santander':'SNT','Novobanco':'NVB','Banco CTT':'CTT','CTT':'CTT','Montepio':'MTPO','Cr√©dito Agr√≠cola':'CA' };
  return map[banco] || banco.substring(0,4).toUpperCase();
}

function ptNum(val) {
  if (val === null || val === undefined || val === '') return null;
  const s = String(val).trim();
  if (s.includes(',')) return parseFloat(s.replace(/\./g, '').replace(',', '.'));
  return parseFloat(s.replace(/\s/g, '')) || null;
}

function normalizeRow(d) {
  return {
    id: d.id || Math.random(),
    banco: d['Banco'] || '‚Äî',
    prazo: d['Prazo'] || '‚Äî',
    unidade: d['Dias /meses /anos'] || '',
    nome_deposito: d['Nome do Dep√≥sito'] || '‚Äî',
    tanb: ptNum(d['TANB']) || 0,
    tanl: ptNum(d['TANL']),
    tipo_taxa: d['Tipo de Taxa'] || 'Fixa',
    deposito_minimo: ptNum(d['Dep√≥sito M√≠nimo']),
    deposito_maximo: ptNum(d['Dep√≥sito M√°ximo']),
    mobilizacao: d['Perda de juros com mobiliza√ß√£o antecipada'] || '‚Äî',
    novos_capitais: d['Novos capitais?'] === 'Sim' || d['Novos capitais?'] === true || false,
    novos_clientes: d['Novos clientes?'] === 'Sim' || d['Novos clientes?'] === true || false,
    fin: d['FIN (use o endere√ßo)'] || '',
  };
}

function renderDeposits(list) {
  const container = document.getElementById('dp-list');
  const countEl   = document.getElementById('dp-count');
  if (!container) return;
  if (countEl) countEl.textContent = list.length + ' resultado' + (list.length !== 1 ? 's' : '');
  if (list.length === 0) { container.innerHTML = '<div class="empty-state">üòï Nenhum dep√≥sito corresponde aos filtros.</div>'; return; }
  const best = list[0];
  const bestRateEl = document.getElementById('dp-best-rate');
  const bestSubEl  = document.getElementById('dp-best-sub');
  if (bestRateEl) bestRateEl.textContent = best.tanb.toFixed(2) + '%';
  if (bestSubEl)  bestSubEl.textContent  = best.banco + ' ¬∑ ' + best.prazo + ' ' + best.unidade + ' ¬∑ l√≠q: ' + (best.tanl || best.tanb * 0.72).toFixed(2) + '%';
  container.innerHTML = list.map(d => {
    const tanl = d.tanl || parseFloat((d.tanb * 0.72).toFixed(2));
    const ret1k = ((d.tanb - tanl) * 10).toFixed(2);
    const juros1k = (tanl * 10).toFixed(2);
    const abbr = getBankAbbr(d.banco);
    const prazoStr = d.prazo + (d.unidade ? ' ' + d.unidade : '');
    const uid = String(d.id).replace(/[^a-z0-9]/gi, '_');
    return `<div class="dp-card" id="dp-card-${uid}">
      <div class="dp-card-header" onclick="toggleDpCard('${uid}')">
        <div class="dp-card-left"><div class="dp-logo">${abbr}</div><div><div class="dp-name">${d.banco}</div><div class="dp-sub">${d.nome_deposito} ¬∑ ${prazoStr}</div></div></div>
        <div class="dp-rate-col"><div class="dp-tanb">${d.tanb.toFixed(2)}%</div><div class="dp-tanl">l√≠q. ${tanl.toFixed(2)}%</div></div>
        <div class="dp-expand-icon">‚ñæ</div>
      </div>
      <div class="dp-details">
        <div class="dp-detail-row"><span class="dp-dk">TANB (bruta)</span><span class="dp-dv">${d.tanb.toFixed(2)}%</span></div>
        <div class="dp-detail-row"><span class="dp-dk">TANL (l√≠quida ap√≥s 28%)</span><span class="dp-dv green">${tanl.toFixed(2)}%</span></div>
        <div class="dp-detail-row"><span class="dp-dk">Reten√ß√£o Estado (por ‚Ç¨1.000)</span><span class="dp-dv red">${ret1k} ‚Ç¨</span></div>
        <div class="dp-detail-row"><span class="dp-dk">Juros l√≠quidos (por ‚Ç¨1.000)</span><span class="dp-dv">${juros1k} ‚Ç¨</span></div>
        <div class="dp-detail-row"><span class="dp-dk">Tipo de Taxa</span><span class="dp-dv">${d.tipo_taxa}</span></div>
        <div class="dp-detail-row"><span class="dp-dk">Dep√≥sito M√≠nimo</span><span class="dp-dv">${d.deposito_minimo ? d.deposito_minimo.toLocaleString('pt-PT') + ' ‚Ç¨' : '‚Äî'}</span></div>
        <div class="dp-detail-row"><span class="dp-dk">Dep√≥sito M√°ximo</span><span class="dp-dv">${d.deposito_maximo ? d.deposito_maximo.toLocaleString('pt-PT') + ' ‚Ç¨' : 'Sem limite'}</span></div>
        <div class="dp-detail-row"><span class="dp-dk">Mobiliza√ß√£o Antecipada</span><span class="dp-dv amber">${d.mobilizacao}</span></div>
        <div class="dp-tags">
          <span class="dp-tag ${d.novos_capitais ? 'green' : 'gray'}">${d.novos_capitais ? '‚úì' : '‚úó'} Novos Capitais</span>
          <span class="dp-tag ${d.novos_clientes ? 'green' : 'gray'}">${d.novos_clientes ? '‚úì' : '‚úó'} Novos Clientes</span>
        </div>
        ${d.fin ? `<a class="dp-fin-link" href="${d.fin}" target="_blank">üìÑ Ver Ficha de Informa√ß√£o Normalizada ‚Üí</a>` : ''}
      </div>
    </div>`;
  }).join('');
}

function toggleDpCard(id) { document.getElementById('dp-card-' + id)?.classList.toggle('open'); }

// ‚îÄ‚îÄ PWA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/sw.js')
      .then(reg => console.log('SW registado:', reg.scope))
      .catch(err => console.warn('SW erro:', err));
  });
}
</script>
</body>
</html>
