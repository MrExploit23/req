<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f1923">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="LitFinanceira">
<link rel="apple-touch-icon" href="icon-192.png">
<title>Literacia Financeira</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --green: #00c896;
    --green-light: rgba(0,200,150,0.08);
    --navy: #0a1628;
    --bg: #f4f7fb;
    --bg2: #eef2f8;
    --white: #ffffff;
    --border: rgba(0,0,0,0.07);
    --border-green: rgba(0,200,150,0.25);
    --text: #0d1b2e;
    --muted: #8fa0b8;
    --red: #ff3d6b;
    --amber: #f59e0b;
    --shadow-sm: 0 2px 8px rgba(0,0,0,0.06);
    --shadow-md: 0 8px 24px rgba(0,0,0,0.09);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  html, body { height: 100%; background: var(--bg); color: var(--text); font-family: 'Outfit', sans-serif; overflow: hidden; }

  .phone { max-width: 420px; height: 100dvh; margin: 0 auto; display: flex; flex-direction: column; overflow: hidden; background: var(--bg); position: relative; }
  .phone::before { content: ''; position: fixed; top: -100px; right: -80px; width: 280px; height: 280px; border-radius: 50%; background: radial-gradient(circle, rgba(0,200,150,0.1), transparent 70%); pointer-events: none; z-index: 0; }

  /* ── AUTH SCREEN ── */
  .auth-screen { position: absolute; inset: 0; background: var(--navy); z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 32px 28px; }
  .auth-screen.hidden { display: none; }
  .auth-logo { width: 64px; height: 64px; background: rgba(0,200,150,0.15); border: 1px solid var(--border-green); border-radius: 20px; display: flex; align-items: center; justify-content: center; font-family: 'Syne', sans-serif; font-weight: 800; font-size: 1.1rem; color: var(--green); margin-bottom: 20px; }
  .auth-title { font-family: 'Syne', sans-serif; font-weight: 800; font-size: 1.6rem; color: #fff; text-align: center; margin-bottom: 6px; }
  .auth-sub { font-size: 0.82rem; color: rgba(255,255,255,0.4); text-align: center; margin-bottom: 36px; line-height: 1.5; }
  .auth-card { width: 100%; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 24px; }
  .auth-tabs { display: flex; gap: 4px; background: rgba(255,255,255,0.06); border-radius: 12px; padding: 4px; margin-bottom: 22px; }
  .auth-tab { flex: 1; padding: 8px; border-radius: 9px; border: none; background: transparent; color: rgba(255,255,255,0.4); font-family: 'Outfit', sans-serif; font-size: 0.82rem; font-weight: 600; cursor: pointer; transition: all 0.2s; }
  .auth-tab.active { background: var(--green); color: var(--navy); }
  .auth-input { width: 100%; background: rgba(255,255,255,0.07); border: 1.5px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 13px 16px; color: #fff; font-family: 'Outfit', sans-serif; font-size: 0.92rem; font-weight: 500; outline: none; margin-bottom: 12px; transition: border-color 0.2s; }
  .auth-input::placeholder { color: rgba(255,255,255,0.25); }
  .auth-input:focus { border-color: var(--green); }
  .auth-btn { width: 100%; background: var(--green); color: var(--navy); border: none; border-radius: 12px; padding: 14px; font-family: 'Syne', sans-serif; font-size: 0.88rem; font-weight: 800; cursor: pointer; transition: all 0.2s; margin-top: 4px; letter-spacing: 0.02em; }
  .auth-btn:active { transform: scale(0.98); opacity: 0.9; }
  .auth-error { font-size: 0.75rem; color: var(--red); text-align: center; margin-top: 10px; min-height: 18px; }
  .auth-magic-sent { display: none; text-align: center; }
  .auth-magic-sent .magic-icon { font-size: 2.5rem; margin-bottom: 12px; }
  .auth-magic-sent p { color: rgba(255,255,255,0.7); font-size: 0.85rem; line-height: 1.6; }
  .auth-magic-sent strong { color: var(--green); }

  /* ── HEADER ── */
  .header { padding: 16px 20px 10px; display: flex; align-items: center; justify-content: space-between; flex-shrink: 0; position: relative; z-index: 1; }
  .logo-mark { display: flex; align-items: center; gap: 10px; }
  .logo-icon { width: 38px; height: 38px; background: var(--navy); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-family: 'Syne', sans-serif; font-weight: 800; font-size: 0.72rem; color: var(--green); box-shadow: 0 4px 12px rgba(10,22,40,0.25); }
  .logo-text { font-family: 'Syne', sans-serif; font-weight: 800; font-size: 0.95rem; color: var(--text); line-height: 1.1; }
  .logo-text span { display: block; font-size: 0.58rem; font-weight: 500; color: var(--muted); letter-spacing: 0.1em; text-transform: uppercase; }
  .header-right { display: flex; gap: 8px; }
  .icon-btn { width: 38px; height: 38px; border-radius: 12px; background: var(--white); border: 1px solid var(--border); box-shadow: var(--shadow-sm); display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 1rem; transition: all 0.2s; }
  .icon-btn:active { transform: scale(0.94); }
  .avatar-btn { width: 38px; height: 38px; border-radius: 12px; background: var(--navy); border: none; display: flex; align-items: center; justify-content: center; cursor: pointer; font-family: 'Syne', sans-serif; font-size: 0.75rem; font-weight: 800; color: var(--green); box-shadow: 0 4px 12px rgba(10,22,40,0.2); }

  .sub-tab-bar { display: flex; padding: 0 16px 10px; gap: 6px; flex-shrink: 0; overflow-x: auto; scrollbar-width: none; position: relative; z-index: 1; }
  .sub-tab-bar::-webkit-scrollbar { display: none; }
  .sub-tab-btn { flex-shrink: 0; padding: 7px 16px; border-radius: 20px; border: 1.5px solid var(--border); background: var(--white); color: var(--muted); font-family: 'Outfit', sans-serif; font-size: 0.74rem; font-weight: 600; cursor: pointer; transition: all 0.2s; white-space: nowrap; box-shadow: var(--shadow-sm); }
  .sub-tab-btn.active { background: var(--navy); border-color: var(--navy); color: var(--green); box-shadow: 0 4px 14px rgba(10,22,40,0.2); }

  .scroll-area { flex: 1; overflow-y: auto; padding: 4px 16px 16px; scrollbar-width: none; position: relative; z-index: 1; }
  .scroll-area::-webkit-scrollbar { display: none; }

  .tab-content { display: none; }
  .tab-content.active { display: block; animation: fadeUp 0.25s ease both; }

  /* ── HERO CARDS ── */
  .hero-card { background: var(--navy); border-radius: 22px; padding: 22px; margin-bottom: 16px; position: relative; overflow: hidden; box-shadow: 0 12px 40px rgba(10,22,40,0.22); }
  .hero-card::before { content: ''; position: absolute; top: -60px; right: -60px; width: 180px; height: 180px; border-radius: 50%; background: radial-gradient(circle, rgba(0,200,150,0.2), transparent 70%); }
  .hero-label { font-size: 0.68rem; text-transform: uppercase; letter-spacing: 0.12em; color: rgba(255,255,255,0.4); margin-bottom: 6px; position: relative; z-index: 1; }
  .hero-value { font-family: 'Syne', sans-serif; font-size: 2.2rem; font-weight: 800; color: #fff; line-height: 1; margin-bottom: 4px; position: relative; z-index: 1; }
  .hero-value .accent { color: var(--green); }
  .hero-sub { font-size: 0.75rem; color: rgba(255,255,255,0.45); position: relative; z-index: 1; }
  .hero-badge { display: inline-flex; align-items: center; gap: 5px; background: rgba(0,200,150,0.15); border: 1px solid rgba(0,200,150,0.25); border-radius: 20px; padding: 4px 12px; font-size: 0.68rem; color: var(--green); margin-top: 14px; position: relative; z-index: 1; font-weight: 600; }

  /* ── PROFILE / DASHBOARD ── */
  .profile-hero { background: var(--navy); border-radius: 22px; padding: 22px; margin-bottom: 16px; position: relative; overflow: hidden; box-shadow: 0 12px 40px rgba(10,22,40,0.22); }
  .profile-hero::before { content: ''; position: absolute; top: -60px; right: -60px; width: 200px; height: 200px; border-radius: 50%; background: radial-gradient(circle, rgba(0,200,150,0.18), transparent 70%); }
  .profile-avatar { width: 52px; height: 52px; border-radius: 16px; background: rgba(0,200,150,0.2); border: 1.5px solid var(--border-green); display: flex; align-items: center; justify-content: center; font-family: 'Syne', sans-serif; font-size: 1.1rem; font-weight: 800; color: var(--green); margin-bottom: 12px; position: relative; z-index: 1; }
  .profile-name { font-family: 'Syne', sans-serif; font-size: 1.3rem; font-weight: 800; color: #fff; position: relative; z-index: 1; }
  .profile-email { font-size: 0.72rem; color: rgba(255,255,255,0.4); margin-top: 2px; position: relative; z-index: 1; }
  .profile-stats { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-top: 16px; position: relative; z-index: 1; }
  .profile-stat { background: rgba(255,255,255,0.06); border-radius: 12px; padding: 10px; text-align: center; }
  .profile-stat-val { font-family: 'Syne', sans-serif; font-size: 1rem; font-weight: 800; color: var(--green); }
  .profile-stat-label { font-size: 0.58rem; color: rgba(255,255,255,0.35); text-transform: uppercase; letter-spacing: 0.06em; margin-top: 2px; }

  .dash-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 14px; }
  .dash-card { background: var(--white); border: 1px solid var(--border); border-radius: 16px; padding: 14px; box-shadow: var(--shadow-sm); }
  .dash-card.full { grid-column: 1/-1; }
  .dash-card.income { border-left: 3px solid var(--green); }
  .dash-card.expense { border-left: 3px solid var(--red); }
  .dash-card.savings { border-left: 3px solid var(--amber); }
  .dash-icon { font-size: 1.1rem; margin-bottom: 6px; }
  .dash-label { font-size: 0.62rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 4px; }
  .dash-value { font-family: 'Syne', sans-serif; font-size: 1.05rem; font-weight: 800; color: var(--text); }
  .dash-sub { font-size: 0.65rem; color: var(--muted); margin-top: 2px; }
  .dash-delta { font-size: 0.65rem; font-weight: 700; margin-top: 3px; }
  .dash-delta.up { color: var(--green); }
  .dash-delta.down { color: var(--red); }

  .month-bar { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
  .month-nav { display: flex; align-items: center; gap: 10px; }
  .month-btn { width: 30px; height: 30px; border-radius: 8px; border: 1px solid var(--border); background: var(--white); display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 0.8rem; color: var(--muted); box-shadow: var(--shadow-sm); }
  .month-label { font-family: 'Syne', sans-serif; font-size: 0.85rem; font-weight: 700; color: var(--text); }

  /* ── REGISTOS ── */
  .registo-list { margin-top: 4px; }
  .registo-item { display: flex; align-items: center; gap: 12px; padding: 11px 14px; background: var(--white); border: 1px solid var(--border); border-radius: 14px; margin-bottom: 8px; box-shadow: var(--shadow-sm); }
  .registo-icon { width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; flex-shrink: 0; }
  .registo-icon.income { background: rgba(0,200,150,0.1); }
  .registo-icon.expense { background: rgba(255,61,107,0.1); }
  .registo-info { flex: 1; min-width: 0; }
  .registo-nome { font-size: 0.83rem; font-weight: 600; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .registo-cat { font-size: 0.65rem; color: var(--muted); margin-top: 1px; }
  .registo-valor { font-family: 'Syne', sans-serif; font-size: 0.95rem; font-weight: 800; }
  .registo-valor.income { color: var(--green); }
  .registo-valor.expense { color: var(--red); }
  .registo-del { width: 28px; height: 28px; border-radius: 8px; border: none; background: rgba(255,61,107,0.08); color: var(--red); cursor: pointer; font-size: 0.75rem; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }

  /* ── FAB (add button) ── */
  .fab { position: fixed; bottom: 90px; right: calc(50% - 200px); width: 52px; height: 52px; border-radius: 16px; background: var(--navy); border: none; color: var(--green); font-size: 1.4rem; cursor: pointer; box-shadow: 0 8px 24px rgba(10,22,40,0.3); z-index: 20; display: none; align-items: center; justify-content: center; transition: all 0.2s; }
  .fab:active { transform: scale(0.94); }
  .fab.visible { display: flex; }

  /* ── MODAL ── */
  .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 50; display: none; align-items: flex-end; justify-content: center; backdrop-filter: blur(4px); }
  .modal-overlay.open { display: flex; }
  .modal { background: var(--white); border-radius: 24px 24px 0 0; width: 100%; max-width: 420px; padding: 24px 20px 36px; animation: slideUp 0.3s cubic-bezier(0.34,1.56,0.64,1); }
  .modal-handle { width: 36px; height: 4px; background: var(--bg2); border-radius: 2px; margin: 0 auto 20px; }
  .modal-title { font-family: 'Syne', sans-serif; font-size: 1rem; font-weight: 800; color: var(--text); margin-bottom: 18px; }
  .modal-type-row { display: flex; gap: 8px; margin-bottom: 16px; }
  .type-btn { flex: 1; padding: 10px; border-radius: 12px; border: 1.5px solid var(--border); background: var(--bg); font-family: 'Outfit', sans-serif; font-size: 0.8rem; font-weight: 700; cursor: pointer; transition: all 0.2s; color: var(--muted); }
  .type-btn.income.active { background: rgba(0,200,150,0.1); border-color: var(--green); color: #008c69; }
  .type-btn.expense.active { background: rgba(255,61,107,0.1); border-color: var(--red); color: var(--red); }
  @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

  /* ── SETTINGS DENTRO DO PERFIL ── */
  .settings-row { display: flex; align-items: center; justify-content: space-between; padding: 13px 0; border-bottom: 1px solid var(--bg2); }
  .settings-row:last-child { border-bottom: none; }
  .settings-label { font-size: 0.85rem; font-weight: 500; color: var(--text); }
  .settings-sub { font-size: 0.7rem; color: var(--muted); margin-top: 1px; }
  .settings-action { font-size: 0.8rem; color: var(--green); font-weight: 600; cursor: pointer; }
  .logout-btn { width: 100%; background: rgba(255,61,107,0.08); border: 1.5px solid rgba(255,61,107,0.2); border-radius: 14px; padding: 13px; color: var(--red); font-family: 'Syne', sans-serif; font-size: 0.85rem; font-weight: 700; cursor: pointer; margin-top: 16px; }

  /* ── SIM CARDS ── */
  .section-title { font-family: 'Syne', sans-serif; font-size: 0.68rem; text-transform: uppercase; letter-spacing: 0.14em; color: var(--muted); margin-bottom: 10px; margin-top: 20px; padding-left: 2px; }
  .sim-card { background: var(--white); border: 1px solid var(--border); border-radius: 18px; padding: 16px; margin-bottom: 10px; box-shadow: var(--shadow-sm); }
  .sim-card-title { font-family: 'Syne', sans-serif; font-weight: 700; font-size: 0.88rem; color: var(--text); display: flex; align-items: center; gap: 10px; margin-bottom: 14px; }
  .sim-icon { width: 34px; height: 34px; border-radius: 10px; background: var(--green-light); border: 1px solid var(--border-green); display: flex; align-items: center; justify-content: center; font-size: 0.9rem; flex-shrink: 0; }
  .input-group { margin-bottom: 10px; }
  .input-label { font-size: 0.7rem; color: var(--muted); margin-bottom: 5px; font-weight: 500; display: flex; justify-content: space-between; align-items: center; }
  .input-wrapper { position: relative; }
  .input-field { width: 100%; background: var(--bg); border: 1.5px solid var(--border); border-radius: 12px; padding: 11px 44px 11px 14px; color: var(--text); font-family: 'Outfit', sans-serif; font-size: 0.92rem; font-weight: 600; outline: none; transition: border-color 0.2s, box-shadow 0.2s; }
  .input-field:focus { border-color: var(--green); box-shadow: 0 0 0 3px var(--green-light); background: var(--white); }
  .input-unit { position: absolute; right: 14px; top: 50%; transform: translateY(-50%); font-size: 0.72rem; color: var(--muted); font-weight: 700; }
  .select-field { width: 100%; background: var(--bg); border: 1.5px solid var(--border); border-radius: 12px; padding: 11px 14px; color: var(--text); font-family: 'Outfit', sans-serif; font-size: 0.88rem; font-weight: 600; outline: none; transition: border-color 0.2s; appearance: none; -webkit-appearance: none; cursor: pointer; }
  .select-field:focus { border-color: var(--green); box-shadow: 0 0 0 3px var(--green-light); background: var(--white); }
  .card-section-label { font-family: 'Syne', sans-serif; font-size: 0.62rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em; color: var(--green); border-top: 1px solid var(--bg2); padding-top: 12px; margin: 12px 0 10px; }
  .check-row { display: flex; align-items: center; gap: 10px; padding: 8px 0; }
  .check-row input[type="checkbox"] { width: 18px; height: 18px; accent-color: var(--green); cursor: pointer; flex-shrink: 0; }
  .check-row label { font-size: 0.82rem; color: var(--text); font-weight: 500; cursor: pointer; }
  .calc-btn { width: 100%; background: var(--navy); color: #fff; border: none; border-radius: 14px; padding: 14px; font-family: 'Syne', sans-serif; font-size: 0.85rem; font-weight: 700; cursor: pointer; transition: all 0.2s; margin-top: 4px; letter-spacing: 0.03em; box-shadow: 0 6px 20px rgba(10,22,40,0.2); position: relative; overflow: hidden; }
  .calc-btn::after { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px; background: linear-gradient(90deg, transparent, rgba(0,200,150,0.5), transparent); }
  .calc-btn:active { transform: scale(0.98); }
  .result-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 12px; }
  .result-box { background: var(--bg); border: 1px solid var(--border); border-radius: 12px; padding: 11px 14px; }
  .result-box.highlight { background: var(--navy); border-color: var(--navy); }
  .result-box.highlight-red { background: rgba(255,61,107,0.08); border-color: rgba(255,61,107,0.2); }
  .result-box.highlight-amber { background: rgba(245,158,11,0.08); border-color: rgba(245,158,11,0.2); }
  .result-label { font-size: 0.62rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 3px; }
  .result-box.highlight .result-label { color: rgba(255,255,255,0.4); }
  .result-box.highlight-red .result-label { color: rgba(255,61,107,0.6); }
  .result-box.highlight-amber .result-label { color: rgba(245,158,11,0.6); }
  .result-value { font-family: 'Syne', sans-serif; font-size: 0.98rem; font-weight: 800; color: var(--text); }
  .result-box.highlight .result-value { color: var(--green); }
  .result-box.highlight-red .result-value { color: var(--red); }
  .result-box.highlight-amber .result-value { color: var(--amber); }
  .mortgage-breakdown { background: var(--navy); border-radius: 18px; padding: 18px; margin-top: 12px; box-shadow: 0 8px 30px rgba(10,22,40,0.18); }
  .breakdown-title { font-family: 'Syne', sans-serif; font-size: 0.72rem; font-weight: 700; color: rgba(255,255,255,0.5); margin-bottom: 14px; text-transform: uppercase; letter-spacing: 0.08em; }
  .breakdown-row { display: flex; justify-content: space-between; align-items: center; padding: 9px 0; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 0.8rem; }
  .breakdown-row:last-child { border-bottom: none; }
  .breakdown-row .key { color: rgba(255,255,255,0.45); }
  .breakdown-row .val { font-weight: 700; color: #fff; }
  .breakdown-row .val.green { color: var(--green); }
  .breakdown-row .val.red { color: var(--red); }
  .breakdown-row .val.amber { color: var(--amber); }
  .chip-row { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px; }
  .chip { padding: 6px 13px; border-radius: 20px; border: 1.5px solid var(--border); background: var(--bg); font-size: 0.72rem; font-weight: 600; color: var(--muted); cursor: pointer; transition: all 0.2s; }
  .chip.active { background: var(--green-light); border-color: var(--green); color: #008c69; }
  .progress-bar { height: 6px; background: var(--bg2); border-radius: 3px; margin-top: 12px; overflow: hidden; }
  .progress-fill { height: 100%; border-radius: 3px; background: var(--green); transition: width 0.8s cubic-bezier(0.4,0,0.2,1); }
  .info-box { background: rgba(0,200,150,0.06); border: 1px solid var(--border-green); border-radius: 12px; padding: 10px 14px; margin-bottom: 12px; font-size: 0.75rem; color: #008c69; line-height: 1.5; }
  .retention-tag { display: inline-flex; align-items: center; gap: 4px; background: rgba(245,158,11,0.1); border: 1px solid rgba(245,158,11,0.25); border-radius: 20px; padding: 3px 10px; font-size: 0.65rem; color: var(--amber); font-weight: 700; margin-left: 6px; }
  .legal-note { font-size: 0.7rem; color: var(--muted); line-height: 1.5; margin-top: 12px; padding: 10px 12px; background: var(--bg2); border-radius: 10px; }

  /* ── DEPOSITS ── */
  .product-card { background: var(--white); border: 1px solid var(--border); border-radius: 18px; padding: 16px; margin-bottom: 10px; box-shadow: var(--shadow-sm); }
  .product-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
  .product-left { display: flex; align-items: center; gap: 12px; }
  .product-logo { width: 40px; height: 40px; border-radius: 12px; background: var(--navy); display: flex; align-items: center; justify-content: center; font-size: 0.62rem; font-weight: 800; color: var(--green); text-align: center; flex-shrink: 0; }
  .product-name { font-weight: 700; font-size: 0.85rem; color: var(--text); }
  .product-type { font-size: 0.67rem; color: var(--muted); margin-top: 1px; }
  .product-rate { font-family: 'Syne', sans-serif; font-size: 1.2rem; font-weight: 800; color: var(--text); text-align: right; }
  .product-rate-label { font-size: 0.62rem; color: var(--muted); text-align: right; }
  .product-detail-row { display: flex; justify-content: space-between; padding: 5px 0; border-top: 1px solid var(--bg2); font-size: 0.75rem; }
  .product-detail-row .dk { color: var(--muted); }
  .product-detail-row .dv { font-weight: 600; color: var(--text); }
  .product-detail-row .dv.green { color: var(--green); }
  .product-detail-row .dv.red { color: var(--red); }

  .filter-block { background: var(--white); border: 1px solid var(--border); border-radius: 16px; padding: 14px; margin-bottom: 12px; box-shadow: var(--shadow-sm); }
  .filter-row { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
  .filter-toggle { display: flex; align-items: center; gap: 6px; padding: 7px 14px; border-radius: 20px; border: 1.5px solid var(--border); background: var(--bg); font-size: 0.72rem; font-weight: 600; color: var(--muted); cursor: pointer; transition: all 0.2s; white-space: nowrap; }
  .filter-toggle.active { background: var(--green-light); border-color: var(--green); color: #008c69; }
  .filter-toggle.filter-neg { background: rgba(255,61,107,0.08); border-color: rgba(255,61,107,0.3); color: var(--red); }
  .filter-toggle.filter-neg .ft-dot { background: var(--red); }
  .ft-dot { width: 8px; height: 8px; border-radius: 50%; background: currentColor; opacity: 0.5; }
  .filter-toggle.active .ft-dot { opacity: 1; }
  .sort-btn { margin-left: auto; padding: 7px 14px; border-radius: 20px; border: 1.5px solid var(--navy); background: var(--navy); color: var(--green); font-size: 0.7rem; font-weight: 700; cursor: pointer; white-space: nowrap; font-family: 'Outfit', sans-serif; }
  .filter-input-wrap { display: flex; align-items: center; gap: 6px; flex: 1; background: var(--bg); border: 1.5px solid var(--border); border-radius: 12px; padding: 8px 12px; }
  .fi-label { font-size: 0.65rem; color: var(--muted); font-weight: 600; white-space: nowrap; }
  .fi-input { flex: 1; border: none; background: transparent; outline: none; font-family: 'Outfit', sans-serif; font-size: 0.82rem; font-weight: 600; color: var(--text); width: 0; min-width: 0; }
  .fi-unit { font-size: 0.65rem; color: var(--muted); font-weight: 700; }
  .results-count { font-size: 0.68rem; color: var(--muted); margin-top: 8px; text-align: right; }
  .dp-card { background: var(--white); border: 1px solid var(--border); border-radius: 16px; margin-bottom: 8px; box-shadow: var(--shadow-sm); overflow: hidden; }
  .dp-card-header { display: flex; align-items: center; justify-content: space-between; padding: 14px 16px; cursor: pointer; }
  .dp-card-left { display: flex; align-items: center; gap: 12px; }
  .dp-logo { width: 40px; height: 40px; border-radius: 12px; background: var(--navy); display: flex; align-items: center; justify-content: center; font-size: 0.58rem; font-weight: 800; color: var(--green); text-align: center; line-height: 1.2; flex-shrink: 0; }
  .dp-name { font-weight: 700; font-size: 0.83rem; color: var(--text); }
  .dp-sub { font-size: 0.67rem; color: var(--muted); margin-top: 1px; }
  .dp-rate-col { text-align: right; }
  .dp-tanb { font-family: 'Syne', sans-serif; font-size: 1.1rem; font-weight: 800; color: var(--text); }
  .dp-tanl { font-size: 0.68rem; color: var(--green); font-weight: 600; margin-top: 1px; }
  .dp-expand-icon { width: 24px; height: 24px; border-radius: 6px; background: var(--bg2); display: flex; align-items: center; justify-content: center; font-size: 0.75rem; color: var(--muted); margin-left: 8px; transition: transform 0.2s; flex-shrink: 0; }
  .dp-card.open .dp-expand-icon { transform: rotate(180deg); }
  .dp-details { display: none; border-top: 1px solid var(--bg2); padding: 12px 16px; background: var(--bg); }
  .dp-card.open .dp-details { display: block; animation: fadeUp 0.2s ease; }
  .dp-detail-row { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid var(--border); font-size: 0.78rem; }
  .dp-detail-row:last-child { border-bottom: none; }
  .dp-dk { color: var(--muted); }
  .dp-dv { font-weight: 600; color: var(--text); }
  .dp-dv.green { color: var(--green); }
  .dp-dv.red { color: var(--red); }
  .dp-dv.amber { color: var(--amber); }
  .dp-tags { display: flex; gap: 6px; flex-wrap: wrap; margin-top: 10px; }
  .dp-tag { padding: 3px 10px; border-radius: 20px; font-size: 0.62rem; font-weight: 700; }
  .dp-tag.green { background: var(--green-light); color: #008c69; border: 1px solid var(--border-green); }
  .dp-tag.gray { background: var(--bg2); color: var(--muted); border: 1px solid var(--border); }
  .dp-fin-link { display: flex; align-items: center; gap: 6px; margin-top: 10px; padding: 9px 14px; background: var(--navy); border-radius: 10px; color: var(--green); font-size: 0.75rem; font-weight: 600; text-decoration: none; }
  .loading-state { text-align: center; padding: 40px 20px; color: var(--muted); font-size: 0.85rem; }
  .empty-state { text-align: center; padding: 40px 20px; color: var(--muted); font-size: 0.85rem; }

  /* ── TAXAS ── */
  .euribor-strip { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 16px; }
  .euribor-box { background: var(--white); border: 1px solid var(--border); border-radius: 14px; padding: 14px 10px; text-align: center; box-shadow: var(--shadow-sm); }
  .euribor-label { font-size: 0.62rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 5px; font-weight: 600; }
  .euribor-val { font-family: 'Syne', sans-serif; font-size: 1.05rem; font-weight: 800; color: var(--text); }
  .euribor-change { font-size: 0.63rem; margin-top: 3px; font-weight: 600; }
  .up { color: var(--red); } .down { color: var(--green); }
  .rate-card { background: var(--white); border: 1px solid var(--border); border-radius: 16px; padding: 14px 16px; margin-bottom: 8px; display: flex; align-items: center; justify-content: space-between; box-shadow: var(--shadow-sm); }
  .rate-left { display: flex; align-items: center; gap: 12px; }
  .rate-logo { width: 40px; height: 40px; border-radius: 12px; background: var(--navy); display: flex; align-items: center; justify-content: center; font-size: 0.62rem; font-weight: 800; color: var(--green); }
  .rate-name { font-weight: 700; font-size: 0.83rem; color: var(--text); }
  .rate-type { font-size: 0.67rem; color: var(--muted); margin-top: 1px; }
  .rate-value { font-family: 'Syne', sans-serif; font-size: 1.15rem; font-weight: 800; color: var(--text); text-align: right; }
  .rate-period { font-size: 0.62rem; color: var(--muted); text-align: right; margin-top: 1px; }

  /* ── NAV ── */
  .bottom-nav { display: flex; padding: 8px 12px 22px; gap: 4px; background: var(--white); border-top: 1px solid var(--border); flex-shrink: 0; box-shadow: 0 -8px 24px rgba(0,0,0,0.06); position: relative; z-index: 10; }
  .nav-btn { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 3px; padding: 8px 4px; border-radius: 14px; background: transparent; border: none; cursor: pointer; transition: all 0.2s; color: var(--muted); }
  .nav-btn.active { background: var(--navy); color: var(--green); }
  .nav-icon { font-size: 1.05rem; }
  .nav-label { font-size: 0.52rem; font-weight: 700; font-family: 'Outfit', sans-serif; }


  .etf-filter-bar { display: flex; gap: 6px; overflow-x: auto; scrollbar-width: none; margin-bottom: 10px; padding-bottom: 2px; }
  .etf-filter-bar::-webkit-scrollbar { display: none; }
  .etf-cat-btn { flex-shrink: 0; padding: 6px 14px; border-radius: 20px; border: 1.5px solid var(--border); background: var(--white); font-size: 0.7rem; font-weight: 600; color: var(--muted); cursor: pointer; transition: all 0.2s; white-space: nowrap; }
  .etf-cat-btn.active { background: var(--navy); border-color: var(--navy); color: var(--green); }
  .etf-card { background: var(--white); border: 1px solid var(--border); border-radius: 16px; margin-bottom: 8px; box-shadow: var(--shadow-sm); overflow: hidden; }
  .etf-header { display: flex; align-items: center; justify-content: space-between; padding: 14px 16px; cursor: pointer; gap: 8px; }
  .etf-logo { width: 40px; height: 40px; border-radius: 12px; background: var(--navy); display: flex; align-items: center; justify-content: center; font-size: 0.52rem; font-weight: 800; color: var(--green); text-align: center; line-height: 1.2; flex-shrink: 0; }
  .etf-info { flex: 1; min-width: 0; }
  .etf-name { font-weight: 700; font-size: 0.82rem; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .etf-sub  { font-size: 0.65rem; color: var(--muted); margin-top: 1px; }
  .etf-right { text-align: right; flex-shrink: 0; }
  .etf-price { font-family: 'Syne', sans-serif; font-size: 0.95rem; font-weight: 800; color: var(--text); }
  .etf-chg { font-size: 0.7rem; font-weight: 700; margin-top: 2px; }
  .etf-chg.up { color: var(--green); } .etf-chg.down { color: var(--red); } .etf-chg.flat { color: var(--muted); }
  .etf-expand-icon { width: 22px; height: 22px; border-radius: 6px; background: var(--bg2); display: flex; align-items: center; justify-content: center; font-size: 0.7rem; color: var(--muted); flex-shrink: 0; transition: transform 0.2s; }
  .etf-card.open .etf-expand-icon { transform: rotate(180deg); }

  .etf-details { display: none; border-top: 1px solid var(--bg2); padding: 12px 16px; background: var(--bg); }
  .etf-card.open .etf-details { display: block; animation: fadeUp 0.2s ease; }
  .etf-detail-row { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid var(--border); font-size: 0.78rem; }
  .etf-detail-row:last-child { border-bottom: none; }
  .etf-dk { color: var(--muted); } .etf-dv { font-weight: 600; color: var(--text); }
  .etf-dv.green { color: var(--green); } .etf-dv.red { color: var(--red); } .etf-dv.amber { color: var(--amber); }
  .etf-tags { display: flex; gap: 6px; flex-wrap: wrap; margin-top: 10px; }
  .etf-tag { padding: 3px 10px; border-radius: 20px; font-size: 0.62rem; font-weight: 700; background: var(--bg2); color: var(--muted); border: 1px solid var(--border); }
  .etf-tag.green { background: var(--green-light); color: #008c69; border-color: var(--border-green); }
  .etf-tag.amber { background: rgba(245,158,11,0.1); color: var(--amber); border-color: rgba(245,158,11,0.25); }

  .login-prompt { background: var(--navy); border-radius: 18px; padding: 20px; margin-bottom: 16px; display: flex; align-items: center; justify-content: space-between; gap: 12px; }
  .login-prompt-text { font-size: 0.8rem; color: rgba(255,255,255,0.5); line-height: 1.5; }
  .login-prompt-text strong { color: #fff; display: block; font-size: 0.88rem; margin-bottom: 3px; }
  .login-prompt-btn { flex-shrink: 0; background: var(--green); color: var(--navy); border: none; border-radius: 12px; padding: 10px 18px; font-family: 'Syne', sans-serif; font-size: 0.78rem; font-weight: 800; cursor: pointer; white-space: nowrap; }

  .disclaimer-modal { position: fixed; inset: 0; background: var(--bg); z-index: 200; display: none; flex-direction: column; overflow: hidden; }
  .disclaimer-modal.open { display: flex; }
  .disclaimer-header { background: var(--navy); padding: 20px 20px 16px; display: flex; align-items: center; justify-content: space-between; flex-shrink: 0; }
  .disclaimer-title { font-family: 'Syne', sans-serif; font-size: 0.9rem; font-weight: 800; color: #fff; }
  .disclaimer-close { width: 34px; height: 34px; border-radius: 10px; background: rgba(255,255,255,0.1); border: none; color: rgba(255,255,255,0.7); font-size: 1rem; cursor: pointer; display: flex; align-items: center; justify-content: center; }
  .disclaimer-body { flex: 1; overflow-y: auto; padding: 20px; scrollbar-width: none; }
  .disclaimer-body::-webkit-scrollbar { display: none; }
  .disclaimer-section { margin-bottom: 20px; }
  .disclaimer-num { font-family: 'Syne', sans-serif; font-size: 0.7rem; font-weight: 800; color: var(--green); text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 6px; }
  .disclaimer-heading { font-family: 'Syne', sans-serif; font-size: 0.92rem; font-weight: 800; color: var(--text); margin-bottom: 8px; }
  .disclaimer-text { font-size: 0.8rem; color: #4a5568; line-height: 1.7; }
  .disclaimer-note { background: rgba(0,200,150,0.06); border: 1px solid var(--border-green); border-radius: 12px; padding: 12px 14px; font-size: 0.75rem; color: #008c69; line-height: 1.6; margin-bottom: 16px; display: flex; gap: 10px; align-items: flex-start; cursor: pointer; }
  .disclaimer-note-icon { font-size: 1rem; flex-shrink: 0; margin-top: 1px; }
  .disclaimer-note-text { flex: 1; }
  .disclaimer-note-link { font-weight: 700; text-decoration: underline; text-underline-offset: 2px; white-space: nowrap; flex-shrink: 0; font-size: 0.7rem; margin-top: 2px; }

  .guia-hero { background: var(--navy); border-radius: 22px; padding: 22px; margin-bottom: 16px; position: relative; overflow: hidden; box-shadow: 0 12px 40px rgba(10,22,40,0.22); }
  .guia-hero::before { content: ''; position: absolute; top: -60px; right: -60px; width: 200px; height: 200px; border-radius: 50%; background: radial-gradient(circle, rgba(0,200,150,0.18), transparent 70%); }
  .guia-hero-label { font-size: 0.68rem; text-transform: uppercase; letter-spacing: 0.12em; color: rgba(255,255,255,0.4); margin-bottom: 6px; position: relative; z-index: 1; }
  .guia-hero-title { font-family: 'Syne', sans-serif; font-size: 1.4rem; font-weight: 800; color: #fff; line-height: 1.15; margin-bottom: 8px; position: relative; z-index: 1; }
  .guia-hero-title span { color: var(--green); }
  .guia-hero-sub { font-size: 0.75rem; color: rgba(255,255,255,0.45); position: relative; z-index: 1; line-height: 1.5; }
  .guia-badges { display: flex; gap: 6px; flex-wrap: wrap; margin-top: 14px; position: relative; z-index: 1; }
  .guia-badge { display: inline-flex; align-items: center; gap: 5px; background: rgba(0,200,150,0.15); border: 1px solid rgba(0,200,150,0.25); border-radius: 20px; padding: 4px 12px; font-size: 0.66rem; color: var(--green); font-weight: 600; }
  .guia-part-header { background: var(--navy); border-radius: 16px; padding: 16px 18px; margin-bottom: 12px; margin-top: 8px; cursor: pointer; display: flex; align-items: center; justify-content: space-between; }
  .guia-part-header.open { border-radius: 16px 16px 0 0; }
  .guia-part-num { font-size: 0.62rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--green); font-weight: 700; margin-bottom: 4px; }
  .guia-part-title { font-family: 'Syne', sans-serif; font-size: 0.92rem; font-weight: 800; color: #fff; line-height: 1.2; }
  .guia-part-arrow { font-size: 0.9rem; color: var(--green); transition: transform 0.25s; flex-shrink: 0; margin-left: 10px; }
  .guia-part-header.open .guia-part-arrow { transform: rotate(180deg); }
  .guia-part-body { 
    display: none; 
    background: var(--white); 
    border: 1px solid var(--border); 
    border-top: none; 
    border-radius: 0 0 16px 16px; 
    padding: 0 16px 16px; 
    margin-bottom: 12px; 
  }
  .guia-part-body.open { display: block; animation: guiaSlide 0.28s cubic-bezier(0.4,0,0.2,1) both; }
  .guia-section { margin-top: 16px; }
  .guia-section-num { font-size: 0.6rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--green); font-weight: 700; margin-bottom: 3px; }
  .guia-section-title { font-family: 'Syne', sans-serif; font-size: 0.85rem; font-weight: 800; color: var(--text); margin-bottom: 8px; padding-bottom: 6px; border-bottom: 2px solid var(--green-light); }
  .guia-text { font-size: 0.79rem; color: #4a5568; line-height: 1.75; margin-bottom: 10px; }
  .guia-table { width: 100%; border-collapse: collapse; margin: 10px 0; border-radius: 12px; overflow: hidden; }
  .guia-table th { background: var(--navy); color: var(--green); font-family: 'Syne', sans-serif; font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.08em; padding: 9px 12px; text-align: left; }
  .guia-table td { padding: 9px 12px; font-size: 0.77rem; border-bottom: 1px solid var(--bg2); color: var(--text); }
  .guia-table tr:last-child td { border-bottom: none; }
  .guia-table tr:nth-child(even) td { background: var(--bg); }
  .guia-table .td-green { color: var(--green); font-weight: 700; }
  .guia-table .td-amber { color: var(--amber); font-weight: 700; }
  .guia-table .td-red { color: var(--red); font-weight: 700; }
  .guia-highlight { background: rgba(0,200,150,0.06); border-left: 3px solid var(--green); border-radius: 0 10px 10px 0; padding: 10px 14px; margin: 10px 0; font-size: 0.78rem; color: #008c69; line-height: 1.65; }
  .guia-warning { background: rgba(245,158,11,0.07); border-left: 3px solid var(--amber); border-radius: 0 10px 10px 0; padding: 10px 14px; margin: 10px 0; font-size: 0.78rem; color: #92400e; line-height: 1.65; }
  .guia-list { margin: 8px 0; padding-left: 0; list-style: none; }
  .guia-list li { font-size: 0.79rem; color: #4a5568; line-height: 1.7; padding: 4px 0 4px 18px; position: relative; }
  .guia-list li::before { content: '▸'; position: absolute; left: 0; color: var(--green); font-size: 0.7rem; top: 6px; }
  .faq-item { border: 1px solid var(--border); border-radius: 14px; margin-bottom: 8px; overflow: hidden; }
  .faq-q { padding: 13px 16px; cursor: pointer; display: flex; align-items: flex-start; justify-content: space-between; gap: 10px; background: var(--white); }
  .faq-q-text { font-size: 0.8rem; font-weight: 600; color: var(--text); line-height: 1.45; flex: 1; }
  .faq-arrow { font-size: 0.75rem; color: var(--muted); flex-shrink: 0; margin-top: 2px; transition: transform 0.2s; }
  .faq-item.open .faq-arrow { transform: rotate(180deg); }
  .faq-a { display: none; padding: 0 16px 14px; font-size: 0.78rem; color: #4a5568; line-height: 1.7; background: var(--bg); border-top: 1px solid var(--bg2); padding-top: 12px; }
  .faq-item.open .faq-a { display: block; animation: fadeUp 0.15s ease; }
  @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes guiaSlide { from { opacity: 0; transform: translateY(-6px); } to { opacity: 1; transform: translateY(0); } }

  /* ── GUIA SMOOTH ENHANCEMENTS ── */
  .guia-part-header { transition: background 0.2s ease, border-radius 0.2s ease; }
  .guia-part-header:active { opacity: 0.85; }
  .guia-part-arrow { transition: transform 0.28s cubic-bezier(0.4,0,0.2,1); }
  .faq-item { transition: box-shadow 0.2s ease; }
  .faq-item.open { box-shadow: 0 4px 16px rgba(0,0,0,0.08); }
  .faq-arrow { transition: transform 0.25s cubic-bezier(0.4,0,0.2,1); }
  .faq-a { animation: guiaSlide 0.22s cubic-bezier(0.4,0,0.2,1) both; }
  .tab-content.active { animation: fadeUp 0.22s cubic-bezier(0.4,0,0.2,1) both; }
  .scroll-area { scroll-behavior: smooth; }
</style>
</head>
<body>
<div class="phone">

  <!-- ══ AUTH SCREEN ══ -->
  <div class="auth-screen" id="auth-screen">
    <div style="margin-bottom:24px;text-align:center;"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA3NjUgMjAwIj4KPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCwtNjAwKSI+CjxwYXRoIGQ9Ik0gMTE1LjQ2IDcyNi43NSBDMTE0Ljg5LDcyOC41NiA2Ni4xNSw3MjguNTYgNjUuNDYsNzI2Ljc1IEM2NS4xOSw3MjYuMDYgNjUuMDksNzA3LjA1IDY1LjI0LDY4NC41MCBMIDY1LjUwIDY0My41MCBMIDg0LjAwIDY0Mi45MiBMIDg0LjAwIDcxMS4wMCBMIDExNi43MyA3MTEuMDAgTCAxMTYuMjkgNzE4LjI1IEMxMTYuMDUsNzIyLjI0IDExNS42Nyw3MjYuMDYgMTE1LjQ2LDcyNi43NSBaTSAxODQuNjggNzI2Ljc1IEMxODMuOTcsNzI3LjQ2IDE4MC40OSw3MjguMjQgMTc2Ljk0LDcyOC40OCBDMTY2Ljg3LDcyOS4xNyAxNjEuOTAsNzI3LjM1IDE1Ny4yOSw3MjEuMzIgTCAxNTQuNTAgNzE3LjY2IEwgMTU0LjE2IDY5OC44OCBMIDE1My44MSA2ODAuMTEgTCAxNDkuNjYgNjc5LjgwIEwgMTQ1LjUwIDY3OS41MCBMIDE0NS4yMCA2NzIuNzUgQzE0NC45Miw2NjYuMjkgMTQ1LjAxLDY2Ni4wMCAxNDcuMjAsNjY1Ljk5IEMxNTMuNTksNjY1Ljk1IDE1NC4wMCw2NjUuNDAgMTU0LjAwLDY1Ni44OCBMIDE1NC4wMCA2NDkuMDAgTCAxNzEuMDAgNjQ5LjAwIEwgMTcxLjAwIDY2NC45MCBMIDE4My41MCA2NjUuNTAgTCAxODMuODAgNjcyLjI1IEwgMTg0LjA5IDY3OS4wMCBMIDE3MS4wMiA2NzkuMDAgTCAxNzEuMjYgNjk0LjU5IEMxNzEuNDksNzA5Ljc2IDE3MS41Nyw3MTAuMjMgMTczLjkzLDcxMi4xNSBDMTc1Ljc4LDcxMy42NCAxNzcuMjMsNzEzLjk3IDE3OS45OSw3MTMuNTAgTCAxODMuNjMgNzEyLjg5IEwgMTg0LjgwIDcxOS4xOCBDMTg1LjczLDcyNC4yMCAxODUuNzEsNzI1LjcyIDE4NC42OCw3MjYuNzUgWk0gMTQwLjAwIDY2NC45MiBMIDE0MC4wMCA3MjguMDAgTCAxMzEuNDcgNzI4LjAwIEMxMjUuNTMsNzI4LjAwIDEyMi43OSw3MjcuNjIgMTIyLjQ1LDcyNi43NCBDMTIyLjE5LDcyNi4wNSAxMjIuMDksNzExLjk4IDEyMi4yMyw2OTUuNDkgTCAxMjIuNTAgNjY1LjUwIFpNIDE0MC4wMCA2NDMuMDAgTCAxNDAuMDAgNjU4LjAwIEwgMTMxLjY3IDY1OC4wMCBDMTI3LjA4LDY1OC4wMCAxMjMuMDMsNjU3LjcwIDEyMi42Nyw2NTcuMzMgQzEyMi4zMCw2NTYuOTcgMTIyLjAwLDY1My41OSAxMjIuMDAsNjQ5LjgzIEwgMTIyLjAwIDY0My4wMCBaIiBmaWxsPSJyZ2IoMjU1LDI1NSwyNTUpIi8+CjxwYXRoIGQ9Ik0gMjEwLjAwIDcxMS42MiBMIDIxMC4wMCA3MjcuMDAgTCAxOTIuMDAgNzI3LjAwIEwgMTkyLjAwIDY0NC4yNSBMIDE5NS4xMiA2NDMuNjIgQzE5Ni44NCw2NDMuMjggMjQ4LjU4LDY0My4wMCAzMTAuMDksNjQzLjAwIEM0MjEuNDMsNjQzLjAwIDQyMS45NSw2NDIuOTkgNDI3LjcxLDY0MC44OSBDNDMyLjg5LDYzOS4wMCA0MzUuMjcsNjM2Ljk4IDQ1MC4xNSw2MjEuODEgQzQ1OS4zMSw2MTIuNDcgNDY3LjAyLDYwNC4wMiA0NjcuMjksNjAzLjAyIEM0NjcuNjEsNjAxLjc3IDQ2Ni4wNSw1OTkuNTEgNDYyLjM4LDU5NS44OCBDNDU5LjQyLDU5Mi45NiA0NTcuMDAsNTkwLjI1IDQ1Ny4wMCw1ODkuODYgQzQ1Ny4wMCw1ODguNzIgNDkzLjgyLDU3Ny42OSA1MDIuMDEsNTc2LjM4IEM1MDIuNDksNTc2LjMxIDUwMi45Miw1NzYuMjEgNTAzLjMwLDU3Ni4xMyBDNTA0LjE4LDU3NS45NCA1MDQuNzgsNTc1LjgxIDUwNS4xNCw1NzYuMDUgQzUwNS45Niw1NzYuNjAgNTA1LjQ5LDU3OS4wOCA1MDMuOTQsNTg3LjIwIEM1MDMuNjQsNTg4Ljc1IDUwMy4zMSw1OTAuNTEgNTAyLjk0LDU5Mi41MCBDNDk5LjYxLDYxMC4yOCA0OTYuODEsNjIzLjQwIDQ5Ni4wNCw2MjQuODQgQzQ5NS41MSw2MjUuODIgNDkzLjU2LDYyNC42OCA0ODguNzMsNjIwLjU5IEM0ODUuMTEsNjE3LjUxIDQ4MS41NSw2MTUuMDAgNDgwLjgzLDYxNS4wMCBDNDgwLjEwLDYxNS4wMCA0NzEuNDEsNjIzLjI1IDQ2MS41MSw2MzMuMzQgQzQ0NS45OSw2NDkuMTUgNDQyLjU0LDY1Mi4xNSA0MzYuNTUsNjU1LjA5IEwgNDI5LjYxIDY1OC41MCBMIDMyMC44OSA2NTkuMDAgQzI2MS4wOSw2NTkuMjggMjExLjgyLDY1OS44NSAyMTEuMzksNjYwLjI3IEMyMTAuMTcsNjYxLjUwIDIxMC4zNyw2NzUuNzUgMjExLjYzLDY3Ny4wMiBDMjEyLjMwLDY3Ny43MCAyMTguMzIsNjc4LjM5IDIyNi40Miw2NzguNzMgTCAyNDAuMDggNjc5LjMwIEwgMjM5Ljc5IDY4Ni40MCBMIDIzOS41MCA2OTMuNTAgTCAyMjYuMDcgNjkzLjc4IEMyMTguMjUsNjkzLjk0IDIxMi4wOCw2OTQuNTIgMjExLjMyLDY5NS4xNSBDMjEwLjMzLDY5NS45NyAyMTAuMDAsNzAwLjEzIDIxMC4wMCw3MTEuNjIgWk0gNTYyLjYyIDcyNS40MyBDNTU4LjM2LDcyOC4wNyA1NTYuNzIsNzI4LjQ2IDU0OC42NSw3MjguNzcgQzU0MC4yMCw3MjkuMDkgNTM5LjA0LDcyOC44OSA1MzMuNTAsNzI2LjIwIEM1MjYuMzEsNzIyLjcwIDUyNC45Miw3MjEuMjUgNTIxLjM1LDcxMy40NyBDNTE1LjkwLDcwMS42MCA1MTcuNTMsNjgxLjQ2IDUyNC42NCw2NzMuMDIgQzUyOC45NSw2NjcuOTAgNTM2LjM0LDY2NC43NCA1NDUuMjcsNjY0LjIxIEM1NjIuMjUsNjYzLjE5IDU3MS4xMyw2NzEuMDkgNTc0LjA0LDY4OS44MSBDNTc0LjA5LDY5MC4xNCA1NzQuMTQsNjkwLjQ3IDU3NC4xOSw2OTAuNzkgQzU3NC44NCw2OTQuODkgNTc1LjIyLDY5Ny4zNSA1NzQuMTksNjk4LjgyIEM1NzIuNjYsNzAxLjAxIDU2Ny45OSw3MDEuMDEgNTU2LjM0LDcwMS4wMCBDNTU1LjczLDcwMS4wMCA1NTUuMTEsNzAxLjAwIDU1NC40Niw3MDEuMDAgTCA1MzYuMDAgNzAxLjAwIEwgNTM2LjAwIDcwMy41NSBDNTM2LjAwLDcwOS43NSA1NDEuMDksNzE1LjAwIDU0Ny4xMSw3MTUuMDAgQzU1MC4xMSw3MTUuMDAgNTUxLjQyLDcxNC4yOCA1NTQuNDIsNzEwLjk2IEwgNTU4LjA3IDcwNi45MiBMIDU2NS43OCA3MDcuMjEgTCA1NzMuNTAgNzA3LjUwIEwgNTczLjI5IDcxMC40MiBDNTcyLjk1LDcxNS4wOSA1NjcuOTQsNzIyLjE0IDU2Mi42Miw3MjUuNDMgWk0gNjc2LjAwIDcyNy4xNSBDNjc0LjYyLDcyNy43OCA2NzAuODAsNzI4LjQ4IDY2Ny41MCw3MjguNjkgQzY1OC45NCw3MjkuMjYgNjUyLjEzLDcyNS45NiA2NDkuMTQsNzE5LjgwIEM2NDYuNDAsNzE0LjEyIDY0Ni4yNCw3MDQuOTIgNjQ4LjgxLDY5OS45OCBDNjUxLjQ5LDY5NC44MyA2NTkuNjYsNjkxLjA0IDY3MS4zMiw2ODkuNTUgQzY4MS45NCw2ODguMTkgNjgzLjAwLDY4Ny43NCA2ODMuMDAsNjg0LjYyIEM2ODMuMDAsNjgwLjgzIDY3OS4wMyw2NzguMDAgNjczLjcyLDY3OC4wMCBDNjY5LjcwLDY3OC4wMCA2NjguNzUsNjc4LjQxIDY2Ni44NCw2ODEuMDAgQzY2NC44MCw2ODMuNzYgNjY0LjE1LDY4NC4wMCA2NTguNTYsNjgzLjk4IEM2NTAuNjQsNjgzLjk2IDY0OS41NCw2ODMuMjIgNjUwLjMzLDY3OC4zNyBDNjUxLjE4LDY3My4xMCA2NTMuNzUsNjY5Ljk0IDY1OS41Niw2NjcuMDAgQzY2My45MCw2NjQuODEgNjY1Ljc4LDY2NC41MCA2NzUuMDAsNjY0LjUwIEM2ODYuNTgsNjY0LjUwIDY5MC4xNiw2NjUuODMgNjk1LjQzLDY3Mi4xMCBDNjk5LjUwLDY3Ni45MyA3MDAuMDYsNjgxLjIwIDY5OS43Nyw3MDUuMTggTCA2OTkuNTAgNzI3LjUwIEwgNjkyLjU0IDcyNy44MCBDNjg2LjI3LDcyOC4wNyA2ODUuNDEsNzI3Ljg3IDY4My44Myw3MjUuODAgQzY4Mi4zNSw3MjMuODUgNjgxLjgxLDcyMy42OSA2ODAuMjksNzI0Ljc1IEM2NzkuMzEsNzI1LjQ0IDY3Ny4zOCw3MjYuNTIgNjc2LjAwLDcyNy4xNSBaTSAzNjMuMDYgNzI2Ljg5IEMzNTcuMTYsNzI5LjY5IDM1MS41NCw3MjkuNTggMzQ1LjQ1LDcyNi41MiBDMzM4LjE4LDcyMi44NyAzMzYuMDAsNzE5LjA3IDMzNi4wMCw3MTAuMDYgQzMzNi4wMCw3MDEuMjcgMzM4LjA0LDY5Ny4yMiAzNDQuMzQsNjkzLjU1IEMzNDguNDEsNjkxLjE4IDM1Ny4wNCw2ODkuMjcgMzY2LjAwLDY4OC43NiBDMzcwLjQwLDY4OC41MSAzNzAuNTEsNjg4LjQyIDM3MC44MCw2ODQuODYgQzM3MS4wNSw2ODEuOTEgMzcwLjYwLDY4MC44MyAzNjguNDIsNjc5LjExIEMzNjQuNDMsNjc1Ljk4IDM1OS41Miw2NzYuMzMgMzU1Ljg1LDY4MC4wMCBDMzUzLjEwLDY4Mi43NSAzNTIuMjgsNjgzLjAwIDM0NS45OCw2ODMuMDAgQzM0Mi4yMSw2ODMuMDAgMzM4Ljg5LDY4Mi42MiAzMzguNjAsNjgyLjE2IEMzMzcuNTcsNjgwLjUwIDM0MC41Myw2NzMuNTQgMzQzLjU1LDY3MC41MSBDMzUxLjY1LDY2Mi40MiAzNzEuMzksNjYxLjc1IDM4MC41MSw2NjkuMjcgQzM4Ny40Miw2NzQuOTYgMzg3Ljk1LDY3Ny40NCAzODcuOTgsNzAzLjc1IEwgMzg4LjAwIDcyNy4wMCBMIDM3My4yNSA3MjcuMDAgTCAzNzEuOTggNzIwLjY3IEwgMzY5Ljc0IDcyMi43MiBDMzY4LjUxLDcyMy44NSAzNjUuNTAsNzI1LjczIDM2My4wNiw3MjYuODkgWk0gMjk0LjAwIDcwNi4zMyBMIDI5My41MCA3MjcuNTAgTCAyODUuNDUgNzI3Ljc5IEMyODEuMDMsNzI3Ljk1IDI3Ny4wOSw3MjcuNzYgMjc2LjcwLDcyNy4zNyBDMjc2LjMyLDcyNi45OCAyNzYuMDAsNzEzLjA2IDI3Ni4wMCw2OTYuNDQgQzI3Ni4wMCw2OTQuMDcgMjc2LjAwLDY5MS44OCAyNzUuOTksNjg5Ljg2IEMyNzUuOTcsNjcyLjA0IDI3NS45Niw2NjYuOTEgMjc4LjI2LDY2NS40OCBDMjc5LjE5LDY2NC45MSAyODAuNDksNjY0Ljk0IDI4Mi4zMiw2NjQuOTggQzI4Mi44NCw2NjQuOTkgMjgzLjQwLDY2NS4wMCAyODQuMDAsNjY1LjAwIEMyOTAuMzgsNjY1LjAwIDI5Mi4wMCw2NjUuNzMgMjkyLjAwLDY2OC42MSBDMjkyLjAwLDY3MS42MiAyOTIuOTcsNjcxLjYyIDI5Ni41MCw2NjguNTkgQzMwMS45Nyw2NjMuODkgMzEyLjU0LDY2Mi43NSAzMTkuNTMsNjY2LjExIEMzMjIuNzcsNjY3LjY3IDMyNi43OCw2NzMuMDUgMzI3LjU5LDY3Ni45NCBDMzI3Ljg4LDY3OC4zNSAzMjguNTQsNjgwLjI4IDMyOS4wNiw2ODEuMjQgQzMyOS41OCw2ODIuMTkgMzMwLjAwLDY5Mi42MCAzMzAuMDAsNzA0LjM2IEMzMzAuMDAsNzIxLjUzIDMyOS43Miw3MjUuOTkgMzI4LjU5LDcyNi45MiBDMzI3LjcyLDcyNy42NSAzMjQuMzksNzI3Ljk4IDMxOS44NCw3MjcuODAgTCAzMTIuNTAgNzI3LjUwIEwgMzEyLjAwIDcwNS44NSBDMzExLjU1LDY4Ni4zOCAzMTEuMzEsNjgzLjk5IDMwOS42MCw2ODIuMTAgQzMwNi43NCw2NzguOTUgMzAwLjEwLDY3OS4yMCAyOTYuOTIsNjgyLjU4IEMyOTQuNTUsNjg1LjEwIDI5NC40OSw2ODUuNjIgMjk0LjAwLDcwNi4zMyBaTSA0MTUuMDAgNzA2LjcyIEwgNDE1LjAwIDcyNy4wMCBMIDM5OC4wMCA3MjcuMDAgTCAzOTguMDAgNjY2LjI3IEwgNDA0Ljc1IDY2NS43MyBDNDEyLjIwLDY2NS4xMyA0MTQuMDAsNjY1LjkwIDQxNC4wMCw2NjkuNzMgTCA0MTQuMDAgNjcyLjIxIEwgNDE3LjQ3IDY2OS4xNiBDNDI1LjM4LDY2Mi4yMSA0MzguODcsNjYyLjQwIDQ0NS42MCw2NjkuNTQgQzQ1MC4yNyw2NzQuNDkgNDUxLjAwLDY3OS4yMiA0NTEuMDAsNzA0LjQ0IEwgNDUxLjAwIDcyNy4wMCBMIDQzNC4wMCA3MjcuMDAgTCA0MzQuMDAgNzA1LjYzIEM0MzQuMDAsNjg1LjUzIDQzMy44OCw2ODQuMTEgNDMxLjkzLDY4MS42MyBDNDMwLjI3LDY3OS41MyA0MjkuMDAsNjc5LjAwIDQyNS42Miw2NzkuMDAgQzQyMS4xMSw2NzkuMDAgNDE5LjI4LDY4MC4wMSA0MTYuNjUsNjgzLjk3IEM0MTUuMjUsNjg2LjA2IDQxNS4wMCw2ODkuNTcgNDE1LjAwLDcwNi43MiBaTSA1MDAuNTAgNzI2LjI2IEM0OTUuMzcsNzI4LjkzIDQ4Mi4yNiw3MjkuNjggNDc2LjcyLDcyNy42MiBDNDcwLjIxLDcyNS4yMCA0NjYuMTQsNzIxLjcyIDQ2My4xNCw3MTYuMDAgQzQ1OS40Miw3MDguOTEgNDU4Ljk0LDcwNi42NyA0NTguOTAsNjk2LjI5IEM0NTguODIsNjc0LjgxIDQ2OS43Nyw2NjMuMzQgNDg5LjU4LDY2NC4xNiBDNTAwLjM0LDY2NC42MSA1MDYuMjAsNjY3Ljk1IDUxMC4yNSw2NzUuOTMgQzUxNS4xNyw2ODUuNjUgNTEzLjU3LDY4OC4wMCA1MDIuMDEsNjg4LjAwIEM0OTYuMjAsNjg4LjAwIDQ5Ni4xNSw2ODcuOTcgNDk1LjAwLDY4NC40OSBDNDkzLjY1LDY4MC40MCA0OTEuNTAsNjc5LjAwIDQ4Ni41Nyw2NzkuMDAgQzQ4Mi4yMyw2NzkuMDAgNDc5LjUzLDY4MS40NSA0NzguMDcsNjg2LjY5IEM0NzYuNzQsNjkxLjQ3IDQ3Ni42OSw3MDEuNDQgNDc3Ljk4LDcwNS45MiBDNDgwLjk5LDcxNi40MiA0OTIuMDUsNzE2Ljk0IDQ5NS45MSw3MDYuNzUgQzQ5Ni45Myw3MDQuMDUgNDk3LjA5LDcwNC4wMCA1MDUuNDgsNzA0LjAwIEM1MTMuNzgsNzA0LjAwIDUxNC4wMCw3MDQuMDYgNTE0LjAwLDcwNi4zNyBDNTE0LjAwLDcxMy42NSA1MDguMTQsNzIyLjI4IDUwMC41MCw3MjYuMjYgWk0gNjI2LjAwIDcwNy44MiBMIDYyNS41MCA3MjcuNTAgTCA2MTcuMzcgNzI3Ljc5IEM2MTAuNjMsNzI4LjAzIDYwOS4xNCw3MjcuODAgNjA4LjYyLDcyNi40NiBDNjA4LjI4LDcyNS41NyA2MDguMDAsNzExLjYwIDYwOC4wMCw2OTUuNDIgTCA2MDguMDAgNjY2LjAwIEwgNjE2LjUwIDY2Ni4wMCBDNjIzLjM5LDY2Ni4wMCA2MjUuMDAsNjY2LjI4IDYyNS4wMCw2NjcuNTAgQzYyNS4wMCw2NjkuNTAgNjI2LjI4LDY2OS4zOSA2MzAuNzQsNjY3LjAwIEM2MzMuMjMsNjY1LjY2IDYzNi4zOCw2NjUuMDAgNjQwLjI0LDY2NS4wMCBMIDY0Ni4wMCA2NjUuMDAgTCA2NDYuMDAgNjcxLjU3IEM2NDYuMDAsNjgwLjE3IDY0NC44NCw2ODIuMzcgNjQwLjY2LDY4MS42MyBDNjM1LjcyLDY4MC43NiA2MzAuOTEsNjgyLjI0IDYyOC41OSw2ODUuMzQgQzYyNi42OCw2ODcuOTAgNjI2LjQ2LDY4OS44NSA2MjYuMDAsNzA3LjgyIFpNIDU5OC41MCA2NjUuNTAgTCA1OTguNTAgNzI3LjUwIEwgNTkwLjQ1IDcyNy43OSBDNTg2LjAzLDcyNy45NSA1ODIuMDksNzI3Ljc2IDU4MS43MCw3MjcuMzcgQzU4MS4zMiw3MjYuOTggNTgxLjAwLDcxMy4wMyA1ODEuMDAsNjk2LjM1IEwgNTgxLjAwIDY2Ni4wNCBMIDU4My4yOCA2NjUuNDcgQzU4NC41NCw2NjUuMTUgNTg4LjQ3LDY2NS4wMyA1OTIuMDMsNjY1LjIwIFpNIDI2NS43NiA2OTYuMjUgTCAyNjYuMDMgNzI3LjAwIEwgMjQ4Ljk3IDcyNy4wMCBMIDI0OS41MCA2NjUuNTAgTCAyNjUuNTAgNjY1LjUwIFpNIDU5Ny4wNyA2NTcuOTYgQzU5NC43Myw2NTkuMjIgNTg2LjM2LDY1OS4yMiA1ODMuMjUsNjU3Ljk3IEM1ODEuMjIsNjU3LjE1IDU4MS4wMCw2NTYuMzkgNTgxLjAwLDY1MC4xNSBDNTgxLjAwLDY0My44MiA1ODEuMTksNjQzLjE4IDU4My4yNSw2NDIuNjMgQzU4Ni4xOSw2NDEuODQgNTkxLjk1LDY0MS44NCA1OTUuODgsNjQyLjYyIEwgNTk5LjAwIDY0My4yNSBMIDU5OS4wMCA2NTAuMDkgQzU5OS4wMCw2NTUuODMgNTk4LjY5LDY1Ny4xMCA1OTcuMDcsNjU3Ljk2IFpNIDM1NS40NSA3MTMuNTUgQzM1OC44OSw3MTYuOTkgMzYzLjA2LDcxNi43NiAzNjcuNDcsNzEyLjkwIEMzNzAuNDksNzEwLjI0IDM3MS4wMCw3MDkuMTcgMzcxLjAwLDcwNS40NiBDMzcxLjAwLDcwMy4wNyAzNzAuNTQsNzAwLjg0IDM2OS45OCw3MDAuNDkgQzM2OS40Miw3MDAuMTQgMzY2LjUxLDcwMC4xNyAzNjMuNTEsNzAwLjU0IEMzNTQuMDMsNzAxLjczIDM1MC4wNSw3MDguMTQgMzU1LjQ1LDcxMy41NSBaTSA2NjYuOTQgNzE0LjE2IEM2NjkuOTgsNzE2LjYxIDY3Mi45OSw3MTYuNDggNjc3LjA5LDcxMy43MiBDNjgyLjgyLDcwOS44NiA2ODUuMjAsNzAxLjgzIDY4MS4wMSw3MDAuNTAgQzY3Ny43MCw2OTkuNDUgNjY5Ljk4LDcwMS4xMiA2NjcuMjQsNzAzLjQ3IEM2NjMuODYsNzA2LjM4IDY2My43MSw3MTEuNTQgNjY2Ljk0LDcxNC4xNiBaTSA1MzcuNjIgNjg4LjcxIEM1NDAuMzcsNjkwLjcyIDU1Mi4yOSw2OTAuMzkgNTU0Ljk1LDY4OC4yNCBDNTU2Ljc4LDY4Ni43NiA1NTYuOTcsNjg2LjA1IDU1Ni4xMyw2ODMuODQgQzU1NC43MSw2ODAuMTAgNTUxLjIyLDY3OC4wMCA1NDYuNDEsNjc4LjAwIEM1NDEuNTIsNjc4LjAwIDUzNy41NCw2ODAuNzAgNTM2LjU0LDY4NC43MCBDNTM2LjA0LDY4Ni43MCA1MzYuMzIsNjg3Ljc2IDUzNy42Miw2ODguNzEgWiIgZmlsbD0icmdiKDM3LDI0NCwxNzApIi8+CjwvZz4KPC9zdmc+Cg==" style="height:52px;object-fit:contain;margin-bottom:0;" alt="LitFinanceira"></div>
    <div class="auth-sub">Gere as tuas finanças pessoais,<br>simula créditos e acompanha taxas.</div>
    <div class="auth-card">
      <div class="auth-tabs">
        <button class="auth-tab active" onclick="switchAuthTab('login',this)">Entrar</button>
        <button class="auth-tab" onclick="switchAuthTab('register',this)">Registar</button>
      </div>
      <div id="auth-form-login">
        <input class="auth-input" type="email" id="auth-email-login" placeholder="email@exemplo.com">
        <input class="auth-input" type="password" id="auth-pass-login" placeholder="Palavra-passe">
        <button class="auth-btn" onclick="doLogin()">Entrar</button>
        <div style="text-align:center;margin-top:14px;">
          <span style="font-size:0.75rem;color:rgba(255,255,255,0.35)">ou</span>
        </div>
        <button class="auth-btn" style="background:rgba(0,200,150,0.15);color:var(--green);margin-top:8px;" onclick="doMagicLink()">✉️ Entrar com Magic Link</button>
      </div>
      <div id="auth-form-register" style="display:none">
        <input class="auth-input" type="text" id="auth-name" placeholder="Nome completo">
        <input class="auth-input" type="email" id="auth-email-reg" placeholder="email@exemplo.com">
        <input class="auth-input" type="password" id="auth-pass-reg" placeholder="Palavra-passe (mín. 6 caracteres)">
        <button class="auth-btn" onclick="doRegister()">Criar conta</button>
      </div>
      <div class="auth-magic-sent" id="magic-sent">
        <div class="magic-icon">📬</div>
        <p>Email enviado para<br><strong id="magic-email-display"></strong><br><br>Clica no link para entrar.</p>
      </div>
      <div class="auth-error" id="auth-error"></div>
      <button onclick="continuarSemRegisto()" style="width:100%;margin-top:16px;background:transparent;border:none;color:rgba(255,255,255,0.3);font-family:'Outfit',sans-serif;font-size:0.8rem;cursor:pointer;padding:8px;text-decoration:underline;text-underline-offset:3px;">
        Continuar sem conta →
      </button>
    </div>
  </div>

  <!-- ══ APP ══ -->
  <div class="header">
    <div class="logo-mark">
      <div style="display:flex;align-items:center;"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA3NjUgMjAwIj4KPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCwtNjAwKSI+CjxwYXRoIGQ9Ik0gMTE1LjQ2IDcyNi43NSBDMTE0Ljg5LDcyOC41NiA2Ni4xNSw3MjguNTYgNjUuNDYsNzI2Ljc1IEM2NS4xOSw3MjYuMDYgNjUuMDksNzA3LjA1IDY1LjI0LDY4NC41MCBMIDY1LjUwIDY0My41MCBMIDg0LjAwIDY0Mi45MiBMIDg0LjAwIDcxMS4wMCBMIDExNi43MyA3MTEuMDAgTCAxMTYuMjkgNzE4LjI1IEMxMTYuMDUsNzIyLjI0IDExNS42Nyw3MjYuMDYgMTE1LjQ2LDcyNi43NSBaTSAxODQuNjggNzI2Ljc1IEMxODMuOTcsNzI3LjQ2IDE4MC40OSw3MjguMjQgMTc2Ljk0LDcyOC40OCBDMTY2Ljg3LDcyOS4xNyAxNjEuOTAsNzI3LjM1IDE1Ny4yOSw3MjEuMzIgTCAxNTQuNTAgNzE3LjY2IEwgMTU0LjE2IDY5OC44OCBMIDE1My44MSA2ODAuMTEgTCAxNDkuNjYgNjc5LjgwIEwgMTQ1LjUwIDY3OS41MCBMIDE0NS4yMCA2NzIuNzUgQzE0NC45Miw2NjYuMjkgMTQ1LjAxLDY2Ni4wMCAxNDcuMjAsNjY1Ljk5IEMxNTMuNTksNjY1Ljk1IDE1NC4wMCw2NjUuNDAgMTU0LjAwLDY1Ni44OCBMIDE1NC4wMCA2NDkuMDAgTCAxNzEuMDAgNjQ5LjAwIEwgMTcxLjAwIDY2NC45MCBMIDE4My41MCA2NjUuNTAgTCAxODMuODAgNjcyLjI1IEwgMTg0LjA5IDY3OS4wMCBMIDE3MS4wMiA2NzkuMDAgTCAxNzEuMjYgNjk0LjU5IEMxNzEuNDksNzA5Ljc2IDE3MS41Nyw3MTAuMjMgMTczLjkzLDcxMi4xNSBDMTc1Ljc4LDcxMy42NCAxNzcuMjMsNzEzLjk3IDE3OS45OSw3MTMuNTAgTCAxODMuNjMgNzEyLjg5IEwgMTg0LjgwIDcxOS4xOCBDMTg1LjczLDcyNC4yMCAxODUuNzEsNzI1LjcyIDE4NC42OCw3MjYuNzUgWk0gMTQwLjAwIDY2NC45MiBMIDE0MC4wMCA3MjguMDAgTCAxMzEuNDcgNzI4LjAwIEMxMjUuNTMsNzI4LjAwIDEyMi43OSw3MjcuNjIgMTIyLjQ1LDcyNi43NCBDMTIyLjE5LDcyNi4wNSAxMjIuMDksNzExLjk4IDEyMi4yMyw2OTUuNDkgTCAxMjIuNTAgNjY1LjUwIFpNIDE0MC4wMCA2NDMuMDAgTCAxNDAuMDAgNjU4LjAwIEwgMTMxLjY3IDY1OC4wMCBDMTI3LjA4LDY1OC4wMCAxMjMuMDMsNjU3LjcwIDEyMi42Nyw2NTcuMzMgQzEyMi4zMCw2NTYuOTcgMTIyLjAwLDY1My41OSAxMjIuMDAsNjQ5LjgzIEwgMTIyLjAwIDY0My4wMCBaIiBmaWxsPSJyZ2IoMjU1LDI1NSwyNTUpIi8+CjxwYXRoIGQ9Ik0gMjEwLjAwIDcxMS42MiBMIDIxMC4wMCA3MjcuMDAgTCAxOTIuMDAgNzI3LjAwIEwgMTkyLjAwIDY0NC4yNSBMIDE5NS4xMiA2NDMuNjIgQzE5Ni44NCw2NDMuMjggMjQ4LjU4LDY0My4wMCAzMTAuMDksNjQzLjAwIEM0MjEuNDMsNjQzLjAwIDQyMS45NSw2NDIuOTkgNDI3LjcxLDY0MC44OSBDNDMyLjg5LDYzOS4wMCA0MzUuMjcsNjM2Ljk4IDQ1MC4xNSw2MjEuODEgQzQ1OS4zMSw2MTIuNDcgNDY3LjAyLDYwNC4wMiA0NjcuMjksNjAzLjAyIEM0NjcuNjEsNjAxLjc3IDQ2Ni4wNSw1OTkuNTEgNDYyLjM4LDU5NS44OCBDNDU5LjQyLDU5Mi45NiA0NTcuMDAsNTkwLjI1IDQ1Ny4wMCw1ODkuODYgQzQ1Ny4wMCw1ODguNzIgNDkzLjgyLDU3Ny42OSA1MDIuMDEsNTc2LjM4IEM1MDIuNDksNTc2LjMxIDUwMi45Miw1NzYuMjEgNTAzLjMwLDU3Ni4xMyBDNTA0LjE4LDU3NS45NCA1MDQuNzgsNTc1LjgxIDUwNS4xNCw1NzYuMDUgQzUwNS45Niw1NzYuNjAgNTA1LjQ5LDU3OS4wOCA1MDMuOTQsNTg3LjIwIEM1MDMuNjQsNTg4Ljc1IDUwMy4zMSw1OTAuNTEgNTAyLjk0LDU5Mi41MCBDNDk5LjYxLDYxMC4yOCA0OTYuODEsNjIzLjQwIDQ5Ni4wNCw2MjQuODQgQzQ5NS41MSw2MjUuODIgNDkzLjU2LDYyNC42OCA0ODguNzMsNjIwLjU5IEM0ODUuMTEsNjE3LjUxIDQ4MS41NSw2MTUuMDAgNDgwLjgzLDYxNS4wMCBDNDgwLjEwLDYxNS4wMCA0NzEuNDEsNjIzLjI1IDQ2MS41MSw2MzMuMzQgQzQ0NS45OSw2NDkuMTUgNDQyLjU0LDY1Mi4xNSA0MzYuNTUsNjU1LjA5IEwgNDI5LjYxIDY1OC41MCBMIDMyMC44OSA2NTkuMDAgQzI2MS4wOSw2NTkuMjggMjExLjgyLDY1OS44NSAyMTEuMzksNjYwLjI3IEMyMTAuMTcsNjYxLjUwIDIxMC4zNyw2NzUuNzUgMjExLjYzLDY3Ny4wMiBDMjEyLjMwLDY3Ny43MCAyMTguMzIsNjc4LjM5IDIyNi40Miw2NzguNzMgTCAyNDAuMDggNjc5LjMwIEwgMjM5Ljc5IDY4Ni40MCBMIDIzOS41MCA2OTMuNTAgTCAyMjYuMDcgNjkzLjc4IEMyMTguMjUsNjkzLjk0IDIxMi4wOCw2OTQuNTIgMjExLjMyLDY5NS4xNSBDMjEwLjMzLDY5NS45NyAyMTAuMDAsNzAwLjEzIDIxMC4wMCw3MTEuNjIgWk0gNTYyLjYyIDcyNS40MyBDNTU4LjM2LDcyOC4wNyA1NTYuNzIsNzI4LjQ2IDU0OC42NSw3MjguNzcgQzU0MC4yMCw3MjkuMDkgNTM5LjA0LDcyOC44OSA1MzMuNTAsNzI2LjIwIEM1MjYuMzEsNzIyLjcwIDUyNC45Miw3MjEuMjUgNTIxLjM1LDcxMy40NyBDNTE1LjkwLDcwMS42MCA1MTcuNTMsNjgxLjQ2IDUyNC42NCw2NzMuMDIgQzUyOC45NSw2NjcuOTAgNTM2LjM0LDY2NC43NCA1NDUuMjcsNjY0LjIxIEM1NjIuMjUsNjYzLjE5IDU3MS4xMyw2NzEuMDkgNTc0LjA0LDY4OS44MSBDNTc0LjA5LDY5MC4xNCA1NzQuMTQsNjkwLjQ3IDU3NC4xOSw2OTAuNzkgQzU3NC44NCw2OTQuODkgNTc1LjIyLDY5Ny4zNSA1NzQuMTksNjk4LjgyIEM1NzIuNjYsNzAxLjAxIDU2Ny45OSw3MDEuMDEgNTU2LjM0LDcwMS4wMCBDNTU1LjczLDcwMS4wMCA1NTUuMTEsNzAxLjAwIDU1NC40Niw3MDEuMDAgTCA1MzYuMDAgNzAxLjAwIEwgNTM2LjAwIDcwMy41NSBDNTM2LjAwLDcwOS43NSA1NDEuMDksNzE1LjAwIDU0Ny4xMSw3MTUuMDAgQzU1MC4xMSw3MTUuMDAgNTUxLjQyLDcxNC4yOCA1NTQuNDIsNzEwLjk2IEwgNTU4LjA3IDcwNi45MiBMIDU2NS43OCA3MDcuMjEgTCA1NzMuNTAgNzA3LjUwIEwgNTczLjI5IDcxMC40MiBDNTcyLjk1LDcxNS4wOSA1NjcuOTQsNzIyLjE0IDU2Mi42Miw3MjUuNDMgWk0gNjc2LjAwIDcyNy4xNSBDNjc0LjYyLDcyNy43OCA2NzAuODAsNzI4LjQ4IDY2Ny41MCw3MjguNjkgQzY1OC45NCw3MjkuMjYgNjUyLjEzLDcyNS45NiA2NDkuMTQsNzE5LjgwIEM2NDYuNDAsNzE0LjEyIDY0Ni4yNCw3MDQuOTIgNjQ4LjgxLDY5OS45OCBDNjUxLjQ5LDY5NC44MyA2NTkuNjYsNjkxLjA0IDY3MS4zMiw2ODkuNTUgQzY4MS45NCw2ODguMTkgNjgzLjAwLDY4Ny43NCA2ODMuMDAsNjg0LjYyIEM2ODMuMDAsNjgwLjgzIDY3OS4wMyw2NzguMDAgNjczLjcyLDY3OC4wMCBDNjY5LjcwLDY3OC4wMCA2NjguNzUsNjc4LjQxIDY2Ni44NCw2ODEuMDAgQzY2NC44MCw2ODMuNzYgNjY0LjE1LDY4NC4wMCA2NTguNTYsNjgzLjk4IEM2NTAuNjQsNjgzLjk2IDY0OS41NCw2ODMuMjIgNjUwLjMzLDY3OC4zNyBDNjUxLjE4LDY3My4xMCA2NTMuNzUsNjY5Ljk0IDY1OS41Niw2NjcuMDAgQzY2My45MCw2NjQuODEgNjY1Ljc4LDY2NC41MCA2NzUuMDAsNjY0LjUwIEM2ODYuNTgsNjY0LjUwIDY5MC4xNiw2NjUuODMgNjk1LjQzLDY3Mi4xMCBDNjk5LjUwLDY3Ni45MyA3MDAuMDYsNjgxLjIwIDY5OS43Nyw3MDUuMTggTCA2OTkuNTAgNzI3LjUwIEwgNjkyLjU0IDcyNy44MCBDNjg2LjI3LDcyOC4wNyA2ODUuNDEsNzI3Ljg3IDY4My44Myw3MjUuODAgQzY4Mi4zNSw3MjMuODUgNjgxLjgxLDcyMy42OSA2ODAuMjksNzI0Ljc1IEM2NzkuMzEsNzI1LjQ0IDY3Ny4zOCw3MjYuNTIgNjc2LjAwLDcyNy4xNSBaTSAzNjMuMDYgNzI2Ljg5IEMzNTcuMTYsNzI5LjY5IDM1MS41NCw3MjkuNTggMzQ1LjQ1LDcyNi41MiBDMzM4LjE4LDcyMi44NyAzMzYuMDAsNzE5LjA3IDMzNi4wMCw3MTAuMDYgQzMzNi4wMCw3MDEuMjcgMzM4LjA0LDY5Ny4yMiAzNDQuMzQsNjkzLjU1IEMzNDguNDEsNjkxLjE4IDM1Ny4wNCw2ODkuMjcgMzY2LjAwLDY4OC43NiBDMzcwLjQwLDY4OC41MSAzNzAuNTEsNjg4LjQyIDM3MC44MCw2ODQuODYgQzM3MS4wNSw2ODEuOTEgMzcwLjYwLDY4MC44MyAzNjguNDIsNjc5LjExIEMzNjQuNDMsNjc1Ljk4IDM1OS41Miw2NzYuMzMgMzU1Ljg1LDY4MC4wMCBDMzUzLjEwLDY4Mi43NSAzNTIuMjgsNjgzLjAwIDM0NS45OCw2ODMuMDAgQzM0Mi4yMSw2ODMuMDAgMzM4Ljg5LDY4Mi42MiAzMzguNjAsNjgyLjE2IEMzMzcuNTcsNjgwLjUwIDM0MC41Myw2NzMuNTQgMzQzLjU1LDY3MC41MSBDMzUxLjY1LDY2Mi40MiAzNzEuMzksNjYxLjc1IDM4MC41MSw2NjkuMjcgQzM4Ny40Miw2NzQuOTYgMzg3Ljk1LDY3Ny40NCAzODcuOTgsNzAzLjc1IEwgMzg4LjAwIDcyNy4wMCBMIDM3My4yNSA3MjcuMDAgTCAzNzEuOTggNzIwLjY3IEwgMzY5Ljc0IDcyMi43MiBDMzY4LjUxLDcyMy44NSAzNjUuNTAsNzI1LjczIDM2My4wNiw3MjYuODkgWk0gMjk0LjAwIDcwNi4zMyBMIDI5My41MCA3MjcuNTAgTCAyODUuNDUgNzI3Ljc5IEMyODEuMDMsNzI3Ljk1IDI3Ny4wOSw3MjcuNzYgMjc2LjcwLDcyNy4zNyBDMjc2LjMyLDcyNi45OCAyNzYuMDAsNzEzLjA2IDI3Ni4wMCw2OTYuNDQgQzI3Ni4wMCw2OTQuMDcgMjc2LjAwLDY5MS44OCAyNzUuOTksNjg5Ljg2IEMyNzUuOTcsNjcyLjA0IDI3NS45Niw2NjYuOTEgMjc4LjI2LDY2NS40OCBDMjc5LjE5LDY2NC45MSAyODAuNDksNjY0Ljk0IDI4Mi4zMiw2NjQuOTggQzI4Mi44NCw2NjQuOTkgMjgzLjQwLDY2NS4wMCAyODQuMDAsNjY1LjAwIEMyOTAuMzgsNjY1LjAwIDI5Mi4wMCw2NjUuNzMgMjkyLjAwLDY2OC42MSBDMjkyLjAwLDY3MS42MiAyOTIuOTcsNjcxLjYyIDI5Ni41MCw2NjguNTkgQzMwMS45Nyw2NjMuODkgMzEyLjU0LDY2Mi43NSAzMTkuNTMsNjY2LjExIEMzMjIuNzcsNjY3LjY3IDMyNi43OCw2NzMuMDUgMzI3LjU5LDY3Ni45NCBDMzI3Ljg4LDY3OC4zNSAzMjguNTQsNjgwLjI4IDMyOS4wNiw2ODEuMjQgQzMyOS41OCw2ODIuMTkgMzMwLjAwLDY5Mi42MCAzMzAuMDAsNzA0LjM2IEMzMzAuMDAsNzIxLjUzIDMyOS43Miw3MjUuOTkgMzI4LjU5LDcyNi45MiBDMzI3LjcyLDcyNy42NSAzMjQuMzksNzI3Ljk4IDMxOS44NCw3MjcuODAgTCAzMTIuNTAgNzI3LjUwIEwgMzEyLjAwIDcwNS44NSBDMzExLjU1LDY4Ni4zOCAzMTEuMzEsNjgzLjk5IDMwOS42MCw2ODIuMTAgQzMwNi43NCw2NzguOTUgMzAwLjEwLDY3OS4yMCAyOTYuOTIsNjgyLjU4IEMyOTQuNTUsNjg1LjEwIDI5NC40OSw2ODUuNjIgMjk0LjAwLDcwNi4zMyBaTSA0MTUuMDAgNzA2LjcyIEwgNDE1LjAwIDcyNy4wMCBMIDM5OC4wMCA3MjcuMDAgTCAzOTguMDAgNjY2LjI3IEwgNDA0Ljc1IDY2NS43MyBDNDEyLjIwLDY2NS4xMyA0MTQuMDAsNjY1LjkwIDQxNC4wMCw2NjkuNzMgTCA0MTQuMDAgNjcyLjIxIEwgNDE3LjQ3IDY2OS4xNiBDNDI1LjM4LDY2Mi4yMSA0MzguODcsNjYyLjQwIDQ0NS42MCw2NjkuNTQgQzQ1MC4yNyw2NzQuNDkgNDUxLjAwLDY3OS4yMiA0NTEuMDAsNzA0LjQ0IEwgNDUxLjAwIDcyNy4wMCBMIDQzNC4wMCA3MjcuMDAgTCA0MzQuMDAgNzA1LjYzIEM0MzQuMDAsNjg1LjUzIDQzMy44OCw2ODQuMTEgNDMxLjkzLDY4MS42MyBDNDMwLjI3LDY3OS41MyA0MjkuMDAsNjc5LjAwIDQyNS42Miw2NzkuMDAgQzQyMS4xMSw2NzkuMDAgNDE5LjI4LDY4MC4wMSA0MTYuNjUsNjgzLjk3IEM0MTUuMjUsNjg2LjA2IDQxNS4wMCw2ODkuNTcgNDE1LjAwLDcwNi43MiBaTSA1MDAuNTAgNzI2LjI2IEM0OTUuMzcsNzI4LjkzIDQ4Mi4yNiw3MjkuNjggNDc2LjcyLDcyNy42MiBDNDcwLjIxLDcyNS4yMCA0NjYuMTQsNzIxLjcyIDQ2My4xNCw3MTYuMDAgQzQ1OS40Miw3MDguOTEgNDU4Ljk0LDcwNi42NyA0NTguOTAsNjk2LjI5IEM0NTguODIsNjc0LjgxIDQ2OS43Nyw2NjMuMzQgNDg5LjU4LDY2NC4xNiBDNTAwLjM0LDY2NC42MSA1MDYuMjAsNjY3Ljk1IDUxMC4yNSw2NzUuOTMgQzUxNS4xNyw2ODUuNjUgNTEzLjU3LDY4OC4wMCA1MDIuMDEsNjg4LjAwIEM0OTYuMjAsNjg4LjAwIDQ5Ni4xNSw2ODcuOTcgNDk1LjAwLDY4NC40OSBDNDkzLjY1LDY4MC40MCA0OTEuNTAsNjc5LjAwIDQ4Ni41Nyw2NzkuMDAgQzQ4Mi4yMyw2NzkuMDAgNDc5LjUzLDY4MS40NSA0NzguMDcsNjg2LjY5IEM0NzYuNzQsNjkxLjQ3IDQ3Ni42OSw3MDEuNDQgNDc3Ljk4LDcwNS45MiBDNDgwLjk5LDcxNi40MiA0OTIuMDUsNzE2Ljk0IDQ5NS45MSw3MDYuNzUgQzQ5Ni45Myw3MDQuMDUgNDk3LjA5LDcwNC4wMCA1MDUuNDgsNzA0LjAwIEM1MTMuNzgsNzA0LjAwIDUxNC4wMCw3MDQuMDYgNTE0LjAwLDcwNi4zNyBDNTE0LjAwLDcxMy42NSA1MDguMTQsNzIyLjI4IDUwMC41MCw3MjYuMjYgWk0gNjI2LjAwIDcwNy44MiBMIDYyNS41MCA3MjcuNTAgTCA2MTcuMzcgNzI3Ljc5IEM2MTAuNjMsNzI4LjAzIDYwOS4xNCw3MjcuODAgNjA4LjYyLDcyNi40NiBDNjA4LjI4LDcyNS41NyA2MDguMDAsNzExLjYwIDYwOC4wMCw2OTUuNDIgTCA2MDguMDAgNjY2LjAwIEwgNjE2LjUwIDY2Ni4wMCBDNjIzLjM5LDY2Ni4wMCA2MjUuMDAsNjY2LjI4IDYyNS4wMCw2NjcuNTAgQzYyNS4wMCw2NjkuNTAgNjI2LjI4LDY2OS4zOSA2MzAuNzQsNjY3LjAwIEM2MzMuMjMsNjY1LjY2IDYzNi4zOCw2NjUuMDAgNjQwLjI0LDY2NS4wMCBMIDY0Ni4wMCA2NjUuMDAgTCA2NDYuMDAgNjcxLjU3IEM2NDYuMDAsNjgwLjE3IDY0NC44NCw2ODIuMzcgNjQwLjY2LDY4MS42MyBDNjM1LjcyLDY4MC43NiA2MzAuOTEsNjgyLjI0IDYyOC41OSw2ODUuMzQgQzYyNi42OCw2ODcuOTAgNjI2LjQ2LDY4OS44NSA2MjYuMDAsNzA3LjgyIFpNIDU5OC41MCA2NjUuNTAgTCA1OTguNTAgNzI3LjUwIEwgNTkwLjQ1IDcyNy43OSBDNTg2LjAzLDcyNy45NSA1ODIuMDksNzI3Ljc2IDU4MS43MCw3MjcuMzcgQzU4MS4zMiw3MjYuOTggNTgxLjAwLDcxMy4wMyA1ODEuMDAsNjk2LjM1IEwgNTgxLjAwIDY2Ni4wNCBMIDU4My4yOCA2NjUuNDcgQzU4NC41NCw2NjUuMTUgNTg4LjQ3LDY2NS4wMyA1OTIuMDMsNjY1LjIwIFpNIDI2NS43NiA2OTYuMjUgTCAyNjYuMDMgNzI3LjAwIEwgMjQ4Ljk3IDcyNy4wMCBMIDI0OS41MCA2NjUuNTAgTCAyNjUuNTAgNjY1LjUwIFpNIDU5Ny4wNyA2NTcuOTYgQzU5NC43Myw2NTkuMjIgNTg2LjM2LDY1OS4yMiA1ODMuMjUsNjU3Ljk3IEM1ODEuMjIsNjU3LjE1IDU4MS4wMCw2NTYuMzkgNTgxLjAwLDY1MC4xNSBDNTgxLjAwLDY0My44MiA1ODEuMTksNjQzLjE4IDU4My4yNSw2NDIuNjMgQzU4Ni4xOSw2NDEuODQgNTkxLjk1LDY0MS44NCA1OTUuODgsNjQyLjYyIEwgNTk5LjAwIDY0My4yNSBMIDU5OS4wMCA2NTAuMDkgQzU5OS4wMCw2NTUuODMgNTk4LjY5LDY1Ny4xMCA1OTcuMDcsNjU3Ljk2IFpNIDM1NS40NSA3MTMuNTUgQzM1OC44OSw3MTYuOTkgMzYzLjA2LDcxNi43NiAzNjcuNDcsNzEyLjkwIEMzNzAuNDksNzEwLjI0IDM3MS4wMCw3MDkuMTcgMzcxLjAwLDcwNS40NiBDMzcxLjAwLDcwMy4wNyAzNzAuNTQsNzAwLjg0IDM2OS45OCw3MDAuNDkgQzM2OS40Miw3MDAuMTQgMzY2LjUxLDcwMC4xNyAzNjMuNTEsNzAwLjU0IEMzNTQuMDMsNzAxLjczIDM1MC4wNSw3MDguMTQgMzU1LjQ1LDcxMy41NSBaTSA2NjYuOTQgNzE0LjE2IEM2NjkuOTgsNzE2LjYxIDY3Mi45OSw3MTYuNDggNjc3LjA5LDcxMy43MiBDNjgyLjgyLDcwOS44NiA2ODUuMjAsNzAxLjgzIDY4MS4wMSw3MDAuNTAgQzY3Ny43MCw2OTkuNDUgNjY5Ljk4LDcwMS4xMiA2NjcuMjQsNzAzLjQ3IEM2NjMuODYsNzA2LjM4IDY2My43MSw3MTEuNTQgNjY2Ljk0LDcxNC4xNiBaTSA1MzcuNjIgNjg4LjcxIEM1NDAuMzcsNjkwLjcyIDU1Mi4yOSw2OTAuMzkgNTU0Ljk1LDY4OC4yNCBDNTU2Ljc4LDY4Ni43NiA1NTYuOTcsNjg2LjA1IDU1Ni4xMyw2ODMuODQgQzU1NC43MSw2ODAuMTAgNTUxLjIyLDY3OC4wMCA1NDYuNDEsNjc4LjAwIEM1NDEuNTIsNjc4LjAwIDUzNy41NCw2ODAuNzAgNTM2LjU0LDY4NC43MCBDNTM2LjA0LDY4Ni43MCA1MzYuMzIsNjg3Ljc2IDUzNy42Miw2ODguNzEgWiIgZmlsbD0icmdiKDM3LDI0NCwxNzApIi8+CjwvZz4KPC9zdmc+Cg==" style="height:26px;object-fit:contain;" alt="LitFinanceira"></div>
    </div>
    <div class="header-right">
      <button class="avatar-btn" id="avatar-btn" onclick="switchSection('perfil', document.querySelector('.nav-btn:first-child'))">?</button>
    </div>
  </div>

  <div class="sub-tab-bar" id="sub-tab-bar"></div>
  <div class="scroll-area">

    <!-- ══ PERFIL: DASHBOARD ══ -->
    <div class="tab-content" id="tab-dashboard">
      <!-- Login prompt for guests -->
      <div class="login-prompt" id="guest-prompt-dashboard" style="display:none">
        <div class="login-prompt-text"><strong>Cria uma conta grátis</strong>Regista rendimentos, despesas e acompanha o teu saldo mensal.</div>
        <button class="login-prompt-btn" onclick="mostrarLogin()">Entrar</button>
      </div>
      <div id="logged-dashboard">
      <div class="profile-hero">
        <div class="profile-avatar" id="dash-avatar">?</div>
        <div class="profile-name" id="dash-nome">—</div>
        <div class="profile-email" id="dash-email">—</div>
        <div class="profile-stats">
          <div class="profile-stat"><div class="profile-stat-val" id="stat-saldo">—</div><div class="profile-stat-label">Saldo</div></div>
          <div class="profile-stat"><div class="profile-stat-val" id="stat-poupanca">—</div><div class="profile-stat-label">Poupança</div></div>
          <div class="profile-stat"><div class="profile-stat-val" id="stat-meses">—</div><div class="profile-stat-label">Meses</div></div>
        </div>
      </div>

      <div class="month-bar">
        <div class="month-nav">
          <div class="month-btn" onclick="mudaMes(-1)">‹</div>
          <div class="month-label" id="mes-label">—</div>
          <div class="month-btn" onclick="mudaMes(1)">›</div>
        </div>
      </div>

      <div class="dash-grid">
        <div class="dash-card income">
          <div class="dash-icon">💚</div>
          <div class="dash-label">Rendimentos</div>
          <div class="dash-value" id="dash-rendimentos">0 €</div>
          <div class="dash-sub" id="dash-n-rendimentos">0 entradas</div>
        </div>
        <div class="dash-card expense">
          <div class="dash-icon">🔴</div>
          <div class="dash-label">Despesas</div>
          <div class="dash-value" id="dash-despesas">0 €</div>
          <div class="dash-sub" id="dash-n-despesas">0 saídas</div>
        </div>
        <div class="dash-card savings full">
          <div class="dash-icon">🏦</div>
          <div class="dash-label">Saldo do Mês</div>
          <div class="dash-value" id="dash-saldo-mes" style="font-size:1.3rem">0 €</div>
          <div class="dash-sub">Rendimentos − Despesas</div>
        </div>
      </div>

      <p class="section-title">Movimentos do Mês</p>
      <div class="registo-list" id="lista-movimentos">
        <div class="empty-state">Sem movimentos registados neste mês.</div>
      </div>
    </div>

      </div><!-- end logged-dashboard -->
    <!-- ══ PERFIL: REGISTAR ══ -->
    <div class="tab-content" id="tab-registar">
      <div class="hero-card">
        <div class="hero-label">Novo Movimento</div>
        <div class="hero-value"><span class="accent">+ Adicionar</span></div>
        <div class="hero-sub">Regista rendimentos e despesas mensais</div>
        <div class="hero-badge">📊 Dados guardados na tua conta</div>
      </div>
      <div class="sim-card">
        <div class="sim-card-title"><div class="sim-icon">📝</div>Tipo de Movimento</div>
        <div class="modal-type-row">
          <button class="type-btn income active" id="tipo-income" onclick="selectTipo('income')">💚 Rendimento</button>
          <button class="type-btn expense" id="tipo-expense" onclick="selectTipo('expense')">🔴 Despesa</button>
        </div>
        <div class="input-group">
          <div class="input-label">Descrição</div>
          <input class="input-field" type="text" id="reg-descricao" placeholder="Ex: Salário, Renda, Supermercado…" style="padding:11px 14px;">
        </div>
        <div class="input-group">
          <div class="input-label">Valor</div>
          <div class="input-wrapper">
            <input class="input-field" type="number" id="reg-valor" placeholder="0.00" step="0.01">
            <span class="input-unit">€</span>
          </div>
        </div>
        <div class="input-group">
          <div class="input-label">Categoria</div>
          <select class="select-field" id="reg-categoria">
            <optgroup label="Rendimentos">
              <option value="Salário">Salário</option>
              <option value="Freelance">Freelance</option>
              <option value="Rendas">Rendas</option>
              <option value="Investimentos">Investimentos</option>
              <option value="Outros Rendimentos">Outros Rendimentos</option>
            </optgroup>
            <optgroup label="Despesas">
              <option value="Habitação">Habitação (Renda/Crédito)</option>
              <option value="Alimentação">Alimentação</option>
              <option value="Transportes">Transportes</option>
              <option value="Saúde">Saúde</option>
              <option value="Educação">Educação</option>
              <option value="Lazer">Lazer</option>
              <option value="Seguros">Seguros</option>
              <option value="Comunicações">Comunicações</option>
              <option value="Outros">Outros</option>
            </optgroup>
          </select>
        </div>
        <div class="input-group">
          <div class="input-label">Data</div>
          <input class="input-field" type="date" id="reg-data" style="padding:11px 14px;">
        </div>
        <div class="input-group">
          <div class="input-label">Notas (opcional)</div>
          <input class="input-field" type="text" id="reg-notas" placeholder="Notas opcionais…" style="padding:11px 14px;">
        </div>
        <button class="calc-btn" onclick="guardarMovimento()">💾 Guardar Movimento</button>
        <div id="reg-feedback" style="text-align:center;font-size:0.8rem;margin-top:10px;min-height:20px;"></div>
      </div>
    </div>

    <!-- ══ PERFIL: DEFINIÇÕES ══ -->
    <div class="tab-content" id="tab-definicoes">
      <!-- Guest state -->
      <div id="guest-definicoes" style="display:none">
        <div class="hero-card">
          <div class="hero-label">A tua conta</div>
          <div class="hero-value"><span class="accent">Entrar</span></div>
          <div class="hero-sub">Cria uma conta para guardar os teus dados</div>
          <div class="hero-badge">🔐 Grátis e seguro</div>
        </div>
        <div class="sim-card">
          <div class="sim-card-title"><div class="sim-icon">👤</div>Acesso à conta</div>
          <p style="font-size:0.83rem;color:var(--muted);line-height:1.6;margin-bottom:16px;">Com uma conta podes guardar o teu perfil, registar movimentos financeiros e acompanhar o teu saldo mês a mês.</p>
          <button class="calc-btn" onclick="mostrarLogin()">🔐 Entrar / Criar conta</button>
          <div style="text-align:center;margin-top:14px;">
            <span onclick="document.getElementById('disclaimer-modal').classList.add('open')" style="font-size:0.72rem;color:var(--muted);cursor:pointer;text-decoration:underline;text-underline-offset:3px;">⚖️ Aviso Legal e Exoneração de Responsabilidade</span>
          </div>
        </div>
      </div>
      <!-- Logged state -->
      <div id="logged-definicoes">
      <div class="hero-card">
        <div class="hero-label">Conta</div>
        <div class="hero-value" style="font-size:1.4rem"><span class="accent" id="def-nome-hero">—</span></div>
        <div class="hero-sub" id="def-email-hero">—</div>
        <div class="hero-badge">👤 Perfil Pessoal</div>
      </div>
      <div class="sim-card">
        <div class="sim-card-title"><div class="sim-icon">👤</div>Informação Pessoal</div>
        <div class="input-group">
          <div class="input-label">Nome</div>
          <input class="input-field" type="text" id="def-nome" placeholder="O teu nome" style="padding:11px 14px;">
        </div>
        <div class="input-group">
          <div class="input-label">Data de Nascimento</div>
          <input class="input-field" type="date" id="def-datanasc" style="padding:11px 14px;">
        </div>
        <div class="input-group">
          <div class="input-label">Estado Civil</div>
          <select class="select-field" id="def-estadocivil">
            <option value="nc_c2t">Não Casado / Casado 2 Titulares</option>
            <option value="c1t">Casado 1 Titular</option>
          </select>
        </div>
        <div class="input-group">
          <div class="input-label">Nº de Dependentes</div>
          <div class="input-wrapper">
            <input class="input-field" type="number" id="def-ndep" value="0" min="0" max="10">
            <span class="input-unit">#</span>
          </div>
        </div>
        <button class="calc-btn" onclick="guardarPerfil()">💾 Guardar Perfil</button>
        <div id="perfil-feedback" style="text-align:center;font-size:0.8rem;margin-top:10px;min-height:20px;color:var(--green);"></div>
      </div>
      <button class="logout-btn" onclick="doLogout()">🚪 Terminar Sessão</button>
      <div style="text-align:center;margin-top:14px;">
        <span onclick="document.getElementById('disclaimer-modal').classList.add('open')" style="font-size:0.72rem;color:var(--muted);cursor:pointer;text-decoration:underline;text-underline-offset:3px;">⚖️ Aviso Legal e Exoneração de Responsabilidade</span>
      </div>
      </div><!-- end logged-definicoes -->
    </div>

    <!-- ══ SIMULAR: SALÁRIO ══ -->
    <div class="tab-content" id="tab-salario">
      <div class="hero-card">
        <div class="hero-label">Calculadora Fiscal</div>
        <div class="hero-value"><span class="accent" id="hero-liquido">—</span></div>
        <div class="hero-sub" id="hero-sal-sub">Salário líquido estimado mensal</div>
        <div class="hero-badge">✦ Tabelas IRS 2026 · Art. 99.º-C CIRS</div>
      </div>
      <div class="sim-card">
        <div class="sim-card-title"><div class="sim-icon">💶</div>Dados Pessoais e Salariais</div>
        <div class="input-group"><div class="input-label">Estado Civil</div><select class="select-field" id="irs-estadoCivil"><option value="nc_c2t">Não Casado / Casado 2 Titulares</option><option value="c1t">Casado 1 Titular</option></select></div>
        <div class="input-group"><div class="input-label">Nº de Dependentes</div><div class="input-wrapper"><input class="input-field" type="number" id="irs-dependentes" value="0" min="0" max="10"><span class="input-unit">#</span></div></div>
        <div class="check-row"><input type="checkbox" id="irs-incapacidade"><label for="irs-incapacidade">Incapacidade ≥ 60% (fator 0.85)</label></div>
        <div class="card-section-label">Rendimentos Mensais</div>
        <div class="input-group"><div class="input-label">Vencimento Base Bruto</div><div class="input-wrapper"><input class="input-field" type="number" id="irs-base" value="1500" step="0.01"><span class="input-unit">€</span></div></div>
        <div class="input-group"><div class="input-label">Horas Extra <span class="retention-tag">Ret. Autónoma</span></div><div class="input-wrapper"><input class="input-field" type="number" id="irs-extras" value="0" step="0.01"><span class="input-unit">€</span></div></div>
        <div class="input-group"><div class="input-label">Outros Rendimentos Sujeitos</div><div class="input-wrapper"><input class="input-field" type="number" id="irs-outros" value="0" step="0.01"><span class="input-unit">€</span></div></div>
        <div class="input-group"><div class="input-label">Rendimentos Isentos</div><div class="input-wrapper"><input class="input-field" type="number" id="irs-isentos" value="0" step="0.01"><span class="input-unit">€</span></div></div>
        <div class="card-section-label">Subsídio de Alimentação</div>
        <div class="input-group"><div class="input-label">Valor por Dia</div><div class="input-wrapper"><input class="input-field" type="number" id="irs-subAlimValor" value="6.00" step="0.01"><span class="input-unit">€</span></div></div>
        <div class="input-group"><div class="input-label">Dias Trabalhados</div><div class="input-wrapper"><input class="input-field" type="number" id="irs-subAlimDias" value="22"><span class="input-unit">dias</span></div></div>
        <div class="input-group"><div class="input-label">Forma de Pagamento</div><select class="select-field" id="irs-tipoPagAlim"><option value="cartao">Cartão / Vale (isento até 9,60 €)</option><option value="dinheiro">Dinheiro (isento até 6,00 €)</option></select></div>
        <div class="card-section-label">Subsídios de Férias / Natal</div>
        <div class="input-group"><div class="input-label">Pagamento em Duodécimos <span class="retention-tag">Ret. Autónoma</span></div><select class="select-field" id="irs-duodecimos"><option value="0">Pagamento por inteiro (0%)</option><option value="50">50% em Duodécimos</option><option value="100">100% em Duodécimos</option></select></div>
        <div class="card-section-label">Segurança Social</div>
        <div class="input-group"><div class="input-label">Taxa SS Trabalhador</div><div class="input-wrapper"><input class="input-field" type="number" id="irs-taxaSS" value="11" step="0.1"><span class="input-unit">%</span></div></div>
        <button class="calc-btn" onclick="calcSalarioCompleto()">Calcular Salário Líquido</button>
      </div>
      <div id="irs-results-block" style="display:none">
        <p class="section-title">Processamento Salarial</p>
        <div class="result-grid">
          <div class="result-box" style="grid-column:1/-1"><div class="result-label">Vencimento Base</div><div class="result-value" id="rr-base">—</div></div>
          <div class="result-box" id="rr-box-extras" style="display:none"><div class="result-label">Horas Extra</div><div class="result-value" id="rr-extras">—</div></div>
          <div class="result-box" id="rr-box-duo" style="display:none"><div class="result-label">Duodécimos</div><div class="result-value" id="rr-duo">—</div></div>
          <div class="result-box"><div class="result-label">Sub. Alimentação</div><div class="result-value" id="rr-subAlim">—</div></div>
          <div class="result-box" id="rr-box-trib" style="display:none"><div class="result-label">↳ Parte Tributável</div><div class="result-value" style="color:var(--amber)" id="rr-subAlimTrib">—</div></div>
        </div>
        <div class="mortgage-breakdown" style="margin-top:10px">
          <div class="breakdown-title">Resumo Mensal Completo</div>
          <div class="breakdown-row"><span class="key">Total Bruto</span><span class="val" id="bd-totalBruto">—</span></div>
          <div class="breakdown-row"><span class="key">Segurança Social (<span id="bd-taxaSS-pct">11%</span>)</span><span class="val red" id="bd-ss">—</span></div>
          <div class="breakdown-row"><span class="key">Taxa IRS aplicada</span><span class="val amber" id="bd-taxaIRS">—</span></div>
          <div class="breakdown-row"><span class="key">Total IRS</span><span class="val red" id="bd-totalIRS">—</span></div>
          <div class="breakdown-row"><span class="key">Total Descontos</span><span class="val red" id="bd-totalDesc">—</span></div>
          <div class="breakdown-row"><span class="key">Salário Líquido</span><span class="val green" id="bd-liquido">—</span></div>
          <div class="breakdown-row"><span class="key">Taxa Efectiva Total</span><span class="val amber" id="bd-taxaEfetiva">—</span></div>
          <div class="breakdown-row" id="bd-row-irsExtras" style="display:none"><span class="key">IRS Horas Extra (Autón.)</span><span class="val red" id="bd-irsExtras">—</span></div>
          <div class="breakdown-row" id="bd-row-irsDuo" style="display:none"><span class="key">IRS Duodécimos (Autón.)</span><span class="val red" id="bd-irsDuo">—</span></div>
        </div>
        <div class="result-grid" style="margin-top:10px">
          <div class="result-box highlight" style="grid-column:1/-1"><div class="result-label">Salário Líquido Estimado</div><div class="result-value" id="rr-liquido">—</div></div>
          <div class="result-box highlight-red"><div class="result-label">Total Descontos</div><div class="result-value" id="rr-descontos">—</div></div>
          <div class="result-box highlight-amber"><div class="result-label">Taxa Efectiva</div><div class="result-value" id="rr-taxaEfetiva">—</div></div>
        </div>
        <div class="legal-note">⚖️ Fórmula AT: <strong>Remuneração × Taxa − Parcela a abater − (Adicional × Dependentes)</strong></div>
      </div>
    </div>

    <!-- ══ SIMULAR: TAXA ESFORÇO ══ -->
    <div class="tab-content" id="tab-esforco">
      <div class="hero-card">
        <div class="hero-label">Análise Bancária de Crédito</div>
        <div class="hero-value"><span class="accent" id="hero-esforco">—</span></div>
        <div class="hero-sub" id="hero-esforco-sub">Taxa de esforço · DSTI · LTV</div>
        <div class="hero-badge">🏦 Regulação Banco de Portugal</div>
      </div>
      <div class="sim-card">
        <div class="sim-card-title"><div class="sim-icon">👤</div>Titular 1</div>
        <div class="input-group"><div class="input-label">Data de Nascimento <span style="font-size:0.65rem;color:var(--amber);font-weight:700;margin-left:4px;">↳ limita prazo máximo</span></div><input class="input-field" type="date" id="esf-dn1" style="padding:11px 14px;" onchange="esf_atualizarPrazo()"></div>
        <div class="input-group"><div class="input-label">Salário Líquido Mensal</div><div class="input-wrapper"><input class="input-field" type="number" id="esf-rend1" placeholder="1500" step="100"><span class="input-unit">€</span></div></div>
        <div class="input-group"><div class="input-label">Outras Prestações Mensais</div><div class="input-wrapper"><input class="input-field" type="number" id="esf-op1" value="0" step="10"><span class="input-unit">€</span></div></div>
        <div class="input-group"><div class="input-label">Outros Encargos Mensais</div><div class="input-wrapper"><input class="input-field" type="number" id="esf-enc1" value="0" step="10"><span class="input-unit">€</span></div></div>
      </div>
      <div class="sim-card">
        <div class="sim-card-title"><div class="sim-icon">👤</div>Titular 2 <span style="font-size:0.65rem;color:var(--muted);font-weight:500;margin-left:4px;">(opcional)</span></div>
        <div class="input-group"><div class="input-label">Data de Nascimento</div><input class="input-field" type="date" id="esf-dn2" style="padding:11px 14px;" onchange="esf_atualizarPrazo()"></div>
        <div class="input-group"><div class="input-label">Salário Líquido Mensal</div><div class="input-wrapper"><input class="input-field" type="number" id="esf-rend2" value="0" step="100"><span class="input-unit">€</span></div></div>
        <div class="input-group"><div class="input-label">Outras Prestações Mensais</div><div class="input-wrapper"><input class="input-field" type="number" id="esf-op2" value="0" step="10"><span class="input-unit">€</span></div></div>
        <div class="input-group"><div class="input-label">Encargos Mútuos Mensais</div><div class="input-wrapper"><input class="input-field" type="number" id="esf-encMutuos" value="0" step="10"><span class="input-unit">€</span></div></div>
      </div>
      <div class="sim-card">
        <div class="sim-card-title"><div class="sim-icon">🏠</div>Imóvel e Empréstimo</div>
        <div class="input-group"><div class="input-label">Valor do Imóvel</div><div class="input-wrapper"><input class="input-field" type="number" id="esf-vImovel" placeholder="200000" step="1000"><span class="input-unit">€</span></div></div>
        <div class="input-group"><div class="input-label">Montante do Empréstimo</div><div class="input-wrapper"><input class="input-field" type="number" id="esf-montante" placeholder="160000" step="1000"><span class="input-unit">€</span></div></div>
        <div class="input-group"><div class="input-label">Taxa de Juro Anual</div><div class="input-wrapper"><input class="input-field" type="number" id="esf-taxa" placeholder="3.65" step="0.01" value="3.65"><span class="input-unit">%</span></div></div>
        <div class="input-group"><div class="input-label">Prazo do Empréstimo</div><div class="input-wrapper"><input class="input-field" type="number" id="esf-prazo" placeholder="360" step="1" value="360" min="12" max="480"><span class="input-unit">meses</span></div><div id="esf-prazo-info" style="font-size:0.7rem;color:var(--green);margin-top:5px;padding:6px 10px;background:var(--green-light);border-radius:8px;display:none;font-weight:600;"></div></div>
        <button class="calc-btn" onclick="calcEsforco()">Calcular DSTI · Taxa de Esforço · LTV</button>
      </div>
      <div id="esf-results-block" style="display:none">
        <p class="section-title">Resultados da Análise</p>
        <div class="result-grid">
          <div class="result-box" id="esf-box-te"><div class="result-label">Taxa de Esforço</div><div class="result-value" id="res-esforco">—</div><div class="progress-bar" style="margin-top:8px"><div class="progress-fill" id="esf-fill-te" style="width:0%"></div></div><div style="font-size:0.62rem;color:var(--muted);margin-top:4px;">Limite recomendado: 60%</div></div>
          <div class="result-box" id="esf-box-dsti"><div class="result-label">DSTI (c/ stress +1.5%)</div><div class="result-value" id="res-dsti">—</div><div class="progress-bar" style="margin-top:8px"><div class="progress-fill" id="esf-fill-dsti" style="width:0%"></div></div><div style="font-size:0.62rem;color:var(--muted);margin-top:4px;">Limite BdP: 50%</div></div>
          <div class="result-box" id="esf-box-ltv" style="grid-column:1/-1"><div class="result-label">LTV — Loan-to-Value</div><div class="result-value" id="res-ltv">—</div><div class="progress-bar" style="margin-top:8px"><div class="progress-fill" id="esf-fill-ltv" style="width:0%"></div></div><div style="font-size:0.62rem;color:var(--muted);margin-top:4px;">Limite BdP: 90%</div></div>
        </div>
        <div class="mortgage-breakdown" style="margin-top:10px">
          <div class="breakdown-title">Detalhe do Cálculo</div>
          <div class="breakdown-row"><span class="key">Prestação Mensal</span><span class="val green" id="bd-esf-prest">—</span></div>
          <div class="breakdown-row"><span class="key">Prestação c/ Stress (+1,5%)</span><span class="val amber" id="bd-esf-prestStress">—</span></div>
          <div class="breakdown-row"><span class="key">Rendimento Total Mensal</span><span class="val" id="bd-esf-rendTotal">—</span></div>
          <div class="breakdown-row"><span class="key">Rendimento Ajustado (idade)</span><span class="val" id="bd-esf-rendAjust">—</span></div>
          <div class="breakdown-row"><span class="key">Prazo Máximo BdP</span><span class="val amber" id="bd-esf-prazoMax">—</span></div>
          <div class="breakdown-row"><span class="key">Taxa de Esforço</span><span class="val" id="bd-esf-te">—</span></div>
          <div class="breakdown-row"><span class="key">DSTI</span><span class="val" id="bd-esf-dsti">—</span></div>
          <div class="breakdown-row"><span class="key">LTV</span><span class="val" id="bd-esf-ltv">—</span></div>
        </div>
        <p class="section-title">Montantes Máximos de Empréstimo</p>
        <div class="result-grid">
          <div class="result-box"><div class="result-label">Por Taxa Esforço (60%)</div><div class="result-value" id="res-maxTE">—</div></div>
          <div class="result-box"><div class="result-label">Por DSTI (50%)</div><div class="result-value" id="res-maxDSTI">—</div></div>
          <div class="result-box"><div class="result-label">Por LTV (90%)</div><div class="result-value" id="res-maxLTV">—</div></div>
          <div class="result-box highlight" style="grid-column:1/-1"><div class="result-label">Montante Máximo Recomendado</div><div class="result-value" id="res-maxRec">—</div></div>
        </div>
        <div class="legal-note">⚖️ DSTI calculado com teste de stress <strong>+1,5%</strong> conforme Aviso BdP n.º 4/2017.</div>
      </div>
    </div>

    <!-- ══ SIMULAR: IMT ══ -->
    <div class="tab-content" id="tab-imt">
      <div class="hero-card"><div class="hero-label">Impostos na Compra</div><div class="hero-value"><span class="accent" id="hero-imt">—</span></div><div class="hero-sub">IMT + Imposto de Selo estimado</div><div class="hero-badge">🏠 Tabelas 2025</div></div>
      <div class="sim-card">
        <div class="sim-card-title"><div class="sim-icon">🏠</div>IMT + Imposto de Selo</div>
        <div class="input-group"><div class="input-label">Valor do Imóvel</div><div class="input-wrapper"><input class="input-field" type="number" id="imt-valor" placeholder="200000"><span class="input-unit">€</span></div></div>
        <div class="chip-row" id="imt-chips"><div class="chip active" onclick="selectChip(this,'imt-chips')">Habitação Própria</div><div class="chip" onclick="selectChip(this,'imt-chips')">Secundária</div></div>
        <button class="calc-btn" onclick="calcIMT()">Calcular Impostos</button>
        <div class="result-grid" id="imt-results" style="display:none">
          <div class="result-box"><div class="result-label">IMT</div><div class="result-value" id="res-imt">—</div></div>
          <div class="result-box"><div class="result-label">Imposto de Selo</div><div class="result-value" id="res-selo">—</div></div>
          <div class="result-box highlight" style="grid-column:1/-1"><div class="result-label">Total a Pagar</div><div class="result-value" id="res-imt-total">—</div></div>
        </div>
      </div>
    </div>

    <!-- ══ SIMULAR: POUPANÇA ══ -->
    <div class="tab-content" id="tab-sim-poupanca">
      <div class="hero-card"><div class="hero-label">Simulador de Poupança</div><div class="hero-value"><span class="accent" id="hero-poup">—</span></div><div class="hero-sub">Valor final líquido após impostos</div><div class="hero-badge">🏦 Com retenção na fonte</div></div>
      <div class="sim-card">
        <div class="sim-card-title"><div class="sim-icon">🏦</div>Poupança com Juro Composto</div>
        <div class="info-box">💡 Os juros são sujeitos a <strong>retenção na fonte de 28%</strong> em Portugal.</div>
        <div class="input-group"><div class="input-label">Capital Inicial</div><div class="input-wrapper"><input class="input-field" type="number" id="p-capital" value="5000"><span class="input-unit">€</span></div></div>
        <div class="input-group"><div class="input-label">Depósito Mensal</div><div class="input-wrapper"><input class="input-field" type="number" id="p-mensal" value="200"><span class="input-unit">€</span></div></div>
        <div class="input-group"><div class="input-label">Taxa de Juro Bruta Anual</div><div class="input-wrapper"><input class="input-field" type="number" id="p-taxa" value="3.5" step="0.1"><span class="input-unit">%</span></div></div>
        <div class="input-group"><div class="input-label">Taxa de Retenção <span class="retention-tag">⚠️ Estado fica</span></div><div class="input-wrapper"><input class="input-field" type="number" id="p-retencao" value="28" step="1"><span class="input-unit">%</span></div></div>
        <div class="input-group"><div class="input-label">Capitalização dos Juros</div></div>
        <div class="chip-row" id="p-cap-chips"><div class="chip" onclick="selectChip(this,'p-cap-chips')">Mensal</div><div class="chip" onclick="selectChip(this,'p-cap-chips')">3 Meses</div><div class="chip active" onclick="selectChip(this,'p-cap-chips')">6 Meses</div><div class="chip" onclick="selectChip(this,'p-cap-chips')">12 Meses</div></div>
        <div class="input-group"><div class="input-label">Período Total</div><div class="input-wrapper"><input class="input-field" type="number" id="p-anos" value="5"><span class="input-unit">anos</span></div></div>
        <button class="calc-btn" onclick="calcPoupanca()">Calcular Poupança</button>
        <div id="p-results" style="display:none">
          <div class="result-grid">
            <div class="result-box highlight" style="grid-column:1/-1"><div class="result-label">Valor Final Líquido</div><div class="result-value" id="res-p-liquido">—</div></div>
            <div class="result-box"><div class="result-label">Capital Depositado</div><div class="result-value" id="res-p-depositado">—</div></div>
            <div class="result-box"><div class="result-label">Juros Brutos</div><div class="result-value" id="res-p-juros-brutos">—</div></div>
            <div class="result-box highlight-red"><div class="result-label">Retenção (Estado)</div><div class="result-value" id="res-p-retencao">—</div></div>
            <div class="result-box"><div class="result-label">Juros Líquidos</div><div class="result-value" id="res-p-juros-liq">—</div></div>
          </div>
          <div class="mortgage-breakdown" style="margin-top:12px">
            <div class="breakdown-title">Detalhe</div>
            <div class="breakdown-row"><span class="key">Taxa Líquida Efetiva</span><span class="val green" id="bd-p-taxa-liq">—</span></div>
            <div class="breakdown-row"><span class="key">Capitalização</span><span class="val" id="bd-p-cap">—</span></div>
            <div class="breakdown-row"><span class="key">Nº de Períodos</span><span class="val" id="bd-p-periodos">—</span></div>
            <div class="breakdown-row"><span class="key">Rentabilidade Total</span><span class="val green" id="bd-p-rentab">—</span></div>
          </div>
        </div>
      </div>
    </div>

    <!-- ══ SIMULAR: INVESTIMENTO ══ -->
    <div class="tab-content" id="tab-investimento">
      <div class="hero-card"><div class="hero-label">Retorno de Capital</div><div class="hero-value"><span class="accent" id="hero-inv">—</span></div><div class="hero-sub">Valor final líquido após impostos</div><div class="hero-badge">📊 Mais-valias e dividendos</div></div>
      <div class="sim-card">
        <div class="sim-card-title"><div class="sim-icon">📈</div>Simulador de Investimento</div>
        <div class="info-box">💡 Mais-valias e dividendos sujeitos a <strong>28% de imposto</strong> em Portugal.</div>
        <div class="input-group"><div class="input-label">Capital Investido</div><div class="input-wrapper"><input class="input-field" type="number" id="inv-capital" value="10000"><span class="input-unit">€</span></div></div>
        <div class="input-group"><div class="input-label">Reforço Mensal</div><div class="input-wrapper"><input class="input-field" type="number" id="inv-mensal" value="0"><span class="input-unit">€</span></div></div>
        <div class="input-group"><div class="input-label">Rentabilidade Anual Bruta</div><div class="input-wrapper"><input class="input-field" type="number" id="inv-taxa" value="7" step="0.5"><span class="input-unit">%</span></div></div>
        <div class="input-group"><div class="input-label">Imposto <span class="retention-tag">⚠️ Estado fica</span></div><div class="input-wrapper"><input class="input-field" type="number" id="inv-retencao" value="28" step="1"><span class="input-unit">%</span></div></div>
        <div class="input-group"><div class="input-label">Horizonte Temporal</div><div class="input-wrapper"><input class="input-field" type="number" id="inv-anos" value="20"><span class="input-unit">anos</span></div></div>
        <button class="calc-btn" onclick="calcInvestimento()">Simular Investimento</button>
        <div id="inv-results" style="display:none">
          <div class="result-grid">
            <div class="result-box highlight" style="grid-column:1/-1"><div class="result-label">Valor Final Líquido</div><div class="result-value" id="res-inv-liq">—</div></div>
            <div class="result-box"><div class="result-label">Total Investido</div><div class="result-value" id="res-inv-dep">—</div></div>
            <div class="result-box"><div class="result-label">Ganho Bruto</div><div class="result-value" id="res-inv-bruto">—</div></div>
            <div class="result-box highlight-red"><div class="result-label">Imposto (Estado)</div><div class="result-value" id="res-inv-imposto">—</div></div>
            <div class="result-box"><div class="result-label">Ganho Líquido</div><div class="result-value" id="res-inv-liquido">—</div></div>
          </div>
          <div class="mortgage-breakdown" style="margin-top:12px">
            <div class="breakdown-title">Detalhe</div>
            <div class="breakdown-row"><span class="key">Taxa Líquida Efetiva</span><span class="val green" id="bd-inv-taxa-liq">—</span></div>
            <div class="breakdown-row"><span class="key">Multiplicador do Capital</span><span class="val" id="bd-inv-mult">—</span></div>
            <div class="breakdown-row"><span class="key">Rentabilidade Líquida</span><span class="val green" id="bd-inv-rentab">—</span></div>
          </div>
        </div>
      </div>
    </div>

    <!-- ══ SIMULAR: INFLAÇÃO ══ -->
    <div class="tab-content" id="tab-inflacao">
      <div class="hero-card"><div class="hero-label">Poder de Compra</div><div class="hero-value"><span class="accent" id="hero-inf">—</span></div><div class="hero-sub">Valor real futuro do teu dinheiro</div><div class="hero-badge">📉 Impacto da inflação</div></div>
      <div class="sim-card">
        <div class="sim-card-title"><div class="sim-icon">📉</div>Erosão pela Inflação</div>
        <div class="input-group"><div class="input-label">Valor Atual</div><div class="input-wrapper"><input class="input-field" type="number" id="inf-valor" value="100000"><span class="input-unit">€</span></div></div>
        <div class="input-group"><div class="input-label">Taxa de Inflação Anual</div><div class="input-wrapper"><input class="input-field" type="number" id="inf-taxa" value="2.5" step="0.1"><span class="input-unit">%</span></div></div>
        <div class="input-group"><div class="input-label">Período</div><div class="input-wrapper"><input class="input-field" type="number" id="inf-anos" value="10"><span class="input-unit">anos</span></div></div>
        <button class="calc-btn" onclick="calcInflacao()">Calcular Impacto</button>
        <div class="result-grid" id="inf-results" style="display:none">
          <div class="result-box highlight" style="grid-column:1/-1"><div class="result-label">Poder de Compra Futuro</div><div class="result-value" id="res-inf-futuro">—</div></div>
          <div class="result-box" style="grid-column:1/-1"><div class="result-label">Perda de Valor Real</div><div class="result-value" id="res-inf-perda" style="color:var(--red)">—</div></div>
        </div>
      </div>
    </div>

    <!-- ══ POUPANÇA: DEPÓSITOS ══ -->
    <div class="tab-content" id="tab-dep-prazo">
      <div class="hero-card" id="dp-hero"><div class="hero-label">Melhor Depósito a Prazo</div><div class="hero-value"><span class="accent" id="dp-best-rate">—</span></div><div class="hero-sub" id="dp-best-sub">A carregar...</div><div class="hero-badge">⚠️ Retenção 28% sobre juros</div></div>
      <div class="info-box">⚠️ Juros sujeitos a <strong>retenção na fonte de 28%</strong>. A TANL é o que efetivamente recebes.</div>
      <div class="disclaimer-note" onclick="document.getElementById('disclaimer-modal').classList.add('open')">
        <div class="disclaimer-note-icon">⚖️</div>
        <div class="disclaimer-note-text">Conteúdo estritamente informativo e sem aconselhamento financeiro. Pode conter links de afiliado.</div>
        <div class="disclaimer-note-link">Ver aviso legal →</div>
      </div>
      <div class="filter-block">
        <div class="filter-row">
          <div class="filter-toggle" id="ft-novos-capitais" onclick="toggleFilter('novos_capitais')"><div class="ft-dot"></div><span class="ft-label">Novos Capitais</span></div>
          <div class="filter-toggle" id="ft-novos-clientes" onclick="toggleFilter('novos_clientes')"><div class="ft-dot"></div><span class="ft-label">Novos Clientes</span></div>
          <div class="sort-btn" onclick="toggleSort()" id="sort-btn">↓ TANB</div>
        </div>
        <div class="filter-row" style="gap:8px;margin-top:8px;">
          <div class="filter-input-wrap"><span class="fi-label">Dep. Mín. ≤</span><input class="fi-input" type="number" id="f-dep-min" placeholder="ex: 1000" oninput="applyFilters()"><span class="fi-unit">€</span></div>
          <div class="filter-input-wrap"><span class="fi-label">Dep. Máx. ≥</span><input class="fi-input" type="number" id="f-dep-max" placeholder="ex: 50000" oninput="applyFilters()"><span class="fi-unit">€</span></div>
        </div>
        <div class="results-count" id="dp-count"></div>
      </div>
      <div id="dp-list"><div class="loading-state">⏳ A carregar depósitos...</div></div>
    </div>

    <!-- ══ POUPANÇA: CERTIFICADOS ══ -->
    <div class="tab-content" id="tab-certificados">
      <div class="hero-card"><div class="hero-label">Dívida Pública Portuguesa</div><div class="hero-value"><span class="accent">3.50%</span></div><div class="hero-sub">Certificados de Aforro · Série E · líquido: 2.52%</div><div class="hero-badge">🇵🇹 Garantido pelo Estado</div></div>
      <div class="info-box">⚠️ Os Certificados de Aforro e do Tesouro estão sujeitos a <strong>retenção de 28%</strong> sobre os juros.</div>
      <p class="section-title">Certificados de Aforro</p>
      <div class="product-card">
        <div class="product-header"><div class="product-left"><div class="product-logo">CA</div><div><div class="product-name">Certificados de Aforro</div><div class="product-type">Série E — capitalização anual</div></div></div><div><div class="product-rate">3.50%</div><div class="product-rate-label">TANB bruta</div></div></div>
        <div class="product-detail-row"><span class="dk">Taxa Líquida (após 28%)</span><span class="dv green">2.52%</span></div>
        <div class="product-detail-row"><span class="dk">Capitalização</span><span class="dv">Anual (12M)</span></div>
        <div class="product-detail-row"><span class="dk">Prazo Mínimo</span><span class="dv">3 meses</span></div>
        <div class="product-detail-row"><span class="dk">Garantia</span><span class="dv green">Estado Português</span></div>
      </div>
      <p class="section-title">Certificados do Tesouro</p>
      <div class="product-card" style="margin-bottom:20px">
        <div class="product-header"><div class="product-left"><div class="product-logo">CT</div><div><div class="product-name">Certificados do Tesouro</div><div class="product-type">CTPP — 10 anos</div></div></div><div><div class="product-rate">3.25%</div><div class="product-rate-label">ano 1 bruta</div></div></div>
        <div class="product-detail-row"><span class="dk">Taxa Líquida Ano 1</span><span class="dv green">2.34%</span></div>
        <div class="product-detail-row"><span class="dk">Taxa Bruta Ano 5</span><span class="dv">3.50%</span></div>
        <div class="product-detail-row"><span class="dk">Taxa Bruta Ano 10</span><span class="dv">3.75%</span></div>
        <div class="product-detail-row"><span class="dk">Garantia</span><span class="dv green">Estado Português</span></div>
      </div>
    </div>


    <!-- ══ POUPANÇA: ETFs ══ -->
    <div class="tab-content" id="tab-fundos">
      <div class="hero-card" id="etf-hero">
        <div class="hero-label">ETFs Disponíveis</div>
        <div class="hero-value"><span class="accent" id="etf-hero-val">—</span></div>
        <div class="hero-sub" id="etf-hero-sub">A carregar...</div>
        <div class="hero-badge">⚠️ 28% imposto sobre mais-valias</div>
      </div>
      <div class="disclaimer-note" onclick="document.getElementById('disclaimer-modal').classList.add('open')">
        <div class="disclaimer-note-icon">⚠️</div>
        <div class="disclaimer-note-text">Conteúdo estritamente informativo e sem aconselhamento financeiro. O capital investido em ETFs e Fundos apresenta risco de perda. Pode conter links de afiliado.</div>
        <div class="disclaimer-note-link">Ver aviso legal →</div>
      </div>
      <div class="etf-filter-bar" id="etf-cat-bar">
        <button class="etf-cat-btn active" onclick="filterEtfCat('Todos', this)">Todos</button>
        <button class="etf-cat-btn" onclick="filterEtfCat('Global', this)">Global</button>
        <button class="etf-cat-btn" onclick="filterEtfCat('EUA', this)">EUA</button>
        <button class="etf-cat-btn" onclick="filterEtfCat('Europa', this)">Europa</button>
        <button class="etf-cat-btn" onclick="filterEtfCat('Emergentes', this)">Emergentes</button>
        <button class="etf-cat-btn" onclick="filterEtfCat('Obrigações', this)">Obrigações</button>
        <button class="etf-cat-btn" onclick="filterEtfCat('Dividendos', this)">Dividendos</button>
        <button class="etf-cat-btn" onclick="filterEtfCat('Factor', this)">Factor</button>
        <button class="etf-cat-btn" onclick="filterEtfCat('Temático', this)">Temático</button>
      </div>
      <div id="etf-list"><div class="loading-state">⏳ A carregar ETFs...</div></div>
    </div>

    <!-- ══ TAXAS: EURIBOR ══ -->
    <div class="tab-content" id="tab-euribor">
      <div class="hero-card">
        <div class="hero-label" id="eur-hero-label">Euribor 12M</div>
        <div class="hero-value"><span class="accent" id="eur-hero-val">—</span></div>
        <div class="hero-sub" id="eur-hero-sub">A carregar...</div>
        <div class="hero-badge" id="eur-hero-badge">📡 ECB · Actualização diária</div>
      </div>
      <p class="section-title">Euribor por Prazo</p>
      <div class="euribor-strip">
        <div class="euribor-box"><div class="euribor-label">3 Meses</div><div class="euribor-val" id="eur-3m">—</div><div class="euribor-change" id="eur-3m-chg">—</div></div>
        <div class="euribor-box"><div class="euribor-label">6 Meses</div><div class="euribor-val" id="eur-6m">—</div><div class="euribor-change" id="eur-6m-chg">—</div></div>
        <div class="euribor-box"><div class="euribor-label">12 Meses</div><div class="euribor-val" id="eur-12m">—</div><div class="euribor-change" id="eur-12m-chg">—</div></div>
      </div>
      <div id="eur-updated" style="text-align:center;font-size:0.65rem;color:var(--muted);margin-top:6px;"></div>
    </div>

    <!-- ══ TAXAS: SPREADS ══ -->
    <div class="tab-content" id="tab-spreads">
      <div class="hero-card"><div class="hero-label">Melhor Spread</div><div class="hero-value"><span class="accent">0.85%</span></div><div class="hero-sub">Caixa Geral de Depósitos</div><div class="hero-badge">🏠 Crédito Habitação</div></div>
      <p class="section-title">Spreads — Crédito Habitação</p>
      <div class="rate-card"><div class="rate-left"><div class="rate-logo">CGD</div><div><div class="rate-name">Caixa Geral Dep.</div><div class="rate-type">Crédito Habitação</div></div></div><div><div class="rate-value">0.85%</div><div class="rate-period">spread</div></div></div>
      <div class="rate-card"><div class="rate-left"><div class="rate-logo">BPI</div><div><div class="rate-name">Banco BPI</div><div class="rate-type">Crédito Habitação</div></div></div><div><div class="rate-value">0.95%</div><div class="rate-period">spread</div></div></div>
      <div class="rate-card"><div class="rate-left"><div class="rate-logo">SNT</div><div><div class="rate-name">Santander</div><div class="rate-type">Crédito Habitação</div></div></div><div><div class="rate-value">1.00%</div><div class="rate-period">spread</div></div></div>
      <div class="rate-card" style="margin-bottom:20px"><div class="rate-left"><div class="rate-logo">NVB</div><div><div class="rate-name">Novobanco</div><div class="rate-type">Crédito Habitação</div></div></div><div><div class="rate-value">1.10%</div><div class="rate-period">spread</div></div></div>
    </div>

    <!-- ══ GUIA: IRS JOVEM ══ -->
    <div class="tab-content" id="tab-irs-jovem">
      <div class="guia-hero">
        <div class="guia-hero-label">Benefícios Fiscais</div>
        <div class="guia-hero-title">IRS Jovem <span>2025</span></div>
        <div class="guia-hero-sub">Regime fiscal para jovens até 35 anos. Isenção até 100% durante 10 anos.</div>
        <div class="guia-badges">
          <div class="guia-badge">📅 OE 2025</div>
          <div class="guia-badge">👤 Até 35 anos</div>
          <div class="guia-badge">⏱ 10 anos</div>
          <div class="guia-badge">💶 Art. 12.º-B CIRS</div>
        </div>
      </div>

      <!-- Elegibilidade -->
      <div class="guia-part-header" onclick="toggleGuia('g-irs-1',this)">
        <div><div class="guia-part-num">Secção 1</div><div class="guia-part-title">Condições de Elegibilidade</div></div>
        <div class="guia-part-arrow">▾</div>
      </div>
      <div class="guia-part-body" id="g-irs-1">
        <div class="guia-section">
          <div class="guia-text">Para beneficiar do novo IRS Jovem, o contribuinte deve cumprir <strong>cumulativamente</strong> as seguintes condições:</div>
          <ul class="guia-list">
            <li><strong>Idade:</strong> igual ou inferior a 35 anos a 31 de dezembro do ano fiscal.</li>
            <li><strong>Habilitações:</strong> irrelevantes — qualquer grau de escolaridade é aceite.</li>
            <li><strong>Rendimentos:</strong> exclusivamente Categoria A (trabalho dependente) ou Categoria B (recibos verdes).</li>
            <li><strong>Autonomia fiscal:</strong> declaração de IRS entregue como sujeito passivo autónomo (não dependente dos pais).</li>
          </ul>
          <div class="guia-warning">⚠️ Excluídos: beneficiários do Regime de Residente Não Habitual (RNH), Programa Regressar, incentivos à investigação, ou com dívidas às Finanças.</div>
        </div>
      </div>

      <!-- Isenções -->
      <div class="guia-part-header" onclick="toggleGuia('g-irs-2',this)">
        <div><div class="guia-part-num">Secção 2</div><div class="guia-part-title">Escada de Isenção — 10 Anos</div></div>
        <div class="guia-part-arrow">▾</div>
      </div>
      <div class="guia-part-body" id="g-irs-2">
        <div class="guia-section">
          <div class="guia-highlight">💡 Em 2025 o IAS é 522,50€. O limite máximo de rendimento isento é <strong>28.737,50€</strong> (55 × IAS).</div>
          <table class="guia-table">
            <thead><tr><th>Ano(s)</th><th>Isenção</th><th>Limite isento</th></tr></thead>
            <tbody>
              <tr><td>1.º Ano</td><td class="td-green">100%</td><td>28.737,50 €</td></tr>
              <tr><td>2.º, 3.º e 4.º Anos</td><td class="td-green">75%</td><td>28.737,50 €</td></tr>
              <tr><td>5.º, 6.º e 7.º Anos</td><td class="td-amber">50%</td><td>28.737,50 €</td></tr>
              <tr><td>8.º, 9.º e 10.º Anos</td><td class="td-amber">25%</td><td>28.737,50 €</td></tr>
            </tbody>
          </table>
          <div class="guia-text">Rendimento acima do limite de 28.737,50€ é tributado normalmente nos escalões de IRS. A isenção opera com <strong>progressividade</strong>: a parte isenta é englobada para determinar a taxa aplicável ao restante.</div>
        </div>
      </div>

      <!-- Retenção na fonte -->
      <div class="guia-part-header" onclick="toggleGuia('g-irs-3',this)">
        <div><div class="guia-part-num">Secção 3</div><div class="guia-part-title">Retenção na Fonte Mensal</div></div>
        <div class="guia-part-arrow">▾</div>
      </div>
      <div class="guia-part-body" id="g-irs-3">
        <div class="guia-section">
          <div class="guia-text"><strong>Categoria A (salário):</strong> Comunica por escrito à entidade patronal o ano de gozo do benefício. A retenção é aplicada apenas sobre a parte tributável do salário — o efeito é imediato no salário mensal.</div>
          <div class="guia-text"><strong>Categoria B (recibos verdes):</strong> Não há redução automática da retenção. O benefício é devolvido na liquidação final aquando da entrega da Modelo 3.</div>
          <div class="guia-highlight">💡 Regras de Transição: A contagem inicia-se no 1.º ano de rendimentos como sujeito passivo autónomo. Exemplo: início em 2020 → 6.º ano em 2025 → 50% de isenção.</div>
        </div>
      </div>
    </div>

    <!-- ══ GUIA: HABITAÇÃO ══ -->
    <div class="tab-content" id="tab-habitacao">
      <div class="guia-hero">
        <div class="guia-hero-label">Apoios à Habitação</div>
        <div class="guia-hero-title">Crédito Habitação <span>Jovem</span></div>
        <div class="guia-hero-sub">Garantia do Estado, IMT Jovem e regras de financiamento bancário.</div>
        <div class="guia-badges">
          <div class="guia-badge">🏠 Até 35 anos</div>
          <div class="guia-badge">🏦 100% Financiamento</div>
          <div class="guia-badge">✅ Isenção IMT</div>
          <div class="guia-badge">📋 BdP</div>
        </div>
      </div>

      <!-- Regras bancárias -->
      <div class="guia-part-header" onclick="toggleGuia('g-hab-1',this)">
        <div><div class="guia-part-num">Secção 1</div><div class="guia-part-title">Regras Gerais de Financiamento</div></div>
        <div class="guia-part-arrow">▾</div>
      </div>
      <div class="guia-part-body" id="g-hab-1">
        <div class="guia-section">
          <table class="guia-table">
            <thead><tr><th>Indicador</th><th>Regra</th></tr></thead>
            <tbody>
              <tr><td>LTV máximo</td><td class="td-amber">90% para Hab. Própria</td></tr>
              <tr><td>DSTI máximo</td><td class="td-amber">50% com stress +1,5%</td></tr>
              <tr><td>Prazo ≤ 30 anos</td><td>Máx. 40 anos</td></tr>
              <tr><td>Prazo 31–35 anos</td><td>Máx. 37 anos</td></tr>
              <tr><td>Prazo > 35 anos</td><td>Máx. 35 anos</td></tr>
            </tbody>
          </table>
          <div class="guia-text">Para comparar propostas, o indicador correcto é a <strong>TAEG</strong> (Taxa Anual Efetiva Global), que engloba juros, seguros obrigatórios (Vida e Multirriscos), comissões e impostos.</div>
        </div>
      </div>

      <!-- Garantia Pública -->
      <div class="guia-part-header" onclick="toggleGuia('g-hab-2',this)">
        <div><div class="guia-part-num">Secção 2</div><div class="guia-part-title">Garantia Pública — 100% Financiamento</div></div>
        <div class="guia-part-arrow">▾</div>
      </div>
      <div class="guia-part-body" id="g-hab-2">
        <div class="guia-section">
          <div class="guia-text">O Estado actua como fiador em até <strong>15% do valor</strong>, permitindo empréstimos a 100% LTV. A garantia extingue-se ao fim de 10 anos.</div>
          <div class="guia-section-title">Requisitos Cumulativos</div>
          <ul class="guia-list">
            <li>Idade entre 18 e 35 anos.</li>
            <li>Rendimentos do agregado ≤ 8.º escalão IRS (~81.199€/ano).</li>
            <li>Valor do imóvel ≤ 450.000€.</li>
            <li>Primeira Habitação Própria e Permanente.</li>
            <li>Não ser proprietário de nenhum imóvel habitacional.</li>
          </ul>
          <div class="guia-warning">⚠️ A Garantia do Estado não obriga o banco a aprovar o crédito. O DSTI continua a ser calculado — se os rendimentos forem insuficientes, o crédito é recusado.</div>
        </div>
      </div>

      <!-- IMT Jovem -->
      <div class="guia-part-header" onclick="toggleGuia('g-hab-3',this)">
        <div><div class="guia-part-num">Secção 3</div><div class="guia-part-title">Isenção de IMT e Imposto do Selo</div></div>
        <div class="guia-part-arrow">▾</div>
      </div>
      <div class="guia-part-body" id="g-hab-3">
        <div class="guia-section">
          <div class="guia-text">Para jovens até 35 anos, não dependentes, sem propriedade habitacional nos últimos 3 anos:</div>
          <table class="guia-table">
            <thead><tr><th>Valor do Imóvel</th><th>IMT e Selo</th></tr></thead>
            <tbody>
              <tr><td>Até 330.539 €</td><td class="td-green">100% isento</td></tr>
              <tr><td>330.539 € – 660.982 €</td><td class="td-amber">Isento nos primeiros 330.539 €<br>8% sobre o restante</td></tr>
              <tr><td>Acima de 660.982 €</td><td class="td-red">Sem isenção</td></tr>
            </tbody>
          </table>
          <div class="guia-highlight">💡 Isenção adicional: os jovens abrangidos ficam também isentos dos emolumentos do Registo de Aquisição e Hipoteca — poupança adicional ~700€.</div>
        </div>
      </div>
    </div>

    <!-- ══ GUIA: FAQs ══ -->
    <div class="tab-content" id="tab-faqs">
      <div class="guia-hero">
        <div class="guia-hero-label">Casos Práticos</div>
        <div class="guia-hero-title">Perguntas <span>Frequentes</span></div>
        <div class="guia-hero-sub">Esclarecimento de dúvidas complexas sobre IRS Jovem e Habitação.</div>
        <div class="guia-badges">
          <div class="guia-badge">❓ FAQs</div>
          <div class="guia-badge">⚖️ Rigor jurídico</div>
        </div>
      </div>

      <div class="faq-item" onclick="toggleFaq(this)">
        <div class="faq-q"><div class="faq-q-text">Tive uma quebra de rendimentos e não trabalhei num determinado ano. Perco os 10 anos do IRS Jovem?</div><div class="faq-arrow">▾</div></div>
        <div class="faq-a">Não. O benefício aplica-se durante 10 <strong>anos de obtenção de rendimentos</strong>. Se houver um ano civil sem rendimentos de Categoria A ou B, a isenção fica suspensa e retoma no ano seguinte, desde que o contribuinte não ultrapasse os 35 anos de idade.</div>
      </div>

      <div class="faq-item" onclick="toggleFaq(this)">
        <div class="faq-q"><div class="faq-q-text">As medidas da Garantia Pública e do IMT Jovem são acumuláveis?</div><div class="faq-arrow">▾</div></div>
        <div class="faq-a">Sim, operam de forma independente. Um jovem que cumpra os requisitos pode comprar uma casa de 300.000€ com financiamento a 100% (Garantia Pública) e ficar totalmente isento de IMT e registos.</div>
      </div>

      <div class="faq-item" onclick="toggleFaq(this)">
        <div class="faq-q"><div class="faq-q-text">Somos um casal — um tem 35 e o outro 38 anos. Temos direito aos apoios na habitação?</div><div class="faq-arrow">▾</div></div>
        <div class="faq-a"><strong>IMT Jovem:</strong> isenção aplicada de forma proporcional (50%). O membro de 35 anos não paga a sua metade; o de 38 anos paga tributação normal.<br><br><strong>Garantia Pública (100%):</strong> Não. A lei exige que <em>todos</em> os mutuários cumpram o limite de 35 anos. O casal perde a garantia e terá de entrar com os 10% de capitais próprios.</div>
      </div>

      <div class="faq-item" onclick="toggleFaq(this)">
        <div class="faq-q"><div class="faq-q-text">O banco é obrigado a aprovar o crédito a 100% com a Garantia do Estado?</div><div class="faq-arrow">▾</div></div>
        <div class="faq-a">Não. A garantia apenas substitui a entrada inicial. O banco continua obrigado a calcular o DSTI. Se os rendimentos não suportarem a prestação, o crédito é recusado por risco de incumprimento.</div>
      </div>

      <div class="faq-item" onclick="toggleFaq(this)">
        <div class="faq-q"><div class="faq-q-text">Herdei 1/4 da casa dos meus avós há 5 anos. Posso aceder às isenções?</div><div class="faq-arrow">▾</div></div>
        <div class="faq-a"><strong>Herança indivisa</strong> (sem partilhas formalizadas): o jovem não é considerado proprietário pleno — pode ter acesso às medidas.<br><br><strong>Após partilhas</strong> com quota-parte registada em nome próprio: perde o acesso à Garantia Pública (exige nunca ter sido proprietário) e, dependendo das datas, à isenção de IMT (exige não ser proprietário há pelo menos 3 anos).</div>
      </div>

      <div style="height:8px;"></div>
      <div class="disclaimer-note" onclick="document.getElementById('disclaimer-modal').classList.add('open')">
        <div class="disclaimer-note-icon">⚖️</div>
        <div class="disclaimer-note-text">Conteúdo estritamente informativo. Não constitui aconselhamento jurídico ou fiscal.</div>
        <div class="disclaimer-note-link">Ver aviso legal →</div>
      </div>
    </div>

  </div><!-- end scroll -->

  <div class="bottom-nav">
    <button class="nav-btn active" onclick="switchSection('perfil', this)"><div class="nav-icon">👤</div><div class="nav-label">Perfil</div></button>
    <button class="nav-btn" onclick="switchSection('simular', this)"><div class="nav-icon">🧮</div><div class="nav-label">Simular</div></button>
    <button class="nav-btn" onclick="switchSection('poupanca', this)"><div class="nav-icon">🏦</div><div class="nav-label">Poupança</div></button>
    <button class="nav-btn" onclick="switchSection('taxas', this)"><div class="nav-icon">📈</div><div class="nav-label">Taxas</div></button>
    <button class="nav-btn" onclick="switchSection('guia', this)"><div class="nav-icon">📘</div><div class="nav-label">Guia</div></button>
  </div>

  <!-- ══ DISCLAIMER MODAL ══ -->
  <div class="disclaimer-modal" id="disclaimer-modal">
    <div class="disclaimer-header">
      <div class="disclaimer-title">⚖️ Aviso Legal</div>
      <button class="disclaimer-close" onclick="document.getElementById('disclaimer-modal').classList.remove('open')">✕</button>
    </div>
    <div class="disclaimer-body">
      <div style="background:var(--navy);border-radius:16px;padding:18px;margin-bottom:20px;">
        <div style="font-family:'Syne',sans-serif;font-size:1rem;font-weight:800;color:#fff;margin-bottom:6px;">AVISO LEGAL E EXONERAÇÃO DE RESPONSABILIDADE</div>
        <div style="font-size:0.72rem;color:rgba(255,255,255,0.4);line-height:1.5;">Lê atentamente antes de utilizar esta aplicação.</div>
      </div>

      <div class="disclaimer-section">
        <div class="disclaimer-num">Ponto 1</div>
        <div class="disclaimer-heading">Natureza Exclusivamente Informativa e Educacional</div>
        <div class="disclaimer-text">Todo o conteúdo, ferramentas, dados, simulações e informações disponibilizados na aplicação Literacia financeira têm fins estritamente informativos e educacionais. Em nenhuma circunstância o conteúdo aqui apresentado deve ser interpretado como aconselhamento financeiro, jurídico, fiscal ou como uma recomendação personalizada de investimento. A nossa missão é promover o conhecimento financeiro, mas cada utilizador tem um perfil de risco e uma situação financeira únicos.</div>
      </div>

      <div class="disclaimer-section">
        <div class="disclaimer-num">Ponto 2</div>
        <div class="disclaimer-heading">Ausência de Intermediação Financeira</div>
        <div class="disclaimer-text">A Literacia financeira é uma plataforma de cariz tecnológico e educacional. Não somos um intermediário financeiro, consultor de investimentos, corretora ou instituição de crédito. Não estamos registados junto da Comissão do Mercado de Valores Mobiliários (CMVM), do Banco de Portugal ou de qualquer outra entidade reguladora para prestar serviços de consultoria, gestão de carteiras, ou receção e transmissão de ordens sobre instrumentos financeiros.</div>
      </div>

      <div class="disclaimer-section">
        <div class="disclaimer-num">Ponto 3</div>
        <div class="disclaimer-heading">Riscos de Investimento (ETFs, Fundos e Outros Ativos)</div>
        <div class="disclaimer-text">A subscrição de Fundos de Investimento, Exchange Traded Funds (ETFs) e outros produtos financeiros envolve um elevado grau de risco. O capital investido não é garantido e pode resultar na perda parcial ou total do mesmo. Importa salientar que as rentabilidades passadas não são, em caso algum, garantia de rentabilidades futuras. Qualquer decisão de investimento ou alocação de capital em ativos apresentados, comparados ou mencionados nesta aplicação é da inteira, livre e exclusiva responsabilidade do utilizador. Recomendamos vivamente que leia os Documentos de Informação Fundamental (DIF/KID) e os prospetos dos respetivos fundos antes de tomar qualquer decisão, e que consulte um consultor financeiro certificado caso necessite de aconselhamento adaptado à sua situação pessoal.</div>
      </div>

      <div class="disclaimer-section">
        <div class="disclaimer-num">Ponto 4</div>
        <div class="disclaimer-heading">Transparência de Afiliação (Links de Parceiros)</div>
        <div class="disclaimer-text">A Literacia financeira mantém parcerias com várias entidades e corretoras financeiras. Para manter a nossa aplicação acessível e em funcionamento, utilizamos links de afiliados. Isto significa que, se o utilizador clicar num link através da nossa plataforma e, subsequentemente, abrir uma conta, fizer um depósito ou subscrever um produto numa entidade terceira, a nossa equipa poderá receber uma compensação financeira (comissão). Esta compensação não representa qualquer custo adicional para o utilizador. A existência destas parcerias não influencia as informações apresentadas, não constitui uma garantia sobre a qualidade do serviço do parceiro e não altera o nosso compromisso com a isenção informativa.</div>
      </div>

      <div class="disclaimer-section">
        <div class="disclaimer-num">Ponto 5</div>
        <div class="disclaimer-heading">Exoneração e Limitação de Responsabilidade</div>
        <div class="disclaimer-text">Embora envidemos todos os esforços para garantir que a informação fornecida está atualizada, correta e isenta de erros, a Literacia financeira não garante a exatidão, integridade ou atualidade dos dados, taxas, comissões, cotações ou condições dos produtos mencionados.<br><br>A Literacia financeira, os seus fundadores, programadores, colaboradores e parceiros não assumem, em qualquer circunstância, qualquer responsabilidade por perdas financeiras, danos diretos ou indiretos, ou lucros cessantes que possam resultar da utilização da informação contida nesta aplicação ou das decisões tomadas pelo utilizador com base na mesma. O uso de plataformas de terceiros referenciadas na nossa app está sujeito aos Termos e Condições dessas mesmas plataformas.</div>
      </div>

      <div style="height:20px;"></div>
    </div>
  </div>


</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
// ============================================================
// SUPABASE CLIENT
// ============================================================
const SUPABASE_URL = 'https://zdjfscurtpbmdzybjaqf.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpkamZzY3VydHBibWR6eWJqYXFmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE5NTY0MDUsImV4cCI6MjA4NzUzMjQwNX0.ZqSqKwGcy8GzOsk7Ui500vatlMKhn-g6EK7lHrfkU-w';
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

const EDGE_URL = 'https://zdjfscurtpbmdzybjaqf.supabase.co/functions/v1/calcular';
const ANON_KEY = SUPABASE_KEY;

let currentUser = null;
let currentPerfil = null;
let guestMode = false;

function continuarSemRegisto() {
  guestMode = true;
  document.getElementById('auth-screen').classList.add('hidden');
  atualizarEstadoAuth();
}

function mostrarLogin() {
  guestMode = false;
  document.getElementById('auth-screen').classList.remove('hidden');
}

function atualizarEstadoAuth() {
  const logado = !!currentUser;
  // Avatar btn
  const avatarBtn = document.getElementById('avatar-btn');
  if (avatarBtn) avatarBtn.textContent = logado ? (currentPerfil?.nome || currentUser?.email || '?').split(' ').map(n=>n[0]).join('').substring(0,2).toUpperCase() : '👤';
  // Dashboard
  const guestDash = document.getElementById('guest-prompt-dashboard');
  const loggedDash = document.getElementById('logged-dashboard');
  if (guestDash) guestDash.style.display = logado ? 'none' : 'flex';
  if (loggedDash) loggedDash.style.display = logado ? '' : 'none';
  // Definicoes
  const guestDef = document.getElementById('guest-definicoes');
  const loggedDef = document.getElementById('logged-definicoes');
  if (guestDef) guestDef.style.display = logado ? 'none' : '';
  if (loggedDef) loggedDef.style.display = logado ? '' : 'none';
  // Registar tab — hide form if guest
  const regForm = document.querySelector('#tab-registar .sim-card');
  if (regForm) {
    if (!logado) {
      regForm.innerHTML = `<div class="sim-card-title"><div class="sim-icon">🔐</div>Necessário iniciar sessão</div>
        <p style="font-size:0.83rem;color:var(--muted);line-height:1.6;margin-bottom:16px;">Para registar movimentos financeiros precisas de uma conta.</p>
        <button class="calc-btn" onclick="mostrarLogin()">🔐 Entrar / Criar conta</button>`;
    }
  }
}
let mesAtual = new Date();
mesAtual.setDate(1);

// ── Formatters ──────────────────────────────────────────────
const fmt    = v => v.toLocaleString('pt-PT', {minimumFractionDigits:2, maximumFractionDigits:2}) + ' €';
const fmtPct = v => v.toFixed(2) + '%';
const fmtK   = v => Math.abs(v) >= 1000
  ? (v/1000).toFixed(1) + 'k €'
  : v.toFixed(0) + ' €';

// ============================================================
// AUTH
// ============================================================
function switchAuthTab(tab, el) {
  document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('auth-form-login').style.display  = tab === 'login'    ? '' : 'none';
  document.getElementById('auth-form-register').style.display= tab === 'register' ? '' : 'none';
  document.getElementById('magic-sent').style.display        = 'none';
  document.getElementById('auth-error').textContent          = '';
}

function setAuthError(msg) { document.getElementById('auth-error').textContent = msg; }

async function doLogin() {
  const email = document.getElementById('auth-email-login').value.trim();
  const pass  = document.getElementById('auth-pass-login').value;
  if (!email || !pass) return setAuthError('Preenche email e palavra-passe.');
  const { error } = await sb.auth.signInWithPassword({ email, password: pass });
  if (error) return setAuthError(error.message);
}

async function doRegister() {
  const nome  = document.getElementById('auth-name').value.trim();
  const email = document.getElementById('auth-email-reg').value.trim();
  const pass  = document.getElementById('auth-pass-reg').value;
  if (!nome || !email || !pass) return setAuthError('Preenche todos os campos.');
  if (pass.length < 6) return setAuthError('Palavra-passe mínimo 6 caracteres.');
  const { data, error } = await sb.auth.signUp({ email, password: pass, options: { data: { nome } } });
  if (error) return setAuthError(error.message);
  // Criar perfil
  if (data.user) {
    await sb.from('perfis').upsert({ id: data.user.id, nome });
  }
  setAuthError('✅ Conta criada! Verifica o email de confirmação.');
}

async function doMagicLink() {
  const email = document.getElementById('auth-email-login').value.trim();
  if (!email) return setAuthError('Introduz o teu email primeiro.');
  const { error } = await sb.auth.signInWithOtp({ email });
  if (error) return setAuthError(error.message);
  document.getElementById('auth-form-login').style.display = 'none';
  document.getElementById('magic-sent').style.display = 'block';
  document.getElementById('magic-email-display').textContent = email;
}

async function doLogout() {
  await sb.auth.signOut();
}

// ── Auth state listener ──────────────────────────────────────
sb.auth.onAuthStateChange(async (event, session) => {
  if (session?.user) {
    currentUser = session.user;
    document.getElementById('auth-screen').classList.add('hidden');
    atualizarEstadoAuth();
    await carregarPerfil();
    renderDashboard();
  } else {
    currentUser = null;
    currentPerfil = null;
    // Only show auth screen if not in guest mode
    if (!guestMode) {
      document.getElementById('auth-screen').classList.remove('hidden');
    }
    atualizarEstadoAuth();
  }
});

// ── Carregar perfil do utilizador ───────────────────────────
async function carregarPerfil() {
  if (!currentUser) return;
  const { data } = await sb.from('perfis').select('*').eq('id', currentUser.id).single();
  currentPerfil = data;
  const nome   = data?.nome || currentUser.email.split('@')[0];
  const initials = nome.split(' ').map(n => n[0]).join('').substring(0,2).toUpperCase();
  // Header avatar
  document.getElementById('avatar-btn').textContent = initials;
  // Dashboard
  document.getElementById('dash-avatar').textContent = initials;
  document.getElementById('dash-nome').textContent   = nome;
  document.getElementById('dash-email').textContent  = currentUser.email;
  // Definições
  document.getElementById('def-nome-hero').textContent  = nome;
  document.getElementById('def-email-hero').textContent = currentUser.email;
  if (data?.nome)          document.getElementById('def-nome').value         = data.nome;
  if (data?.data_nasc)     document.getElementById('def-datanasc').value     = data.data_nasc;
  if (data?.estado_civil)  document.getElementById('def-estadocivil').value  = data.estado_civil;
  if (data?.n_dep != null) document.getElementById('def-ndep').value         = data.n_dep;
  // Pré-preencher simuladores com dados do perfil
  if (data?.estado_civil) document.getElementById('irs-estadoCivil').value = data.estado_civil;
  if (data?.n_dep != null) document.getElementById('irs-dependentes').value = data.n_dep;
}

async function guardarPerfil() {
  if (!currentUser) return;
  const payload = {
    id:           currentUser.id,
    nome:         document.getElementById('def-nome').value.trim(),
    data_nasc:    document.getElementById('def-datanasc').value || null,
    estado_civil: document.getElementById('def-estadocivil').value,
    n_dep:        parseInt(document.getElementById('def-ndep').value) || 0,
  };
  const { error } = await sb.from('perfis').upsert(payload);
  const fb = document.getElementById('perfil-feedback');
  if (error) { fb.style.color = 'var(--red)'; fb.textContent = '❌ ' + error.message; }
  else {
    fb.style.color = 'var(--green)';
    fb.textContent = '✅ Perfil guardado!';
    await carregarPerfil();
    setTimeout(() => fb.textContent = '', 3000);
  }
}

// ============================================================
// MOVIMENTOS FINANCEIROS
// ============================================================
let tipoMovimento = 'income';

function selectTipo(tipo) {
  tipoMovimento = tipo;
  document.getElementById('tipo-income').classList.toggle('active', tipo === 'income');
  document.getElementById('tipo-expense').classList.toggle('active', tipo === 'expense');
}

async function guardarMovimento() {
  if (!currentUser) return;
  const descricao  = document.getElementById('reg-descricao').value.trim();
  const valor      = parseFloat(document.getElementById('reg-valor').value);
  const categoria  = document.getElementById('reg-categoria').value;
  const data       = document.getElementById('reg-data').value;
  const notas      = document.getElementById('reg-notas').value.trim();
  const fb         = document.getElementById('reg-feedback');
  if (!descricao || !valor || !data) { fb.style.color='var(--red)'; fb.textContent='⚠️ Preenche descrição, valor e data.'; return; }
  const { error } = await sb.from('movimentos').insert({
    user_id:   currentUser.id,
    tipo:      tipoMovimento,
    descricao,
    valor:     Math.abs(valor),
    categoria,
    data,
    notas: notas || null,
  });
  if (error) { fb.style.color='var(--red)'; fb.textContent='❌ ' + error.message; return; }
  fb.style.color = 'var(--green)';
  fb.textContent = '✅ Movimento guardado!';
  // Limpar campos
  document.getElementById('reg-descricao').value = '';
  document.getElementById('reg-valor').value     = '';
  document.getElementById('reg-notas').value     = '';
  await renderDashboard();
  setTimeout(() => fb.textContent = '', 3000);
}

async function apagarMovimento(id) {
  if (!confirm('Apagar este movimento?')) return;
  await sb.from('movimentos').delete().eq('id', id);
  await renderDashboard();
}

// ── Dashboard ───────────────────────────────────────────────
function mudaMes(dir) {
  mesAtual.setMonth(mesAtual.getMonth() + dir);
  renderDashboard();
}

async function renderDashboard() {
  if (!currentUser) return;
  const ano = mesAtual.getFullYear();
  const mes = mesAtual.getMonth() + 1;
  const ini = `${ano}-${String(mes).padStart(2,'0')}-01`;
  const fim = `${ano}-${String(mes).padStart(2,'0')}-31`;

  document.getElementById('mes-label').textContent = mesAtual.toLocaleDateString('pt-PT', { month: 'long', year: 'numeric' });

  const { data: movs } = await sb.from('movimentos')
    .select('*')
    .eq('user_id', currentUser.id)
    .gte('data', ini)
    .lte('data', fim)
    .order('data', { ascending: false });

  const lista = movs || [];
  const rendTotal = lista.filter(m => m.tipo === 'income').reduce((s,m) => s + parseFloat(m.valor), 0);
  const despTotal = lista.filter(m => m.tipo === 'expense').reduce((s,m) => s + parseFloat(m.valor), 0);
  const saldo     = rendTotal - despTotal;

  document.getElementById('dash-rendimentos').textContent  = fmtK(rendTotal);
  document.getElementById('dash-despesas').textContent     = fmtK(despTotal);
  document.getElementById('dash-n-rendimentos').textContent= lista.filter(m=>m.tipo==='income').length + ' entradas';
  document.getElementById('dash-n-despesas').textContent   = lista.filter(m=>m.tipo==='expense').length + ' saídas';
  const saldoEl = document.getElementById('dash-saldo-mes');
  saldoEl.textContent  = fmtK(saldo);
  saldoEl.style.color  = saldo >= 0 ? 'var(--green)' : 'var(--red)';

  // Stats do hero (total histórico)
  const { data: todos } = await sb.from('movimentos').select('tipo,valor').eq('user_id', currentUser.id);
  const tRend  = (todos||[]).filter(m=>m.tipo==='income').reduce((s,m)=>s+parseFloat(m.valor),0);
  const tDesp  = (todos||[]).filter(m=>m.tipo==='expense').reduce((s,m)=>s+parseFloat(m.valor),0);
  const tSaldo = tRend - tDesp;
  // meses com dados
  const mesesComDados = new Set((todos||[]).map(m => m.data?.substring(0,7))).size;
  document.getElementById('stat-saldo').textContent   = fmtK(tSaldo);
  document.getElementById('stat-poupanca').textContent= fmtK(tRend);
  document.getElementById('stat-meses').textContent   = mesesComDados;

  // Lista movimentos
  const container = document.getElementById('lista-movimentos');
  if (lista.length === 0) {
    container.innerHTML = '<div class="empty-state">Sem movimentos registados neste mês.<br><small>Vai a "Registar" para adicionar.</small></div>';
    return;
  }
  container.innerHTML = lista.map(m => {
    const isIncome = m.tipo === 'income';
    return `<div class="registo-item">
      <div class="registo-icon ${m.tipo}">${isIncome ? '💚' : '🔴'}</div>
      <div class="registo-info">
        <div class="registo-nome">${m.descricao}</div>
        <div class="registo-cat">${m.categoria} · ${new Date(m.data+'T12:00:00').toLocaleDateString('pt-PT', {day:'numeric',month:'short'})}</div>
      </div>
      <div class="registo-valor ${m.tipo}">${isIncome ? '+' : '-'}${fmt(parseFloat(m.valor))}</div>
      <button class="registo-del" onclick="apagarMovimento(${m.id})">✕</button>
    </div>`;
  }).join('');
}

// ============================================================
// NAV & TAB SYSTEM
// ============================================================
const sections = {
  perfil: {
    tabs: [
      { label: 'Dashboard', id: 'dashboard' },
      { label: 'Registar', id: 'registar' },
      { label: 'Definições', id: 'definicoes' },
    ],
    default: 'dashboard'
  },
  simular: {
    tabs: [
      { label: 'Salário Líquido', id: 'salario' },
      { label: 'Taxa de Esforço', id: 'esforco' },
      { label: 'IMT', id: 'imt' },
      { label: 'Poupança', id: 'sim-poupanca' },
      { label: 'Investimento', id: 'investimento' },
      { label: 'Inflação', id: 'inflacao' },
    ],
    default: 'salario'
  },
  poupanca: {
    tabs: [
      { label: 'Depósitos a Prazo', id: 'dep-prazo' },
      { label: 'Certificados', id: 'certificados' },
      { label: 'Fundos & ETFs', id: 'fundos' },
    ],
    default: 'dep-prazo'
  },
  taxas: {
    tabs: [
      { label: 'Euribor', id: 'euribor' },
      { label: 'Spreads', id: 'spreads' },
    ],
    default: 'euribor'
  },
  guia: {
    tabs: [
      { label: 'IRS Jovem', id: 'irs-jovem' },
      { label: 'Habitação', id: 'habitacao' },
      { label: 'FAQs', id: 'faqs' },
    ],
    default: 'irs-jovem'
  }
};

function renderSubTabs(section, activeId) {
  const bar = document.getElementById('sub-tab-bar');
  bar.innerHTML = '';
  sections[section].tabs.forEach(t => {
    const btn = document.createElement('button');
    btn.className = 'sub-tab-btn' + (t.id === activeId ? ' active' : '');
    btn.textContent = t.label;
    btn.onclick = () => {
      document.querySelectorAll('.sub-tab-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      showTab(t.id);
    };
    bar.appendChild(btn);
  });
}

function switchSection(section, navBtn) {
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  navBtn.classList.add('active');
  const def = sections[section].default;
  renderSubTabs(section, def);
  showTab(def);
}

function showTab(tabId) {
  document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
  const el = document.getElementById('tab-' + tabId);
  if (el) el.classList.add('active');
  // Scroll to top
  const sa = document.querySelector('.scroll-area');
  if (sa) sa.scrollTop = 0;
  if (tabId === 'dep-prazo' && allDeposits.length === 0) loadDeposits();
  if (tabId === 'fundos'    && allEtfs.length    === 0) loadEtfs();
  if (tabId === 'euribor') loadEuribor();
  // Definir data de hoje no registo
  if (tabId === 'registar') {
    const today = new Date().toISOString().split('T')[0];
    if (!document.getElementById('reg-data').value) document.getElementById('reg-data').value = today;
  }
}

renderSubTabs('perfil', 'dashboard');

// ── Euribor ─────────────────────────────────────────────────
async function loadEuribor() {
  try {
    const data = await chamarAPI('euribor', {});
    if (!Array.isArray(data) || data.length === 0) return;
    const byPrazo = Object.fromEntries(data.map(d => [d.prazo, d]));
    function renderBox(id, chgId, prazo) {
      const d = byPrazo[prazo]; if (!d) return;
      document.getElementById(id).textContent = d.taxa.toFixed(3) + '%';
      const chgEl = document.getElementById(chgId);
      if (d.variacao !== null) {
        const sign = d.variacao > 0 ? '▲ +' : d.variacao < 0 ? '▼ ' : '= ';
        chgEl.textContent = sign + d.variacao.toFixed(3) + '%';
        chgEl.className   = 'euribor-change ' + (d.variacao > 0 ? 'up' : d.variacao < 0 ? 'down' : 'flat');
      }
    }
    renderBox('eur-3m',  'eur-3m-chg',  '3M');
    renderBox('eur-6m',  'eur-6m-chg',  '6M');
    renderBox('eur-12m', 'eur-12m-chg', '12M');
    const e12 = byPrazo['12M'];
    if (e12) {
      document.getElementById('eur-hero-val').textContent   = e12.taxa.toFixed(3) + '%';
      document.getElementById('eur-hero-label').textContent = `Euribor 12M · ${new Date(e12.data_obs).toLocaleDateString('pt-PT', { month: 'long', year: 'numeric' })}`;
      if (e12.variacao !== null) {
        const sign = e12.variacao > 0 ? '▲ +' : '▼ ';
        const badge = document.getElementById('eur-hero-badge');
        badge.textContent = sign + e12.variacao.toFixed(3) + '% vs dia anterior';
        badge.className   = 'hero-badge ' + (e12.variacao < 0 ? 'down' : 'up');
      }
    }
    const latest = data.reduce((a, b) => a.updated_at > b.updated_at ? a : b);
    const dtStr  = new Date(latest.updated_at).toLocaleString('pt-PT', { dateStyle: 'short', timeStyle: 'short' });
    document.getElementById('eur-updated').textContent  = `Fonte: ECB · Última actualização: ${dtStr}`;
    document.getElementById('eur-hero-sub').textContent = 'Fonte BCE · Actualização diária automática';
  } catch (e) { console.warn('Euribor:', e.message); }
}

function selectChip(el, group) {
  document.querySelectorAll('#' + group + ' .chip').forEach(c => c.classList.remove('active'));
  el.classList.add('active');
}

// ============================================================
// EDGE FUNCTION
// ============================================================
async function chamarAPI(acao, params) {
  const res = await fetch(EDGE_URL, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${ANON_KEY}`,
      'apikey': ANON_KEY,
    },
    body: JSON.stringify({ acao, params }),
  });
  const data = await res.json();
  if (!data.ok) throw new Error(data.erro ?? 'Erro desconhecido');
  return data.resultado;
}

function setLoading(btn, loading) {
  if (!btn) return;
  if (loading) { btn.dataset.original = btn.textContent; btn.textContent = '⏳ A calcular...'; btn.disabled = true; btn.style.opacity = '0.7'; }
  else { btn.textContent = btn.dataset.original || btn.textContent; btn.disabled = false; btn.style.opacity = ''; }
}

// ── 1. SALÁRIO ───────────────────────────────────────────────
async function calcSalarioCompleto() {
  const btn = document.querySelector('#tab-salario .calc-btn');
  setLoading(btn, true);
  try {
    const r = await chamarAPI('salario', {
      base: parseFloat(document.getElementById('irs-base').value)||0,
      extras: parseFloat(document.getElementById('irs-extras').value)||0,
      outros: parseFloat(document.getElementById('irs-outros').value)||0,
      isentos: parseFloat(document.getElementById('irs-isentos').value)||0,
      nDep: parseInt(document.getElementById('irs-dependentes').value)||0,
      subV: parseFloat(document.getElementById('irs-subAlimValor').value)||0,
      subD: parseInt(document.getElementById('irs-subAlimDias').value)||0,
      tipoPag: document.getElementById('irs-tipoPagAlim').value,
      percDuo: parseFloat(document.getElementById('irs-duodecimos').value)||0,
      taxaSS: parseFloat(document.getElementById('irs-taxaSS').value)||11,
      estadoCivil: document.getElementById('irs-estadoCivil').value,
      incap: document.getElementById('irs-incapacidade').checked,
    });
    document.getElementById('hero-liquido').textContent = fmt(r.liquido);
    document.getElementById('hero-sal-sub').textContent = 'Líquido · IRS ' + fmtPct(r.taxaMarginal * 100) + ' marginal · SS ' + fmtPct(r.taxaSSDecimal * 100);
    document.getElementById('rr-base').textContent = fmt(r.base);
    document.getElementById('rr-subAlim').textContent = fmt(r.subAlimTotal);
    const showExtras = r.extras > 0; const showDuo = r.duoBruto > 0; const showTrib = r.subAlimTrib > 0;
    document.getElementById('rr-box-extras').style.display = showExtras ? '' : 'none';
    if (showExtras) document.getElementById('rr-extras').textContent = fmt(r.extras);
    document.getElementById('rr-box-duo').style.display = showDuo ? '' : 'none';
    if (showDuo) document.getElementById('rr-duo').textContent = fmt(r.duoBruto);
    document.getElementById('rr-box-trib').style.display = showTrib ? '' : 'none';
    if (showTrib) document.getElementById('rr-subAlimTrib').textContent = fmt(r.subAlimTrib);
    document.getElementById('bd-taxaSS-pct').textContent = fmtPct(r.taxaSSDecimal * 100);
    document.getElementById('bd-totalBruto').textContent = fmt(r.totalBruto);
    document.getElementById('bd-ss').textContent = fmt(r.valorSS);
    document.getElementById('bd-taxaIRS').textContent = fmtPct(r.taxaMarginal * 100) + ' marginal';
    document.getElementById('bd-totalIRS').textContent = fmt(r.totalIRS);
    document.getElementById('bd-totalDesc').textContent = fmt(r.totalDesc);
    document.getElementById('bd-liquido').textContent = fmt(r.liquido);
    document.getElementById('bd-taxaEfetiva').textContent = fmtPct(r.taxaEfetiva);
    document.getElementById('bd-row-irsExtras').style.display = showExtras ? '' : 'none';
    if (showExtras) document.getElementById('bd-irsExtras').textContent = fmt(r.irsExtras);
    document.getElementById('bd-row-irsDuo').style.display = showDuo ? '' : 'none';
    if (showDuo) document.getElementById('bd-irsDuo').textContent = fmt(r.irsDuo);
    document.getElementById('rr-liquido').textContent = fmt(r.liquido);
    document.getElementById('rr-descontos').textContent = fmt(r.totalDesc);
    document.getElementById('rr-taxaEfetiva').textContent = fmtPct(r.taxaEfetiva);
    document.getElementById('irs-results-block').style.display = 'block';
    document.querySelector('.scroll-area').scrollTo({ top: 500, behavior: 'smooth' });
  } catch (e) { alert('Erro: ' + e.message); } finally { setLoading(btn, false); }
}

// ── 2. DSTI ──────────────────────────────────────────────────
async function esf_atualizarPrazo() {
  const dn1 = document.getElementById('esf-dn1').value;
  if (!dn1) { document.getElementById('esf-prazo-info').style.display = 'none'; return; }
  try {
    const r = await chamarAPI('prazo_max', { dn1, dn2: document.getElementById('esf-dn2').value || undefined });
    const infoEl = document.getElementById('esf-prazo-info');
    const prazoInput = document.getElementById('esf-prazo');
    prazoInput.max = r.prazoMax;
    if (parseInt(prazoInput.value) > r.prazoMax) prazoInput.value = r.prazoMax;
    const anos = Math.floor(r.prazoMax / 12); const meses = r.prazoMax % 12;
    infoEl.style.display = 'block';
    infoEl.textContent = `Prazo máximo BdP: ${meses > 0 ? anos+'a '+meses+'m' : anos+' anos'} (titular mais velho: ${r.idade} anos)`;
    prazoInput.value = r.prazoMax;
  } catch (_) {}
}

async function calcEsforco() {
  const btn = document.querySelector('#tab-esforco .calc-btn');
  setLoading(btn, true);
  try {
    const r = await chamarAPI('dsti', {
      rend1: parseFloat(document.getElementById('esf-rend1').value)||0,
      rend2: parseFloat(document.getElementById('esf-rend2').value)||0,
      op1: parseFloat(document.getElementById('esf-op1').value)||0,
      enc1: parseFloat(document.getElementById('esf-enc1').value)||0,
      op2: parseFloat(document.getElementById('esf-op2').value)||0,
      encMut: parseFloat(document.getElementById('esf-encMutuos').value)||0,
      vImovel: parseFloat(document.getElementById('esf-vImovel').value)||0,
      montante: parseFloat(document.getElementById('esf-montante').value)||0,
      taxa: parseFloat(document.getElementById('esf-taxa').value)||0,
      prazo: parseInt(document.getElementById('esf-prazo').value)||0,
      dn1: document.getElementById('esf-dn1').value,
      dn2: document.getElementById('esf-dn2').value || undefined,
    });
    document.getElementById('hero-esforco').textContent = fmtPct(r.te);
    document.getElementById('hero-esforco-sub').textContent = `DSTI ${fmtPct(r.dsti)} · LTV ${fmtPct(r.ltv)}`;
    document.getElementById('res-esforco').textContent = fmtPct(r.te);
    document.getElementById('res-dsti').textContent = fmtPct(r.dsti);
    document.getElementById('res-ltv').textContent = fmtPct(r.ltv);
    document.getElementById('bd-esf-prest').textContent = fmt(r.prest);
    document.getElementById('bd-esf-prestStress').textContent = fmt(r.prestStress);
    document.getElementById('bd-esf-rendTotal').textContent = fmt(r.rendTotalMens);
    document.getElementById('bd-esf-rendAjust').textContent = fmt(r.rendTotalAjust);
    const prazoMaxStr = r.prazoMaxMeses > 0 ? `${r.prazoMaxAnos}a ${r.prazoMaxMeses}m` : `${r.prazoMaxAnos} anos`;
    document.getElementById('bd-esf-prazoMax').textContent = prazoMaxStr;
    document.getElementById('bd-esf-te').textContent = fmtPct(r.te);
    document.getElementById('bd-esf-dsti').textContent = fmtPct(r.dsti);
    document.getElementById('bd-esf-ltv').textContent = fmtPct(r.ltv);
    document.getElementById('res-maxTE').textContent = fmt(r.valMaxTE);
    document.getElementById('res-maxDSTI').textContent = fmt(r.valMaxDSTI);
    document.getElementById('res-maxLTV').textContent = fmt(r.valMaxLTV);
    document.getElementById('res-maxRec').textContent = fmt(r.valMaxRec);
    esf_setBar('esf-fill-te','esf-box-te',r.te,60);
    esf_setBar('esf-fill-dsti','esf-box-dsti',r.dsti,50);
    esf_setBar('esf-fill-ltv','esf-box-ltv',r.ltv,90);
    document.getElementById('esf-results-block').style.display = 'block';
    document.querySelector('.scroll-area').scrollTo({ top: 600, behavior: 'smooth' });
  } catch (e) { alert('Erro: ' + e.message); } finally { setLoading(btn, false); }
}

function esf_barColor(pct) { return pct < 70 ? 'var(--green)' : pct < 90 ? 'var(--amber)' : 'var(--red)'; }
function esf_setBar(fillId, boxId, valor, limite) {
  const pct = Math.min((valor / limite) * 100, 100);
  const color = esf_barColor(pct);
  const fill = document.getElementById(fillId);
  const box = document.getElementById(boxId);
  setTimeout(() => { fill.style.width = pct + '%'; fill.style.background = color; }, 60);
  box.style.borderColor = color;
  box.style.background = pct < 70 ? 'rgba(0,200,150,0.05)' : pct < 90 ? 'rgba(245,158,11,0.06)' : 'rgba(255,61,107,0.07)';
}

// ── 3. IMT ───────────────────────────────────────────────────
async function calcIMT() {
  const btn = document.querySelector('#tab-imt .calc-btn');
  setLoading(btn, true);
  try {
    const r = await chamarAPI('imt', {
      valor: parseFloat(document.getElementById('imt-valor').value)||0,
      tipo: document.querySelector('#imt-chips .chip.active')?.textContent.includes('Própria') ? 'propria' : 'secundaria',
    });
    document.getElementById('res-imt').textContent = fmt(r.imt);
    document.getElementById('res-selo').textContent = fmt(r.selo);
    document.getElementById('res-imt-total').textContent = fmt(r.total);
    document.getElementById('hero-imt').textContent = fmt(r.total);
    document.getElementById('imt-results').style.display = 'grid';
  } catch (e) { alert('Erro: ' + e.message); } finally { setLoading(btn, false); }
}

// ── 4. POUPANÇA ──────────────────────────────────────────────
async function calcPoupanca() {
  const btn = document.querySelector('#tab-sim-poupanca .calc-btn');
  setLoading(btn, true);
  try {
    const capLabel = document.querySelector('#p-cap-chips .chip.active')?.textContent || '6 Meses';
    const capMap = { 'Mensal': 1, '3 Meses': 3, '6 Meses': 6, '12 Meses': 12 };
    const r = await chamarAPI('poupanca', {
      capital: parseFloat(document.getElementById('p-capital').value)||0,
      mensal: parseFloat(document.getElementById('p-mensal').value)||0,
      taxa: parseFloat(document.getElementById('p-taxa').value)||0,
      retencao: parseFloat(document.getElementById('p-retencao').value)||28,
      anos: parseFloat(document.getElementById('p-anos').value)||0,
      capMeses: capMap[capLabel.trim()] || 6,
    });
    document.getElementById('res-p-liquido').textContent = fmt(r.saldo);
    document.getElementById('res-p-depositado').textContent = fmt(r.totalDep);
    document.getElementById('res-p-juros-brutos').textContent = fmt(r.jurosBrutos);
    document.getElementById('res-p-retencao').textContent = fmt(r.retTotal);
    document.getElementById('res-p-juros-liq').textContent = fmt(r.jurosLiquidos);
    document.getElementById('bd-p-taxa-liq').textContent = fmtPct(r.taxaLiqAnualPct);
    document.getElementById('bd-p-cap').textContent = capLabel;
    document.getElementById('bd-p-periodos').textContent = r.totalPeriods + ' períodos';
    document.getElementById('bd-p-rentab').textContent = fmtPct(r.rentabTotal) + ' total';
    document.getElementById('p-results').style.display = 'block';
    document.getElementById('hero-poup').textContent = fmt(r.saldo);
  } catch (e) { alert('Erro: ' + e.message); } finally { setLoading(btn, false); }
}

// ── 5. INVESTIMENTO ──────────────────────────────────────────
async function calcInvestimento() {
  const btn = document.querySelector('#tab-investimento .calc-btn');
  setLoading(btn, true);
  try {
    const r = await chamarAPI('investimento', {
      capital: parseFloat(document.getElementById('inv-capital').value)||0,
      mensal: parseFloat(document.getElementById('inv-mensal').value)||0,
      taxa: parseFloat(document.getElementById('inv-taxa').value)||0,
      retencao: parseFloat(document.getElementById('inv-retencao').value)||28,
      anos: parseFloat(document.getElementById('inv-anos').value)||0,
    });
    document.getElementById('res-inv-liq').textContent = fmt(r.finalLiq);
    document.getElementById('res-inv-dep').textContent = fmt(r.totalInv);
    document.getElementById('res-inv-bruto').textContent = fmt(r.ganhoBruto);
    document.getElementById('res-inv-imposto').textContent = fmt(r.imposto);
    document.getElementById('res-inv-liquido').textContent = fmt(r.ganhoLiq);
    document.getElementById('bd-inv-taxa-liq').textContent = fmtPct(r.taxaLiqEf);
    document.getElementById('bd-inv-mult').textContent = 'x' + r.multiplicador.toFixed(2);
    document.getElementById('bd-inv-rentab').textContent = fmtPct(r.rentabLiq);
    document.getElementById('inv-results').style.display = 'block';
    document.getElementById('hero-inv').textContent = fmt(r.finalLiq);
  } catch (e) { alert('Erro: ' + e.message); } finally { setLoading(btn, false); }
}

// ── 6. INFLAÇÃO ──────────────────────────────────────────────
async function calcInflacao() {
  const btn = document.querySelector('#tab-inflacao .calc-btn');
  setLoading(btn, true);
  try {
    const r = await chamarAPI('inflacao', {
      valor: parseFloat(document.getElementById('inf-valor').value)||0,
      taxa: parseFloat(document.getElementById('inf-taxa').value)||0,
      anos: parseFloat(document.getElementById('inf-anos').value)||0,
    });
    document.getElementById('res-inf-futuro').textContent = fmt(r.futuro);
    document.getElementById('res-inf-perda').textContent = fmt(r.perda);
    document.getElementById('hero-inf').textContent = fmt(r.futuro);
    document.getElementById('inf-results').style.display = 'grid';
  } catch (e) { alert('Erro: ' + e.message); } finally { setLoading(btn, false); }
}

// ============================================================
// DEPOSITS
// ============================================================
let allDeposits = [];
let activeFilters = { novos_capitais: null, novos_clientes: null };
let sortAsc = false;

async function loadDeposits() {
  try {
    const res = await fetch(`${SUPABASE_URL}/rest/v1/Taxas%20DP?select=*&order=TANB.desc`,
      { headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}`, 'Content-Type': 'application/json' } });
    if (!res.ok) throw new Error(await res.text());
    allDeposits = await res.json();
    applyFilters();
  } catch(e) {
    document.getElementById('dp-list').innerHTML = '<div class="empty-state">❌ Erro: ' + e.message + '</div>';
  }
}

function toggleFilter(key) {
  if (activeFilters[key] === null) activeFilters[key] = true;
  else if (activeFilters[key] === true) activeFilters[key] = false;
  else activeFilters[key] = null;
  const el = document.getElementById('ft-' + key.replace('_','-'));
  if (el) {
    el.classList.toggle('active', activeFilters[key] !== null);
    el.classList.toggle('filter-neg', activeFilters[key] === false);
    const base = key === 'novos_capitais' ? 'Novos Capitais' : 'Novos Clientes';
    if (activeFilters[key] === true) el.querySelector('.ft-label').textContent = '✓ ' + base;
    else if (activeFilters[key] === false) el.querySelector('.ft-label').textContent = '✗ ' + base;
    else el.querySelector('.ft-label').textContent = base;
  }
  applyFilters();
}

function toggleSort() {
  sortAsc = !sortAsc;
  const btn = document.getElementById('sort-btn');
  if (btn) btn.textContent = (sortAsc ? '↑' : '↓') + ' TANB';
  applyFilters();
}

function applyFilters() {
  const fMin = parseFloat(document.getElementById('f-dep-min')?.value) || null;
  const fMax = parseFloat(document.getElementById('f-dep-max')?.value) || null;
  const normalized = allDeposits.map(normalizeRow);
  let filtered = normalized.filter(d => {
    if (activeFilters.novos_capitais === true  && !d.novos_capitais) return false;
    if (activeFilters.novos_capitais === false &&  d.novos_capitais) return false;
    if (activeFilters.novos_clientes === true  && !d.novos_clientes) return false;
    if (activeFilters.novos_clientes === false &&  d.novos_clientes) return false;
    if (fMin !== null && d.deposito_minimo !== null && d.deposito_minimo > fMin) return false;
    if (fMax !== null && d.deposito_maximo !== null && d.deposito_maximo < fMax) return false;
    return true;
  });
  filtered.sort((a, b) => sortAsc ? a.tanb - b.tanb : b.tanb - a.tanb);
  renderDeposits(filtered);
}

function getBankAbbr(banco) {
  if (!banco) return '??';
  const map = { 'Activobank':'ACTV','Caixa Geral de Depósitos':'CGD','Banco BPI':'BPI','BPI':'BPI','Millennium BCP':'BCP','BCP':'BCP','Banco Santander':'SNT','Santander':'SNT','Novobanco':'NVB','Banco CTT':'CTT','CTT':'CTT','Montepio':'MTPO','Crédito Agrícola':'CA' };
  return map[banco] || banco.substring(0,4).toUpperCase();
}

function ptNum(val) {
  if (val === null || val === undefined || val === '') return null;
  const s = String(val).trim();
  if (s.includes(',')) return parseFloat(s.replace(/\./g, '').replace(',', '.'));
  return parseFloat(s.replace(/\s/g, '')) || null;
}

function normalizeRow(d) {
  return {
    id: d.id || Math.random(),
    banco: d['Banco'] || '—',
    prazo: d['Prazo'] || '—',
    unidade: d['Dias /meses /anos'] || '',
    nome_deposito: d['Nome do Depósito'] || '—',
    tanb: ptNum(d['TANB']) || 0,
    tanl: ptNum(d['TANL']),
    tipo_taxa: d['Tipo de Taxa'] || 'Fixa',
    deposito_minimo: ptNum(d['Depósito Mínimo']),
    deposito_maximo: ptNum(d['Depósito Máximo']),
    mobilizacao: d['Perda de juros com mobilização antecipada'] || '—',
    novos_capitais: d['Novos capitais?'] === 'Sim' || d['Novos capitais?'] === true || false,
    novos_clientes: d['Novos clientes?'] === 'Sim' || d['Novos clientes?'] === true || false,
    fin: d['FIN (use o endereço)'] || '',
  };
}

function renderDeposits(list) {
  const container = document.getElementById('dp-list');
  const countEl   = document.getElementById('dp-count');
  if (!container) return;
  if (countEl) countEl.textContent = list.length + ' resultado' + (list.length !== 1 ? 's' : '');
  if (list.length === 0) { container.innerHTML = '<div class="empty-state">😕 Nenhum depósito corresponde aos filtros.</div>'; return; }
  const best = list[0];
  const bestRateEl = document.getElementById('dp-best-rate');
  const bestSubEl  = document.getElementById('dp-best-sub');
  if (bestRateEl) bestRateEl.textContent = best.tanb.toFixed(2) + '%';
  if (bestSubEl)  bestSubEl.textContent  = best.banco + ' · ' + best.prazo + ' ' + best.unidade + ' · líq: ' + (best.tanl || best.tanb * 0.72).toFixed(2) + '%';
  container.innerHTML = list.map(d => {
    const tanl = d.tanl || parseFloat((d.tanb * 0.72).toFixed(2));
    const ret1k = ((d.tanb - tanl) * 10).toFixed(2);
    const juros1k = (tanl * 10).toFixed(2);
    const abbr = getBankAbbr(d.banco);
    const prazoStr = d.prazo + (d.unidade ? ' ' + d.unidade : '');
    const uid = String(d.id).replace(/[^a-z0-9]/gi, '_');
    return `<div class="dp-card" id="dp-card-${uid}">
      <div class="dp-card-header" onclick="toggleDpCard('${uid}')">
        <div class="dp-card-left"><div class="dp-logo">${abbr}</div><div><div class="dp-name">${d.banco}</div><div class="dp-sub">${d.nome_deposito} · ${prazoStr}</div></div></div>
        <div class="dp-rate-col"><div class="dp-tanb">${d.tanb.toFixed(2)}%</div><div class="dp-tanl">líq. ${tanl.toFixed(2)}%</div></div>
        <div class="dp-expand-icon">▾</div>
      </div>
      <div class="dp-details">
        <div class="dp-detail-row"><span class="dp-dk">TANB (bruta)</span><span class="dp-dv">${d.tanb.toFixed(2)}%</span></div>
        <div class="dp-detail-row"><span class="dp-dk">TANL (líquida após 28%)</span><span class="dp-dv green">${tanl.toFixed(2)}%</span></div>
        <div class="dp-detail-row"><span class="dp-dk">Retenção Estado (por €1.000)</span><span class="dp-dv red">${ret1k} €</span></div>
        <div class="dp-detail-row"><span class="dp-dk">Juros líquidos (por €1.000)</span><span class="dp-dv">${juros1k} €</span></div>
        <div class="dp-detail-row"><span class="dp-dk">Tipo de Taxa</span><span class="dp-dv">${d.tipo_taxa}</span></div>
        <div class="dp-detail-row"><span class="dp-dk">Depósito Mínimo</span><span class="dp-dv">${d.deposito_minimo ? d.deposito_minimo.toLocaleString('pt-PT') + ' €' : '—'}</span></div>
        <div class="dp-detail-row"><span class="dp-dk">Depósito Máximo</span><span class="dp-dv">${d.deposito_maximo ? d.deposito_maximo.toLocaleString('pt-PT') + ' €' : 'Sem limite'}</span></div>
        <div class="dp-detail-row"><span class="dp-dk">Mobilização Antecipada</span><span class="dp-dv amber">${d.mobilizacao}</span></div>
        <div class="dp-tags">
          <span class="dp-tag ${d.novos_capitais ? 'green' : 'gray'}">${d.novos_capitais ? '✓' : '✗'} Novos Capitais</span>
          <span class="dp-tag ${d.novos_clientes ? 'green' : 'gray'}">${d.novos_clientes ? '✓' : '✗'} Novos Clientes</span>
        </div>
        ${d.fin ? `<a class="dp-fin-link" href="${d.fin}" target="_blank">📄 Ver Ficha de Informação Normalizada →</a>` : ''}
      </div>
    </div>`;
  }).join('');
}

function toggleDpCard(id) { document.getElementById('dp-card-' + id)?.classList.toggle('open'); }


// ============================================================
// ETFs — Supabase
// ============================================================
let allEtfs = [];
let etfCatFilter = 'Todos';

async function loadEtfs() {
  try {
    const res = await fetch(
      `${SUPABASE_URL}/rest/v1/etfs?select=*&order=ticker.asc`,
      { headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` } }
    );
    if (!res.ok) throw new Error(await res.text());
    allEtfs = await res.json();
    renderEtfs();
  } catch(e) {
    document.getElementById('etf-list').innerHTML = '<div class="empty-state">❌ Erro ao carregar ETFs</div>';
  }
}

function filterEtfCat(cat, btn) {
  etfCatFilter = cat;
  document.querySelectorAll('.etf-cat-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderEtfs();
}

function perfClass(v) { if (v == null) return 'flat'; return v > 0 ? 'up' : v < 0 ? 'down' : 'flat'; }
function perfStr(v)   { if (v == null) return '—'; return (v > 0 ? '+' : '') + parseFloat(v).toFixed(2) + '%'; }

function renderEtfs() {
  const list = etfCatFilter === 'Todos' ? allEtfs : allEtfs.filter(e => e.categoria === etfCatFilter || (etfCatFilter === 'EUA' && e.categoria?.startsWith('EUA')));
  const heroEl  = document.getElementById('etf-hero-val');
  const heroSub = document.getElementById('etf-hero-sub');
  const container = document.getElementById('etf-list');
  if (!container) return;
  if (heroEl)  heroEl.textContent  = list.length + ' ETFs';
  if (heroSub) heroSub.textContent = list.filter(e => e.preco != null).length + ' com cotação actualizada · 28% imposto';
  if (list.length === 0) { container.innerHTML = '<div class="empty-state">Nenhum ETF nesta categoria.</div>'; return; }
  try {
    container.innerHTML = list.map(e => {
      const ticker   = e.ticker || '—';
      const abbr     = ticker.split('.')[0];
      const chgVal   = parseFloat(e.variacao_dia) || null;
      const chgCls   = perfClass(chgVal);
      const chgStr   = chgVal != null ? (chgVal > 0 ? '▲ ' : '▼ ') + Math.abs(chgVal).toFixed(2) + '%' : '—';
      const uid      = ticker.replace(/[^a-z0-9]/gi, '_');
      const preco    = e.preco != null ? parseFloat(e.preco) : null;
      const priceStr = preco != null ? preco.toFixed(2) + ' €' : '—';
      const ret7d    = e.ret_7d  != null ? parseFloat(e.ret_7d)  : null;
      const ret1m    = e.ret_1m  != null ? parseFloat(e.ret_1m)  : null;
      const ret6m    = e.ret_6m  != null ? parseFloat(e.ret_6m)  : null;
      const ret1a    = e.ret_1a  != null ? parseFloat(e.ret_1a)  : null;
      return '<div class="etf-card" id="etf-card-' + uid + '">'
        + '<div class="etf-header" onclick="toggleEtfCard(\'' + uid + '\')">'
          + '<div class="etf-logo">' + abbr + '</div>'
          + '<div class="etf-info"><div class="etf-name">' + (e.nome || ticker) + '</div><div class="etf-sub">' + ticker + ' · ' + (e.categoria || '') + ' · TER ' + (e.ter ? e.ter + '%' : '—') + '</div></div>'
          + '<div class="etf-right"><div class="etf-price">' + priceStr + '</div><div class="etf-chg ' + chgCls + '">' + chgStr + '</div></div>'
          + '<div class="etf-expand-icon">▾</div>'
        + '</div>'

        + '<div class="etf-details">'
          + '<div class="etf-detail-row"><span class="etf-dk">Ticker</span><span class="etf-dv">' + ticker + '</span></div>'
          + '<div class="etf-detail-row"><span class="etf-dk">Cotação Actual</span><span class="etf-dv">' + priceStr + '</span></div>'
          + '<div class="etf-detail-row"><span class="etf-dk">Variação Hoje</span><span class="etf-dv ' + chgCls + '">' + chgStr + '</span></div>'
          + '<div class="etf-detail-row"><span class="etf-dk">Rent. 7 Dias</span><span class="etf-dv ' + perfClass(ret7d) + '">' + perfStr(ret7d) + '</span></div>'
          + '<div class="etf-detail-row"><span class="etf-dk">Rent. 1 Mês</span><span class="etf-dv ' + perfClass(ret1m) + '">' + perfStr(ret1m) + '</span></div>'
          + '<div class="etf-detail-row"><span class="etf-dk">Rent. 6 Meses</span><span class="etf-dv ' + perfClass(ret6m) + '">' + perfStr(ret6m) + '</span></div>'
          + '<div class="etf-detail-row"><span class="etf-dk">Rent. 1 Ano</span><span class="etf-dv ' + perfClass(ret1a) + '">' + perfStr(ret1a) + '</span></div>'
          + '<div class="etf-detail-row"><span class="etf-dk">TER</span><span class="etf-dv">' + (e.ter ? e.ter + '%' : '—') + '</span></div>'
          + '<div class="etf-detail-row"><span class="etf-dk">Domicílio</span><span class="etf-dv">' + (e.domicilio || '—') + '</span></div>'
          + '<div class="etf-detail-row"><span class="etf-dk">Distribuição</span><span class="etf-dv">' + (e.distribucao || '—') + '</span></div>'
          + '<div class="etf-detail-row"><span class="etf-dk">Imposto PT</span><span class="etf-dv red">28% mais-valias</span></div>'
          + '<div class="etf-tags">'
            + '<span class="etf-tag">' + (e.categoria || '—') + '</span>'
            + '<span class="etf-tag ' + (e.distribucao === 'Acumulação' ? 'green' : 'amber') + '">' + (e.distribucao || '—') + '</span>'
            + '<span class="etf-tag">' + (e.domicilio || '—') + '</span>'
          + '</div>'
        + '</div>'
      + '</div>';
    }).join('');
  } catch(err) {
    container.innerHTML = '<div class="empty-state">❌ Erro ao renderizar: ' + err.message + '</div>';
  }
}

function toggleEtfCard(uid) { document.getElementById('etf-card-' + uid)?.classList.toggle('open'); }


function toggleGuia(id, header) {
  const body = document.getElementById(id);
  const isOpen = body.classList.contains('open');
  body.classList.toggle('open', !isOpen);
  header.classList.toggle('open', !isOpen);
  if (!isOpen) {
    setTimeout(() => header.scrollIntoView({ behavior: 'smooth', block: 'nearest' }), 30);
  }
}

function toggleFaq(item) {
  item.classList.toggle('open');
  if (item.classList.contains('open')) {
    setTimeout(() => item.scrollIntoView({ behavior: 'smooth', block: 'nearest' }), 30);
  }
}

// ── PWA ──────────────────────────────────────────────────────
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/sw.js')
      .then(reg => console.log('SW registado:', reg.scope))
      .catch(err => console.warn('SW erro:', err));
  });
}
</script>
</body>
</html>
